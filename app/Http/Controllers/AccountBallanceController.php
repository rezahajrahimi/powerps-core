<?php
bolt_decrypt( __FILE__ , 'UWTbl2'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnM7CnVzZSBBcHBcTW9kZWxzXEFjY291bnRCYWxsYW5jZTsKdXNlIEFwcFxNb2RlbHNcQm90VXNlcjsKdXNlIElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0OwoKY2xhc3MgQWNjb3VudEJhbGxhbmNlQ29udHJvbGxlciBleHRlbmRzIENvbnRyb2xsZXIKewogICAgcHVibGljIGZ1bmN0aW9uIGNoZWNrVXNlckhhc0JhbGFuY2UoJHVzZXJJRCwgJHByaWNlLCAkcGFyaWNlX2luX2RvbGxhcikKICAgIHsKICAgICAgICAvLyBmb3IgdGVzdCBhY2NvdW50CiAgICAgICAgaWYgKCRwcmljZSA9PSAwICYmICRwYXJpY2VfaW5fZG9sbGFyID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBjaGVjayBhZ2VudAoKICAgICAgICAkYWdlbnRQcmVtaXNzaW9uQ250cmwgPSBuZXcgQWdlbnRQZXJtaXNzb25Db250cm9sbGVyKCk7CiAgICAgICAgJGFnZW50UHIgPSAkYWdlbnRQcmVtaXNzaW9uQ250cmwtPmdldFVzZXJQcmVtaXNzaW9uKCk7CiAgICAgICAgaWYgKCRhZ2VudFByICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKCRhZ2VudFByLT5taW51c19iYWxsYW5jZSA9PSAxIHx8ICRhZ2VudFByLT5taW51c19iYWxsYW5jZSA9PSB0cnVlKSB7CgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGNvbW1vbiBwcm9kdWN0IGNhdGVnb3JleSBjaGVjawogICAgICAgICRkYXRhID0gQWNjb3VudEJhbGxhbmNlOjp3aGVyZSgnYWNjb3VudF9pZCcsICR1c2VySUQpLT5maXJzdCgpOwoKICAgICAgICBpZiAoJGRhdGEgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoJGRhdGEtPmJhbGxhbmNlID49ICRwcmljZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0gZWxzZWlmICgkZGF0YS0+YWNjb3VudF9iYWxsYW5jZV9pbl9kb2xsYXIgPj0gJHBhcmljZV9pbl9kb2xsYXIpIHsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+Y2hlY2tEb2xsYXJQYXkoKSA9PSB0cnVlIHx8ICR0aGlzLT5jaGVja0RvbGxhclBheSgpID09IDEgJiYgJHBhcmljZV9pbl9kb2xsYXIgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0VXNlckFjY3VudEJhbGFuY2UoJHVzZXJJRCkKICAgIHsKICAgICAgICAkZGF0YSA9IEFjY291bnRCYWxsYW5jZTo6d2hlcmUoJ2FjY291bnRfaWQnLCAkdXNlcklEKS0+Zmlyc3QoKTsKICAgICAgICBpZiAoJGRhdGEgIT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gJGRhdGEtPmJhbGxhbmNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRVc2VyQWNjdW50QmFsYW5jZUluRG9sbGFyKCR1c2VySUQpCiAgICB7CiAgICAgICAgJGRhdGEgPSBBY2NvdW50QmFsbGFuY2U6OndoZXJlKCdhY2NvdW50X2lkJywgJHVzZXJJRCktPmZpcnN0KCk7CiAgICAgICAgaWYgKCRkYXRhICE9IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuICRkYXRhLT5hY2NvdW50X2JhbGxhbmNlX2luX2RvbGxhcjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gaW5jVXNlckFjY3VudEJhbGFuY2UoJHVzZXJJRCwgJGJhbGxhbmNlKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRkYXRhID0gQWNjb3VudEJhbGxhbmNlOjp3aGVyZSgnYWNjb3VudF9pZCcsICR1c2VySUQpLT5maXJzdCgpOwogICAgICAgICAgICBpZiAoJGRhdGEgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgJGRhdGEtPmJhbGxhbmNlICs9ICRiYWxsYW5jZTsKCiAgICAgICAgICAgICAgICAkZGF0YS0+dXBkYXRlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRuZXdBY2MgPSBuZXcgQWNjb3VudEJhbGxhbmNlKCk7CiAgICAgICAgICAgICAgICAkbmV3QWNjLT5hY2NvdW50X2lkID0gJHVzZXJJRDsKICAgICAgICAgICAgICAgICRuZXdBY2MtPmJhbGxhbmNlID0gJGJhbGxhbmNlOwogICAgICAgICAgICAgICAgJG5ld0FjYy0+YWNjb3VudF9iYWxsYW5jZV9pbl9kb2xsYXIgPSAwOwogICAgICAgICAgICAgICAgJG5ld0FjYy0+c2F2ZSgpOwoKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgXExvZzo6aW5mbygibWVzc2FnZSAkdGgiKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiBpbmNyZWFzZVVzZXJBY2N1bnRCYWxhbmNlQnlVc2VySUQoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkdXNlciA9IEJvdFVzZXI6OndoZXJlKCdpZCcsICRyZXF1ZXN0LT51c2VySUQpLT5maXJzdCgpOwoKICAgICAgICAgICAgaWYgKCR1c2VyICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICR1c2VyQWNjb3VudElEID0gJHVzZXItPmFjY291bnRfaWQ7CiAgICAgICAgICAgICAgICAkYmFsbGFuY2UgPSAkcmVxdWVzdC0+YmFsbGFuY2U7CiAgICAgICAgICAgICAgICAkdHlwZSA9ICRyZXF1ZXN0LT50eXBlOwoKICAgICAgICAgICAgICAgIGlmICgkdHlwZSA9PSAndG9tYW4nKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmluY1VzZXJBY2N1bnRCYWxhbmNlKCR1c2VyQWNjb3VudElELCAkYmFsbGFuY2UpOwoKICAgICAgICAgICAgICAgICAgICAkbG9nQ3RybCA9IG5ldyBMb2dDb250cm9sbGVyKCk7CiAgICAgICAgICAgICAgICAgICAgJGxvZ0N0cmwtPmFkZE5ld0xvZygnYmFsbGFuY2UnLCAn2YXbjNiy2KfZhiDZhdmI2KzZiNiv24wg2qnYp9ix2KjYsSDYqNmHINmF2YLYr9in2LEgJyAuICRyZXF1ZXN0LT5iYWxsYW5jZSAuICcg2KrZiNmF2KfZhiDYp9mB2LLYp9uM2LQg24zYp9mB2KonLCAkdXNlckFjY291bnRJRCwgJycsICdlZGl0Jyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5nZXRVc2VyQWNjdW50QmFsYW5jZSgkdXNlckFjY291bnRJRCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbmNVc2VyQWNjdW50QmFsYW5jZUluRG9sbGFyKCR1c2VyQWNjb3VudElELCAkYmFsbGFuY2UpOwogICAgICAgICAgICAgICAgICAgICRsb2dDdHJsID0gbmV3IExvZ0NvbnRyb2xsZXIoKTsKCiAgICAgICAgICAgICAgICAgICAgJGxvZ0N0cmwtPmFkZE5ld0xvZygnYmFsbGFuY2UnLCAn2YXbjNiy2KfZhiDZhdmI2KzZiNiv24wg2qnYp9ix2KjYsSDYqNmHINmF2YLYr9in2LEgJyAuICRyZXF1ZXN0LT5iYWxsYW5jZSAuICcg2K/ZhNin2LEg2KfZgdiy2KfbjNi0INuM2KfZgdiqJywgJHVzZXJBY2NvdW50SUQsICcnLCAnZWRpdCcpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+Z2V0VXNlckFjY3VudEJhbGFuY2VJbkRvbGxhcigkdXNlckFjY291bnRJRCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24obnVsbCwgNDA0KTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBcTG9nOjppbmZvKCJtZXNzYWdlICR0aCIpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihudWxsLCA1MDApOwogICAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiBkZWNyZWFzZVVzZXJBY2N1bnRCYWxhbmNlQnlVc2VySUQoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkdXNlciA9IEJvdFVzZXI6OndoZXJlKCdpZCcsICRyZXF1ZXN0LT51c2VySUQpLT5maXJzdCgpOwoKICAgICAgICAgICAgaWYgKCR1c2VyICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICR1c2VyQWNjb3VudElEID0gJHVzZXItPmFjY291bnRfaWQ7CiAgICAgICAgICAgICAgICAkYmFsbGFuY2UgPSAkcmVxdWVzdC0+YmFsbGFuY2U7CiAgICAgICAgICAgICAgICAkdHlwZSA9ICRyZXF1ZXN0LT50eXBlOwogICAgICAgICAgICAgICAgJGFjY0JhbGxhbmNlID0gQWNjb3VudEJhbGxhbmNlOjp3aGVyZSgnYWNjb3VudF9pZCcsICR1c2VyQWNjb3VudElEKS0+Zmlyc3QoKTsKCiAgICAgICAgICAgICAgICBpZiAoJHR5cGUgPT0gJ3RvbWFuJykgewogICAgICAgICAgICAgICAgICAgICRhY2NCYWxsYW5jZS0+YmFsbGFuY2UgLT0gJGJhbGxhbmNlOwogICAgICAgICAgICAgICAgICAgICRhY2NCYWxsYW5jZS0+dXBkYXRlKCk7CiAgICAgICAgICAgICAgICAgICAgJGxvZ0N0cmwgPSBuZXcgTG9nQ29udHJvbGxlcigpOwogICAgICAgICAgICAgICAgICAgICRsb2dDdHJsLT5hZGROZXdMb2coJ2JhbGxhbmNlJywgJ9mF24zYstin2YYg2YXZiNis2YjYr9uMINqp2KfYsdio2LEg2KjZhyDZhdmC2K/Yp9ixICcgLiAkcmVxdWVzdC0+YmFsbGFuY2UgLiAnINiq2YjZhdin2YYg2qnYp9mH2LQg24zYp9mB2KonLCAkdXNlckFjY291bnRJRCwgJycsICdlZGl0Jyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY2NCYWxsYW5jZS0+YmFsbGFuY2U7CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJHR5cGUgPT0gJ2RvbGxhcicpIHsKICAgICAgICAgICAgICAgICAgICAkYWNjQmFsbGFuY2UtPmFjY291bnRfYmFsbGFuY2VfaW5fZG9sbGFyIC09IGRvdWJsZXZhbCgkYmFsbGFuY2UpOwogICAgICAgICAgICAgICAgICAgICRhY2NCYWxsYW5jZS0+dXBkYXRlKCk7CiAgICAgICAgICAgICAgICAgICAgJGxvZ0N0cmwgPSBuZXcgTG9nQ29udHJvbGxlcigpOwogICAgICAgICAgICAgICAgICAgICRsb2dDdHJsLT5hZGROZXdMb2coJ2JhbGxhbmNlJywgJ9mF24zYstin2YYg2YXZiNis2YjYr9uMINqp2KfYsdio2LEg2KjZhyDZhdmC2K/Yp9ixICcgLiAkcmVxdWVzdC0+YmFsbGFuY2UgLiAnINiv2YTYp9ixINqp2KfZh9i0INuM2KfZgdiqJywgJHVzZXJBY2NvdW50SUQsICcnLCAnZWRpdCcpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAkYWNjQmFsbGFuY2UtPmFjY291bnRfYmFsbGFuY2VfaW5fZG9sbGFyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKG51bGwsIDQwNCk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgXExvZzo6aW5mbygibWVzc2FnZSAkdGgiKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24obnVsbCwgNTAwKTsKICAgICAgICB9CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gaW5jVXNlckFjY3VudEJhbGFuY2VJbkRvbGxhcigkdXNlcklELCAkYmFsbGFuY2UpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGRhdGEgPSBBY2NvdW50QmFsbGFuY2U6OndoZXJlKCdhY2NvdW50X2lkJywgJHVzZXJJRCktPmZpcnN0KCk7CiAgICAgICAgICAgIGlmICgkZGF0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAkZGF0YS0+YWNjb3VudF9iYWxsYW5jZV9pbl9kb2xsYXIgKz0gJGJhbGxhbmNlOwoKICAgICAgICAgICAgICAgICRkYXRhLT51cGRhdGUoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJG5ld0FjYyA9IG5ldyBBY2NvdW50QmFsbGFuY2UoKTsKICAgICAgICAgICAgICAgICRuZXdBY2MtPmFjY291bnRfaWQgPSAkdXNlcklEOwogICAgICAgICAgICAgICAgJG5ld0FjYy0+YWNjb3VudF9iYWxsYW5jZV9pbl9kb2xsYXIgPSAkYmFsbGFuY2U7CiAgICAgICAgICAgICAgICAkbmV3QWNjLT5iYWxsYW5jZSA9IDA7CiAgICAgICAgICAgICAgICAkbmV3QWNjLT5zYXZlKCk7CgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBcTG9nOjppbmZvKCJtZXNzYWdlICR0aCIpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQogICAgcHVibGljIGZ1bmN0aW9uIGRlY1VzZXJBY2N1bnRCYWxhbmNlKCR1c2VySUQsICRiYWxsYW5jZSwgJHBhcmljZV9pbl9kb2xsYXIpCiAgICB7CiAgICAgICAgJGRhdGEgPSBBY2NvdW50QmFsbGFuY2U6OndoZXJlKCdhY2NvdW50X2lkJywgJHVzZXJJRCktPmZpcnN0KCk7CiAgICAgICAgaWYgKCRkYXRhICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKCRkYXRhLT5iYWxsYW5jZSA+PSAkYmFsbGFuY2UpIHsKICAgICAgICAgICAgICAgICRkYXRhLT5iYWxsYW5jZSAtPSAkYmFsbGFuY2U7CiAgICAgICAgICAgICAgICAkZGF0YS0+dXBkYXRlKCk7CgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0gZWxzZWlmICgkZGF0YS0+YWNjb3VudF9iYWxsYW5jZV9pbl9kb2xsYXIgPj0gJHBhcmljZV9pbl9kb2xsYXIpIHsKICAgICAgICAgICAgICAgICRkYXRhLT5hY2NvdW50X2JhbGxhbmNlX2luX2RvbGxhciAtPSBkb3VibGV2YWwoJHBhcmljZV9pbl9kb2xsYXIpOwogICAgICAgICAgICAgICAgJGRhdGEtPnVwZGF0ZSgpOwoKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJGFnZW50UHJlbWlzc2lvbkNudHJsID0gbmV3IEFnZW50UGVybWlzc29uQ29udHJvbGxlcigpOwogICAgICAgICAgICAgICAgJGFnZW50UHIgPSAkYWdlbnRQcmVtaXNzaW9uQ250cmwtPmdldFVzZXJQcmVtaXNzaW9uKCk7CiAgICAgICAgICAgICAgICBpZiAoJGFnZW50UHItPm1pbnVzX2JhbGxhbmNlID09IDEgfHwgJGFnZW50UHItPm1pbnVzX2JhbGxhbmNlID09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICAkZGF0YS0+YmFsbGFuY2UgLT0gJGJhbGxhbmNlOwogICAgICAgICAgICAgICAgICAgICRkYXRhLT51cGRhdGUoKTsKICAgICAgICAgICAgICAgICAgICBcTG9nOjppbmZvKCIgICRkYXRhLT5iYWxsYW5jZSIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXROZXdBY2NvdW50QmFsbGFuY2UoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkZGF0YSA9IEFjY291bnRCYWxsYW5jZTo6d2hlcmUoJ2FjY291bnRfaWQnLCAkcmVxdWVzdC0+dXNlcklEKS0+Zmlyc3QoKTsKICAgICAgICAgICAgaWYgKCRkYXRhICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICRkYXRhLT5iYWxsYW5jZSA9ICRyZXF1ZXN0LT5iYWxsYW5jZTsKCiAgICAgICAgICAgICAgICAkZGF0YS0+dXBkYXRlKCk7CgogICAgICAgICAgICAgICAgJGxvZ0N0cmwgPSBuZXcgTG9nQ29udHJvbGxlcigpOwogICAgICAgICAgICAgICAgJGxvZ0N0cmwtPmFkZE5ld0xvZygnYmFsbGFuY2UnLCAn2YXbjNiy2KfZhiDZhdmI2KzZiNiv24wg2qnYp9ix2KjYsSDYqNi12YjYsdiqINiv2LPYqtuMINio2YcgJyAuICRyZXF1ZXN0LT5iYWxsYW5jZSAuICcg2KrZiNmF2KfZhiDYqti624zbjNixINqp2LHYrycsICRyZXF1ZXN0LT51c2VySUQsICcnLCAnZWRpdCcpOwoKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJG5ld0FjYyA9IG5ldyBBY2NvdW50QmFsbGFuY2UoKTsKICAgICAgICAgICAgICAgICRuZXdBY2MtPmFjY291bnRfaWQgPSAkcmVxdWVzdC0+dXNlcklEOwogICAgICAgICAgICAgICAgJG5ld0FjYy0+YmFsbGFuY2UgPSAkcmVxdWVzdC0+YmFsbGFuY2U7CiAgICAgICAgICAgICAgICAkbmV3QWNjLT5zYXZlKCk7CiAgICAgICAgICAgICAgICAkbG9nQ3RybC0+YWRkTmV3TG9nKCdiYWxsYW5jZScsICfZhduM2LLYp9mGINmF2YjYrNmI2K/bjCDaqdin2LHYqNixINio2LXZiNix2Kog2K/Ys9iq24wg2KjZhyAnIC4gJHJlcXVlc3QtPmJhbGxhbmNlIC4gJyDYqtmI2YXYp9mGINiq2LrbjNuM2LEg2qnYsdivJywgJHJlcXVlc3QtPnVzZXJJRCwgJycsICdlZGl0Jyk7CgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBcTG9nOjppbmZvKCJUaHJvd2FibGUgJHRoIik7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKCdTZXJ2ZXIgRXJyb3InLCA1MDApOwogICAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXROZXdEb2xsYXJBY2NvdW50QmFsbGFuY2UoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkZGF0YSA9IEFjY291bnRCYWxsYW5jZTo6d2hlcmUoJ2FjY291bnRfaWQnLCAkcmVxdWVzdC0+dXNlcklEKS0+Zmlyc3QoKTsKICAgICAgICAgICAgaWYgKCRkYXRhICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICRkYXRhLT5hY2NvdW50X2JhbGxhbmNlX2luX2RvbGxhciA9ICRyZXF1ZXN0LT5iYWxsYW5jZTsKCiAgICAgICAgICAgICAgICAkZGF0YS0+dXBkYXRlKCk7CgogICAgICAgICAgICAgICAgJGxvZ0N0cmwgPSBuZXcgTG9nQ29udHJvbGxlcigpOwogICAgICAgICAgICAgICAgJGxvZ0N0cmwtPmFkZE5ld0xvZygnYmFsbGFuY2UnLCAn2YXbjNiy2KfZhiDZhdmI2KzZiNiv24wg2K/ZhNin2LHbjCDaqdin2LHYqNixINio2LXZiNix2Kog2K/Ys9iq24wg2KjZhyAnIC4gJHJlcXVlc3QtPmJhbGxhbmNlIC4gJyDYr9mE2KfYsSDYqti624zbjNixINqp2LHYrycsICRyZXF1ZXN0LT51c2VySUQsICcnLCAnZWRpdCcpOwoKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJG5ld0FjYyA9IG5ldyBBY2NvdW50QmFsbGFuY2UoKTsKICAgICAgICAgICAgICAgICRuZXdBY2MtPmFjY291bnRfaWQgPSAkcmVxdWVzdC0+dXNlcklEOwogICAgICAgICAgICAgICAgJG5ld0FjYy0+YWNjb3VudF9iYWxsYW5jZV9pbl9kb2xsYXIgPSAkcmVxdWVzdC0+YmFsbGFuY2U7CiAgICAgICAgICAgICAgICAkbmV3QWNjLT5zYXZlKCk7CiAgICAgICAgICAgICAgICAkbG9nQ3RybC0+YWRkTmV3TG9nKCdiYWxsYW5jZScsICfZhduM2LLYp9mGINmF2YjYrNmI2K/bjCDYr9mE2KfYsduMINqp2KfYsdio2LEg2KjYtdmI2LHYqiDYr9iz2KrbjCDYqNmHICcgLiAkcmVxdWVzdC0+YmFsbGFuY2UgLiAnINiv2YTYp9ixINiq2LrbjNuM2LEg2qnYsdivJywgJHJlcXVlc3QtPnVzZXJJRCwgJycsICdlZGl0Jyk7CgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBcTG9nOjppbmZvKCJUaHJvd2FibGUgJHRoIik7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKCdTZXJ2ZXIgRXJyb3InLCA1MDApOwogICAgICAgIH0KICAgIH0KICAgIC8vLyBBZ2VudCBGdW5jdGlvbnMKICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRMb2dnZWRVc2VyQmFsbGFuY2NlKCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkdXNlcklkID0gYXV0aCgnc2FuY3R1bScpLT51c2VyKCktPmFjY291bnRfaWQ7CiAgICAgICAgICAgICRkYXRhID0gQWNjb3VudEJhbGxhbmNlOjp3aGVyZSgnYWNjb3VudF9pZCcsICR1c2VySWQpLT5maXJzdCgpOwogICAgICAgICAgICBpZiAoISRkYXRhKSB7CiAgICAgICAgICAgICAgICAkbmV3QWNjID0gbmV3IEFjY291bnRCYWxsYW5jZSgpOwogICAgICAgICAgICAgICAgJG5ld0FjYy0+YWNjb3VudF9pZCA9IGF1dGgoJ3NhbmN0dW0nKS0+dXNlcigpLT5hY2NvdW50X2lkOwogICAgICAgICAgICAgICAgJG5ld0FjYy0+YWNjb3VudF9iYWxsYW5jZV9pbl9kb2xsYXIgPSAwOwogICAgICAgICAgICAgICAgJG5ld0FjYy0+YmFsbGFuY2UgPSAwOwogICAgICAgICAgICAgICAgJG5ld0FjYy0+c2F2ZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuICRuZXdBY2M7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICRkYXRhOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIFxMb2c6OmluZm8oIiR0aCIpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihmYWxzZSwgNTAwKTsKICAgICAgICB9CiAgICB9CiAgICAvLy8gY2hlY2sgIGRvbGxhclBheSBpcyB2YWxpZCBvciBub3QKICAgIHB1YmxpYyBmdW5jdGlvbiBjaGVja0RvbGxhclBheSgpCiAgICB7CiAgICAgICAgJHRyU2V0dGluZ0NudHJsID0gbmV3IFRyYW5zYWN0aW9uU2V0dGluZ0NvbnRyb2xsZXIoKTsKCiAgICAgICAgcmV0dXJuICR0clNldHRpbmdDbnRybC0+Z2V0RG9sbG9yVHJhbnNhY3Rpb25TZXR0aW5nKCk7CiAgICB9Cn0K