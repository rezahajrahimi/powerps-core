<?php
bolt_decrypt( __FILE__ , 'Qb7vXH'); return 0;
##!!!##Cm5hbWVzcGFjZSBBcHBcSHR0cFxDb250cm9sbGVyczsKCnVzZSBBcHBcSHR0cFxDb250cm9sbGVyc1xDdXN0b21UZXh0Q29udHJvbGxlcjsKdXNlIEFwcFxNb2RlbHNcTWFpbk1lbnVJdGVtOwp1c2UgQXBwXE1vZGVsc1xQcm9kdWN0Q2F0ZWdvcnk7CnVzZSBBcHBcTW9kZWxzXFRyYW5zYWN0aW9uU2V0dGluZzsKdXNlIEFwcFxTZXJ2aWNlc1xUZWxlZ3JhbU1lc3NhZ2VGb3JtYXR0ZXI7CnVzZSBBcHBcU2VydmljZXNcVGVsZWdyYW1TZXJ2aWNlOwp1c2UgSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3Q7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcQ2FyYm9uOwp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcQ2FjaGU7CnVzZSBTeW1mb255XENvbXBvbmVudFxEb21DcmF3bGVyXENyYXdsZXI7CgpjbGFzcyBHZW5lcmFsQ29udHJvbGxlciBleHRlbmRzIENvbnRyb2xsZXIKewogICAgcHJpdmF0ZSBDdXN0b21UZXh0Q29udHJvbGxlciAkY3VzdG9tVGV4dEN0cmw7CiAgICBwcml2YXRlIFRlbGVncmFtU2VydmljZSAkdGVsZWdyYW1TZXJ2aWNlOwogICAgcHJpdmF0ZSBBY2NvdW50QmFsbGFuY2VDb250cm9sbGVyICRhY2NCbEN0cmw7CiAgICBwcml2YXRlIFJlZmVycmFsV2FsbGV0Q29udHJvbGxlciAkcmVmZXJyYWxDbnRybDsKICAgIHByaXZhdGUgUHJvZHVjdENhdGVnb3J5Q29udHJvbGxlciAkcHJDYXRDbnRybDsKICAgIHByaXZhdGUgUGFubmVsQ29udHJvbGxlciAkcGFuZWxDbnRybDsKICAgIHByaXZhdGUgTWFpbk1lbnVJdGVtQ29udHJvbGxlciAkbWVudUl0ZW1DbnRybDsKICAgIHByaXZhdGUgUGF5bWVudFR5cGVDb250cm9sbGVyICRweW1udENudHJsOwogICAgcHJpdmF0ZSBQYXltZW50TWVudUl0ZW1Db250cm9sbGVyICRweW1NZW5DbnRybDsKICAgIHByaXZhdGUgQ3J5cHRvUGF5bWVudENvbnRyb2xsZXIgJGNyeXB0b1B5bWVudENudHJsOwogICAgcHJpdmF0ZSBUcmFuc2FjdGlvbkNvbnRyb2xsZXIgJHRyQ250cmw7CiAgICBwcml2YXRlIFRyYW5zYWN0aW9uU2V0dGluZ0NvbnRyb2xsZXIgJHRyU2V0dGluZ0NudHJsOwogICAgcHJpdmF0ZSBCaWxsQ29udHJvbGxlciAkYmlsbENudHJsOwogICAgcHJpdmF0ZSBNYWluTWVudUl0ZW0gJG1haW5NZW51SXRlbTsKICAgIHByaXZhdGUgUHJvZHVjdENhdGVnb3J5ICRwcm9kdWN0Q2F0ZWdvcnk7CiAgICBwcml2YXRlIFRyYW5zYWN0aW9uU2V0dGluZyAkdHJTZXR0aW5nOwogICAgcHJpdmF0ZSBDaGFubmVsTG9ja01lbnVJdGVtQ29udHJvbGxlciAkY2hhbm5lbExvY2tNZW51SXRlbUNudHJsOwogICAgcHJpdmF0ZSBDcm9uSm9iQ29udHJvbGxlciAkY3JvbkpvYkNudHJsOwogICAgcHJpdmF0ZSBHaWZ0Q2FyZE1lbnVJdGVtQ29udHJvbGxlciAkZ2lmdENhcmRNZW51SXRlbUNudHJsOwogICAgcHJpdmF0ZSBTZXR0aW5nQ29udHJvbGxlciAkc2V0dGluZ0NudHJsOwogICAgcHVibGljIGZ1bmN0aW9uIF9fY29uc3RydWN0KCkKICAgIHsKICAgICAgICAkdGhpcy0+Y3VzdG9tVGV4dEN0cmwgICAgICAgICAgID0gbmV3IEN1c3RvbVRleHRDb250cm9sbGVyKCk7CiAgICAgICAgJHRoaXMtPnRlbGVncmFtU2VydmljZSAgICAgICAgICA9IG5ldyBUZWxlZ3JhbVNlcnZpY2UoKTsKICAgICAgICAkdGhpcy0+YWNjQmxDdHJsICAgICAgICAgICAgICAgID0gbmV3IEFjY291bnRCYWxsYW5jZUNvbnRyb2xsZXIoKTsKICAgICAgICAkdGhpcy0+cmVmZXJyYWxDbnRybCAgICAgICAgICAgID0gbmV3IFJlZmVycmFsV2FsbGV0Q29udHJvbGxlcigpOwogICAgICAgICR0aGlzLT5wckNhdENudHJsICAgICAgICAgICAgICAgPSBuZXcgUHJvZHVjdENhdGVnb3J5Q29udHJvbGxlcigpOwogICAgICAgICR0aGlzLT5wYW5lbENudHJsICAgICAgICAgICAgICAgPSBuZXcgUGFubmVsQ29udHJvbGxlcigpOwogICAgICAgICR0aGlzLT5tZW51SXRlbUNudHJsICAgICAgICAgICAgPSBuZXcgTWFpbk1lbnVJdGVtQ29udHJvbGxlcigpOwogICAgICAgICR0aGlzLT5weW1udENudHJsICAgICAgICAgICAgICAgPSBuZXcgUGF5bWVudFR5cGVDb250cm9sbGVyKCk7CiAgICAgICAgJHRoaXMtPnB5bU1lbkNudHJsICAgICAgICAgICAgICA9IG5ldyBQYXltZW50TWVudUl0ZW1Db250cm9sbGVyKCk7CiAgICAgICAgJHRoaXMtPmNyeXB0b1B5bWVudENudHJsICAgICAgICA9IG5ldyBDcnlwdG9QYXltZW50Q29udHJvbGxlcigpOwogICAgICAgICR0aGlzLT50ckNudHJsICAgICAgICAgICAgICAgICAgPSBuZXcgVHJhbnNhY3Rpb25Db250cm9sbGVyKCk7CiAgICAgICAgJHRoaXMtPmJpbGxDbnRybCAgICAgICAgICAgICAgICA9IG5ldyBCaWxsQ29udHJvbGxlcigpOwogICAgICAgICR0aGlzLT5tYWluTWVudUl0ZW0gICAgICAgICAgICAgPSBuZXcgTWFpbk1lbnVJdGVtKCk7CiAgICAgICAgJHRoaXMtPnByb2R1Y3RDYXRlZ29yeSAgICAgICAgICA9IG5ldyBQcm9kdWN0Q2F0ZWdvcnkoKTsKICAgICAgICAkdGhpcy0+dHJTZXR0aW5nICAgICAgICAgICAgICAgID0gbmV3IFRyYW5zYWN0aW9uU2V0dGluZygpOwogICAgICAgICR0aGlzLT50clNldHRpbmdDbnRybCAgICAgICAgICAgPSBuZXcgVHJhbnNhY3Rpb25TZXR0aW5nQ29udHJvbGxlcigpOwogICAgICAgICR0aGlzLT5jaGFubmVsTG9ja01lbnVJdGVtQ250cmwgPSBuZXcgQ2hhbm5lbExvY2tNZW51SXRlbUNvbnRyb2xsZXIoKTsKICAgICAgICAkdGhpcy0+Y3JvbkpvYkNudHJsICAgICAgICAgICAgID0gbmV3IENyb25Kb2JDb250cm9sbGVyKCk7CiAgICAgICAgJHRoaXMtPmdpZnRDYXJkTWVudUl0ZW1DbnRybCAgICA9IG5ldyBHaWZ0Q2FyZE1lbnVJdGVtQ29udHJvbGxlcigpOwogICAgICAgICR0aGlzLT5zZXR0aW5nQ250cmwgICAgICAgICAgICAgPSBuZXcgU2V0dGluZ0NvbnRyb2xsZXIoKTsKICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiBib290X3NlZWRpbmdfZGF0YSgpCiAgICB7CgogICAgICAgIC8vIGFkZCBkZWZhdWx0IG1lbnUgaXRlbXMKICAgICAgICAkdGhpcy0+bWVudUl0ZW1DbnRybC0+c2VlZCgpOwogICAgICAgIC8vIGFkZCBkZWZhdWx0IGNoYW5uZWwgbG9jayBtZW51IGl0ZW1zCiAgICAgICAgJHRoaXMtPmNoYW5uZWxMb2NrTWVudUl0ZW1DbnRybC0+c2VlZCgpOwogICAgICAgIC8vIGFkZCBkZWZhdWx0IGNyb24gam9icwogICAgICAgICR0aGlzLT5jcm9uSm9iQ250cmwtPnNlZWQoKTsKICAgICAgICAvLyBhZGQgZGVmYXVsdCBjcnlwdG8gcGF5bWVudAogICAgICAgICR0aGlzLT5jcnlwdG9QeW1lbnRDbnRybC0+Y3JlYXRlTm93UGF5bWVudERhdGEoKTsKICAgICAgICAvLyBhZGQgZGVmYXVsdCBnaWZ0IGNhcmQgbWVudSBpdGVtcwogICAgICAgICR0aGlzLT5naWZ0Q2FyZE1lbnVJdGVtQ250cmwtPnNlZWQoKTsKICAgICAgICAvLyBhZGQgZGVmYXVsdCBzZXR0aW5nCiAgICAgICAgJHRoaXMtPnNldHRpbmdDbnRybC0+c2VlZCgpOwogICAgICAgIC8vIGFkZCBkZWZhdWx0IHBheW1lbnQgdHlwZXMKICAgICAgICAkdGhpcy0+cHltbnRDbnRybC0+c2VlZCgpOwogICAgICAgIC8vIGFkZCBkZWZhdWx0IHBheW1lbnQgbWVudSBpdGVtcwogICAgICAgICR0aGlzLT5weW1NZW5DbnRybC0+c2VlZCgpOwogICAgICAgIC8vIGFkZCBkZWZhdWx0IGN1c3RvbSB0ZXh0cwogICAgICAgICR0aGlzLT5jdXN0b21UZXh0Q3RybC0+c2VlZCgpOwogICAgICAgIC8vIGFkZCBkZWZhdWx0IHRyYW5zYWN0aW9uIHNldHRpbmdzCiAgICAgICAgJHRoaXMtPnRyU2V0dGluZ0NudHJsLT5zZWVkKCk7CgogICAgfQogICAgcHVibGljIGZ1bmN0aW9uIGdldERhc2hib2FyZEFuYWx5dGljcygpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGJvdFVzZXRDbnRybCAgICAgICAgICAgICAgID0gbmV3IEJvdFVzZXJDb250cm9sbGVyKCk7CiAgICAgICAgICAgICRnZXRMYXN0MTBVc2VycyAgICAgICAgICAgICA9ICRib3RVc2V0Q250cmwtPmdldExhc3QxMFVzZXJzKCk7CiAgICAgICAgICAgICRsb2dDbnRybCAgICAgICAgICAgICAgICAgICA9IG5ldyBMb2dDb250cm9sbGVyKCk7CiAgICAgICAgICAgICRnZXRUb3AyMExvZyAgICAgICAgICAgICAgICA9ICRsb2dDbnRybC0+Z2V0QWxsTG9ncygyMCk7CiAgICAgICAgICAgICR0cmFuc2FjdGlvbkNudHJsICAgICAgICAgICA9IG5ldyBUcmFuc2FjdGlvbkNvbnRyb2xsZXIoKTsKICAgICAgICAgICAgJGxhc3QxMENvbmZpcm1lZFRyYW5zYWN0aW9uID0gJHRyYW5zYWN0aW9uQ250cmwtPmdldENvbmZpcm1lZFRyYW5zYWN0aW9ucygxMCk7CiAgICAgICAgICAgICR1bkNvbmZpcm1lZFRyYW5zYWN0aW9uICAgICA9ICR0cmFuc2FjdGlvbkNudHJsLT5nZXRVbkNvbmZpcm1lZFRyYW5zYWN0aW9ucygxMDAwKTsKICAgICAgICAgICAgJHByb2R1Y3RDYXRDbnRybCAgICAgICAgICAgID0gbmV3IFByb2R1Y3RDYXRlZ29yeUNvbnRyb2xsZXIoKTsKICAgICAgICAgICAgJG1vc3RTZWxsZWRQcm9kdWN0Q2F0ZWdvcnkgID0gJHByb2R1Y3RDYXRDbnRybC0+bW9zdFNlbGxlZFByb2R1Y3RDYXRlZ29yeSgxMCk7CiAgICAgICAgICAgICRwckNudHJsICAgICAgICAgICAgICAgICAgICA9IG5ldyBQcm9kdWN0Q29udHJvbGxlcigpOwogICAgICAgICAgICAkbGFzdDEwUHJvZHVjdFNlbGxlZCAgICAgICAgPSAkcHJDbnRybC0+Z2V0TGFzdFByb2R1Y3RTZWxsZWQoMTApOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbigKICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAnTGFzdDEwVXNlcicgICAgICAgICAgICAgICAgID0+ICRnZXRMYXN0MTBVc2VycywKICAgICAgICAgICAgICAgICAgICAnTGFzdDIwTG9ncycgICAgICAgICAgICAgICAgID0+ICRnZXRUb3AyMExvZywKICAgICAgICAgICAgICAgICAgICAnTGFzdDEwQ29uZmlybWVkVHJhbnNhY3Rpb24nID0+ICRsYXN0MTBDb25maXJtZWRUcmFuc2FjdGlvbiwKICAgICAgICAgICAgICAgICAgICAnVW5Db25maXJtZWRUcmFuc2FjdGlvbicgICAgID0+ICR1bkNvbmZpcm1lZFRyYW5zYWN0aW9uLAogICAgICAgICAgICAgICAgICAgICdNb3N0U2VsbGVkUHJvZHVjdENhdGVnb3J5JyAgPT4gJG1vc3RTZWxsZWRQcm9kdWN0Q2F0ZWdvcnksCiAgICAgICAgICAgICAgICAgICAgJ2xhc3QxMFByb2R1Y3RTZWxsZWQnICAgICAgICA9PiAkbGFzdDEwUHJvZHVjdFNlbGxlZCwKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAyMDAsCiAgICAgICAgICAgICk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgXExvZzo6aW5mbygiZXJyb3Igb24gZ2V0RGFzaGJvYXJkQW5hbHl0aWNzLT4gJHRoIik7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKG51bGwsIDUwMCk7CiAgICAgICAgfQogICAgfQogICAgcHVibGljIGZ1bmN0aW9uIGdldEFnZW50RGFzaGJvYXJkQW5hbHl0aWNzKCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkYWNjQ250cmwgICAgID0gbmV3IEFjY291bnRCYWxsYW5jZUNvbnRyb2xsZXIoKTsKICAgICAgICAgICAgJGFjY0JhbGxhbmNlICA9ICRhY2NDbnRybC0+Z2V0TG9nZ2VkVXNlckJhbGxhbmNjZSgpOwogICAgICAgICAgICAkYWdlbnRQckNudHJsID0gbmV3IEFnZW50UHJvZHVjdENvbnRyb2xsZXIoKTsKICAgICAgICAgICAgJHByb2R1Y3RzICAgICA9ICRhZ2VudFByQ250cmwtPmdldFByb2R1Y3RzT2ZMb2dnZWRBZ2VudCgpOwogICAgICAgICAgICAvLyAkYm91Z2h0UHJvZHVjdHMgPSAgJGFnZW50UHJDbnRybC0+Z2V0QWdlbnRTZWxsZWRQcm9kdWN0cygxMCk7CiAgICAgICAgICAgICRsb2dDbnRybCAgICA9IG5ldyBMb2dDb250cm9sbGVyKCk7CiAgICAgICAgICAgICRnZXRUb3AyMExvZyA9ICRsb2dDbnRybC0+Z2V0QWxsTG9nc09mTG9nZ2VkQWdlbnQoMjApOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbigKICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAnYWNjQmFsbGFuY2UnID0+ICRhY2NCYWxsYW5jZSwKICAgICAgICAgICAgICAgICAgICAncHJvZHVjdHMnICAgID0+ICRwcm9kdWN0cywKICAgICAgICAgICAgICAgICAgICAvLyAnYm91Z2h0UHJvZHVjdHMnID0+ICRib3VnaHRQcm9kdWN0cywKICAgICAgICAgICAgICAgICAgICAnTGFzdDIwTG9ncycgID0+ICRnZXRUb3AyMExvZywKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAyMDAsCiAgICAgICAgICAgICk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgXExvZzo6aW5mbygiZXJyb3Igb24gZ2V0QWdlbnREYXNoYm9hcmRBbmFseXRpY3MtPiAkdGgiKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24obnVsbCwgNTAwKTsKICAgICAgICB9CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QWdlbnRQYXltZW50V2F5cygpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHB5bW50Q250cmwgICAgICAgICAgID0gbmV3IFBheW1lbnRUeXBlQ29udHJvbGxlcigpOwogICAgICAgICAgICAkcHltZW50VHlwZSAgICAgICAgICAgPSAkcHltbnRDbnRybC0+Z2V0QWxsQWN0aXZlUGF5bWVudFR5cGVzV2l0aFphcmlucGFsTWVyY2hlbnRJREZpbHRlcigpOwogICAgICAgICAgICAkY3J5cHRvUHltZW50Q250cmwgICAgPSBuZXcgQ3J5cHRvUGF5bWVudENvbnRyb2xsZXIoKTsKICAgICAgICAgICAgJGNyeXB0aVB5bWVudElzQWN0aXZlID0gJGNyeXB0b1B5bWVudENudHJsLT5nZXROb3dQYXltZW50c1N0YXR1cygpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbJ2FjdGl2ZV9wYXltZW50JyA9PiAkcHltZW50VHlwZSwgJ2NyeXB0b19wYXltZW50X3N0YXR1cycgPT4gJGNyeXB0aVB5bWVudElzQWN0aXZlXSwgMjAwKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBcTG9nOjppbmZvKCJlcnJvciBvbiBnZXRBZ2VudFBheW1lbnRXYXlzLT4gJHRoIik7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKG51bGwsIDUwMCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRVc2VyRGFzaGJvYXJkQW5hbHl0aWNzKCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkYWNjQ250cmwgICAgPSBuZXcgQWNjb3VudEJhbGxhbmNlQ29udHJvbGxlcigpOwogICAgICAgICAgICAkYWNjQmFsbGFuY2UgPSAkYWNjQ250cmwtPmdldExvZ2dlZFVzZXJCYWxsYW5jY2UoKTsKICAgICAgICAgICAgJHByQ2F0Q250cmwgID0gbmV3IFByb2R1Y3RDYXRlZ29yeUNvbnRyb2xsZXIoKTsKCiAgICAgICAgICAgICRwcm9kdWN0cyA9ICRwckNhdENudHJsLT5nZXRBbGxBY3RpdmVQcm9kY3RDYXRlZ29yeU9yZGVyQnlQcmljZSgpOwogICAgICAgICAgICAvLyAkYm91Z2h0UHJvZHVjdHMgPSAgJGFnZW50UHJDbnRybC0+Z2V0QWdlbnRTZWxsZWRQcm9kdWN0cygxMCk7CiAgICAgICAgICAgICRsb2dDbnRybCAgICA9IG5ldyBMb2dDb250cm9sbGVyKCk7CiAgICAgICAgICAgICRnZXRUb3AyMExvZyA9ICRsb2dDbnRybC0+Z2V0QWxsTG9nc09mTG9nZ2VkQWdlbnQoMjApOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbigKICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAnYWNjQmFsbGFuY2UnID0+ICRhY2NCYWxsYW5jZSwKICAgICAgICAgICAgICAgICAgICAncHJvZHVjdHMnICAgID0+ICRwcm9kdWN0cywKICAgICAgICAgICAgICAgICAgICAvLyAnYm91Z2h0UHJvZHVjdHMnID0+ICRib3VnaHRQcm9kdWN0cywKICAgICAgICAgICAgICAgICAgICAnTGFzdDIwTG9ncycgID0+ICRnZXRUb3AyMExvZywKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAyMDAsCiAgICAgICAgICAgICk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgXExvZzo6aW5mbygiZXJyb3Igb24gZ2V0QWdlbnREYXNoYm9hcmRBbmFseXRpY3MtPiAkdGgiKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24obnVsbCwgNTAwKTsKICAgICAgICB9CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0X3phcmlucGFsX3BheW1lbnRfbGlua19mcm9tX2h0bWwoJGh0bWxUZXh0KQogICAgewogICAgICAgIC8vICRodG1sVGV4dCA9ICc8IURPQ1RZUEUgaHRtbD4uLi4nOyAvLyB5b3VyIEhUTUwgdGV4dCBoZXJlCgogICAgICAgICRjcmF3bGVyID0gbmV3IENyYXdsZXIoKTsKICAgICAgICAkY3Jhd2xlci0+YWRkSHRtbENvbnRlbnQoJGh0bWxUZXh0LCAnVVRGLTgnKTsKCiAgICAgICAgJGZvcm1UYWcgPSAkY3Jhd2xlci0+ZmlsdGVyKCdmb3JtJyktPmZpcnN0KCk7CgogICAgICAgIGlmICgkZm9ybVRhZykgewogICAgICAgICAgICAkYWN0aW9uVXJsID0gJGZvcm1UYWctPmF0dHIoJ2FjdGlvbicpOwogICAgICAgICAgICByZXR1cm4gJGFjdGlvblVybDsgLy8gT3V0cHV0OiBodHRwczovL3d3dy56YXJpbnBhbC5jb20vcGcvU3RhcnRQYXkvQTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMGwzNTN3eDYyCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRfbm93cGF5bWVudF9wYXltZW50X2xpbmtfZnJvbV9odG1sKCRodG1sVGV4dCkKICAgIHsKICAgICAgICAkY3Jhd2xlciA9IG5ldyBDcmF3bGVyKCk7CiAgICAgICAgJGNyYXdsZXItPmFkZEh0bWxDb250ZW50KCRodG1sVGV4dCwgJ1VURi04Jyk7CgogICAgICAgICRtZXRhVGFnID0gJGNyYXdsZXItPmZpbHRlcignbWV0YVtodHRwLWVxdWl2PSJyZWZyZXNoIl0nKS0+Zmlyc3QoKTsKCiAgICAgICAgaWYgKCRtZXRhVGFnKSB7CiAgICAgICAgICAgICRyZWRpcmVjdExpbmsgPSAkbWV0YVRhZy0+YXR0cignY29udGVudCcpOwogICAgICAgICAgICAkcmVkaXJlY3RMaW5rID0gZXhwbG9kZSgnOycsICRyZWRpcmVjdExpbmspOwogICAgICAgICAgICAkcmVkaXJlY3RMaW5rID0gdHJpbSgkcmVkaXJlY3RMaW5rWzFdKTsKICAgICAgICAgICAgJHJlZGlyZWN0TGluayA9IHN0cl9yZXBsYWNlKCJ1cmw9JyIsICcnLCAkcmVkaXJlY3RMaW5rKTsKICAgICAgICAgICAgJHJlZGlyZWN0TGluayA9IHN0cl9yZXBsYWNlKCInIiwgJycsICRyZWRpcmVjdExpbmspOwogICAgICAgICAgICByZXR1cm4gJHJlZGlyZWN0TGluazsgLy8gT3V0cHV0OiBodHRwczovL25vd3BheW1lbnRzLmlvL3BheW1lbnQvP2lpZD01MDk2MTAwMTMwCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJGxpbmtUYWcgPSAkY3Jhd2xlci0+ZmlsdGVyKCdhJyktPmZpcnN0KCk7CiAgICAgICAgICAgIGlmICgkbGlua1RhZykgewogICAgICAgICAgICAgICAgJHJlZGlyZWN0TGluayA9ICRsaW5rVGFnLT5hdHRyKCdocmVmJyk7CiAgICAgICAgICAgICAgICByZXR1cm4gJHJlZGlyZWN0TGluazsgLy8gT3V0cHV0OiBodHRwczovL25vd3BheW1lbnRzLmlvL3BheW1lbnQvP2lpZD01MDk2MTAwMTMwCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gcmV0dXJuX21haW5fbWVudV9pdGVtcygkY2hhdF9pZCwgJG1lc3NhZ2UpCiAgICB7CiAgICAgICAgJG1lbnUgICAgID0gbmV3IE1haW5NZW51SXRlbUNvbnRyb2xsZXIoKTsKICAgICAgICAkbWVudUl0ZW0gPSAkbWVudS0+Z2V0QWxsQWN0aXZhdGVkTWFpbk1lbnVJdGVtcygpOwogICAgICAgICRvcHIgICAgICA9IFtdOwoKICAgICAgICBpZiAoJG1lbnVJdGVtWzBdLT5uYW1lID09ICfYrtix24zYryDYp9i02KrYsdin2qknKSB7CiAgICAgICAgICAgIGFycmF5X3B1c2goJG9wciwgW1sndGV4dCcgPT4gJG1lbnVJdGVtWzBdLT5hbGlhc19uYW1lLCAnY2FsbGJhY2tfZGF0YScgPT4gIm1haW4teyRtZW51SXRlbVswXS0+aWR9Il1dKTsKICAgICAgICAgICAgJG1lbnVJdGVtID0gJG1lbnVJdGVtLT5zbGljZSgxKTsKICAgICAgICB9CgogICAgICAgICRjb3VudE9mTWVudUl0ZW0gPSBjb3VudCgkbWVudUl0ZW0pOwogICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICRjb3VudE9mTWVudUl0ZW07ICRpICs9IDIpIHsKICAgICAgICAgICAgJHBhaXIgPSAkbWVudUl0ZW0tPnNsaWNlKCRpLCAyKTsKICAgICAgICAgICAgJHJvdyAgPSBbXTsKCiAgICAgICAgICAgIGZvcmVhY2ggKCRwYWlyIGFzICRpdGVtKSB7CiAgICAgICAgICAgICAgICAkcm93W10gPSBbCiAgICAgICAgICAgICAgICAgICAgJ3RleHQnICAgICAgICAgID0+ICRpdGVtLT5hbGlhc19uYW1lLAogICAgICAgICAgICAgICAgICAgICdjYWxsYmFja19kYXRhJyA9PiAibWFpbi17JGl0ZW0tPmlkfSIsCiAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoISBlbXB0eSgkcm93KSkgewogICAgICAgICAgICAgICAgJG9wcltdID0gJHJvdzsKICAgICAgICAgICAgfQogICAgICAgIH0KCi8vICRzZXR0aW5nQ3RybCA9IG5ldyBTZXR0aW5nQ29udHJvbGxlcigpOwovLyAkdGhpcy0+bWVzc2FnZSA9ICRzZXR0aW5nQ3RybC0+Z2V0V2VsY29tZU1lc3NhZ2UoKTsKCiAgICAgICAgJHJlc3VsdCA9ICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPnNlbmRNZXNzYWdlV2l0aEtleWJvYXJkKCRjaGF0X2lkLCAkbWVzc2FnZSwgJG9wcik7CgogICAgICAgIHJldHVybiAnJzsKCiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gcmV0dXJuX2V4aXN0X2hpZGRpZnlfY29uZmlnX3RlbGVncmFtX3RleHQoJHNlbGVjdGVkUHJvZHVjdCwgJHNlbGVjdGVkUHJvZHVjdENhdGVnb3J5LCAkcGFubmVsLCAkY2hhdF9pZCkKICAgIHsKICAgICAgICAkaGlkZGlmY0NudHJsICAgICAgICAgPSBuZXcgSGlkZGlmeVBhbm5lbENvbnRyb2xsZXIoKTsKICAgICAgICAkcG5sQ250cmwgICAgICAgICAgICAgPSBuZXcgUGFubmVsQ29udHJvbGxlcigpOwogICAgICAgICR1c2VyUGFubmVsTGluayAgICAgICA9ICRoaWRkaWZjQ250cmwtPmdldF9oaWRkaWZ5X3N1YnNjcmlwdGlvbl9saW5rKCRwYW5uZWwtPnVzZXJfbGluaywgJHNlbGVjdGVkUHJvZHVjdC0+cGFuZWxfbGluayk7CiAgICAgICAgJHVzZXJTdWJzY3JpcHRpb25MSW5rID0gJGhpZGRpZmNDbnRybC0+Z2V0X2hpZGRpZnlfc3Vic2NyaXB0aW9uX2xpbmsoJHBhbm5lbC0+dXNlcl9saW5rLCAkc2VsZWN0ZWRQcm9kdWN0LT5zdWJzY3JpcHRpb25fbGluayk7CiAgICAgICAgJGltYWdlICAgICAgICAgICAgICAgID0gJHBubENudHJsLT5nZW5lcmF0ZVFyTU9DKCR1c2VyU3Vic2NyaXB0aW9uTEluayk7CiAgICAgICAgJHRleHQgICAgICAgICAgICAgICAgID0gJyc7CiAgICAgICAgJGFnZW50Q250cmwgICAgICAgICAgID0gbmV3IEFnZW50UHJvZHVjdENvbnRyb2xsZXIoKTsKICAgICAgICAkY29uZmlnU3RhdHVzICAgICAgICAgPSAkYWdlbnRDbnRybC0+Z2V0Qm91Z2h0UHJvZHVjdHNTdGF0dXNGcm9tU2VydmVyQnlJZCgkc2VsZWN0ZWRQcm9kdWN0LT5pZCk7CgogICAgICAgIC8vINix2YjYtCAxOiDYqNix2LHYs9uMINmG2YjYuSDYr9in2K/ZhwogICAgICAgIGlmIChpc19zdHJpbmcoJGNvbmZpZ1N0YXR1cykpIHsKICAgICAgICAgICAgJGNvbmZpZ1N0YXR1cyA9IGpzb25fZGVjb2RlKCRjb25maWdTdGF0dXMsIHRydWUpOwogICAgICAgIH0KICAgICAgICAvLyDbjNinCiAgICAgICAgLy8g2LHZiNi0IDI6INit2LDZgSBqc29uX2RlY29kZQogICAgICAgIC8vICRjb25maWdTdGF0dXMgPSAkY29uZmlnU3RhdHVzOwoKICAgICAgICBpZiAoJGNvbmZpZ1N0YXR1cyAhPSBudWxsKSB7CiAgICAgICAgICAgICRlbmFibGVUZXh0ID0gJGNvbmZpZ1N0YXR1c1snZW5hYmxlJ10gPT0gdHJ1ZSA/ICfZgdi52KfZhCcgOiAn2LrbjNixINmB2LnYp9mEJzsKICAgICAgICAgICAgJHRleHQgICAgICAgPSAi8J+TpiDZiNi22LnbjNiqINio2LPYqtmHOiB7JGVuYWJsZVRleHR9IFxyXG4iOwogICAgICAgICAgICAkdXNhZ2VHQiAgICA9ICRjb25maWdTdGF0dXNbJ2N1cnJlbnRfdXNhZ2VfR0InXTsKICAgICAgICAgICAgJHVzYWdlR0IgICAgPSByb3VuZCgkdXNhZ2VHQiwgMik7CiAgICAgICAgICAgICRsaW1pdEdCICAgID0gJGNvbmZpZ1N0YXR1c1sndXNhZ2VfbGltaXRfR0InXTsKICAgICAgICAgICAgJHRleHQgLj0gIvCfk4og2YXbjNiy2KfZhiDYrdis2YUg2YXYtdix2YEg2LTYr9mHOiAgeyR1c2FnZUdCfUdCINin2LIgeyRsaW1pdEdCfUdCIFxyXG4iOwoKICAgICAgICAgICAgJHN0YXJ0RGF0ZSAgICA9ICRjb25maWdTdGF0dXNbJ3N0YXJ0X2RhdGUnXTsKICAgICAgICAgICAgJHN0YXJ0RGF0ZSAgICA9IENhcmJvbjo6cGFyc2UoJHN0YXJ0RGF0ZSk7CiAgICAgICAgICAgICRwYWNrYWdlX2RheXMgPSAkY29uZmlnU3RhdHVzWydwYWNrYWdlX2RheXMnXTsKICAgICAgICAgICAgJHBhY2thZ2VfZGF5cyA9IGludHZhbCgkcGFja2FnZV9kYXlzKTsKICAgICAgICAgICAgJGV4cGlyZURhdGUgICA9IENhcmJvbjo6cGFyc2UoJHN0YXJ0RGF0ZSk7CiAgICAgICAgICAgICRleHBpcmVEYXRlLT5hZGREYXlzKCRwYWNrYWdlX2RheXMpOwoKICAgICAgICAgICAgJGV4cGlyZURhdGUgPSAkZXhwaXJlRGF0ZS0+dG9KYWxhbGkoKS0+Zm9ybWF0KCdZLm0uZCcpOwogICAgICAgICAgICAkc3RhcnREYXRlICA9ICRzdGFydERhdGUtPnRvSmFsYWxpKCktPmZvcm1hdCgnWS5tLmQnKTsKCiAgICAgICAgICAgICR0ZXh0IC49ICLwn5eT77iPINiq2KfYsduM2K4g2LTYsdmI2Lk6IHskc3RhcnREYXRlfSBcclxuIjsKICAgICAgICAgICAgJHRleHQgLj0gIuKPsyDYqtin2LHbjNiuINin2YbZgti22Kc6IHskZXhwaXJlRGF0ZX0gXHJcbiI7CiAgICAgICAgfQogICAgICAgIGlmICgkc2VsZWN0ZWRQcm9kdWN0Q2F0ZWdvcnktPnNob3dfcGFubmVsX2xpbmsgPT0gMSkgewogICAgICAgICAgICAkdGV4dCAuPSAi8J+UlyDZhNuM2YbaqSDZvtmG2YQg2LTZhdinINio2LHYp9uMINmF2LTYp9mH2K/ZhyDYp9i32YTYp9i52KfYqiDYqNiz2KrZhyDYrtix24zYr9in2LHbjCDYtNiv2Yc6XHJcbnskdXNlclBhbm5lbExpbmt9IFxyXG4iOwogICAgICAgIH0KICAgICAgICBpZiAoJHNlbGVjdGVkUHJvZHVjdENhdGVnb3J5LT5zaG93X3N1YnNjcmlwdGlvbl9saW5rID09IDEpIHsKICAgICAgICAgICAgJHRleHQgLj0gIvCflJcg2YTbjNmG2qkg2LPYp9io2LPaqdix24zZvti02YY6IFxyXG57JHVzZXJTdWJzY3JpcHRpb25MSW5rfSBcclxuIjsKICAgICAgICB9CiAgICAgICAgYXBwKCd0ZWxlZ3JhbV9ib3QnKS0+c2VuZE1lc3NhZ2UoJHRleHQsICRjaGF0X2lkLCBudWxsLCAnTWFya0Rvd24nKTsKCiAgICAgICAgJHRleHQgPSAi4oS577iPINmH2YXahtuM2YbbjNmGINi02YXYpyDZhduMINiq2YjYp9mG24zYryBRUkNvZGUg2KfYsdiz2KfZhCDYtNiv2Ycg2LHYpyDYp9iz2qnZhiDZhtmF2KfbjNuM2K8uINiv2LEg2LXZiNix2Kog2YbbjNin2LIg2KjZhyDYsdin2YfZhtmF2KfbjNuMINio2LEg2LHZiNuMINii2YXZiNiy2LQg2KfYs9iq2YHYp9iv2Ycg2KfYsiDZhNuM2YbaqSDYs9in2KjYs9qp2LHbjNm+2LTZhiDaqdmE24zaqSDaqdmG24zYry5cclxuIjsKICAgICAgICByZXR1cm4gYXBwKCd0ZWxlZ3JhbV9ib3QnKS0+aW1hZ2VNZXNzYWdlQnlMaW5rKCRpbWFnZSwgJGNoYXRfaWQsICR0ZXh0KTsKICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiBuZXdfaGlkZGlmeV9jb25maWdfdGVsZWdyYW1fdGV4dCgkc2VsZWN0ZWRQckNhdCwgJHBhbm5lbCwgJHZvbHVtZSwgJGRheSwgJGNoYXRfaWQsICRwcm9kdWN0SUQpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGhpZGRpZmNDbnRybCA9IG5ldyBIaWRkaWZ5UGFubmVsQ29udHJvbGxlcigpOwogICAgICAgICAgICAkcG5sQ250cmwgICAgID0gbmV3IFBhbm5lbENvbnRyb2xsZXIoKTsKCiAgICAgICAgICAgICRyZXEgICAgICAgICAgICA9IG5ldyBSZXF1ZXN0KCk7CiAgICAgICAgICAgICRyZXEtPmFjY291bnRJZCA9ICIkY2hhdF9pZC0kcHJvZHVjdElEIjsKICAgICAgICAgICAgJHJlcS0+cGFubmVsSUQgID0gJHNlbGVjdGVkUHJDYXQtPnBhbm5lbF9pZDsKICAgICAgICAgICAgJHJlcS0+dm9sICAgICAgID0gJHZvbHVtZTsKICAgICAgICAgICAgJHJlcS0+ZGF5ICAgICAgID0gJGRheTsKCiAgICAgICAgICAgICRuZXdVVUlEID0gJGhpZGRpZmNDbnRybC0+YWRkVXNlclRvSGlkZGlmeVBhbmVsKCRyZXEpOyAvLyBhcGkgdjIKICAgICAgICAgICAgaWYgKCRuZXdVVUlEID09IGZhbHNlKSB7CgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vICRuZXdVVUlEID0gJGhpZGRpZmNDbnRybC0+YWRkVXNlclRvSGlkZGlmeVBhbmVsT2xkQXBpKCRyZXEpOyAvLyBhcGkgdjEKCiAgICAgICAgICAgICR1c2VyTGluayA9ICRwYW5uZWwtPnVzZXJfbGluazsKICAgICAgICAgICAgLy8gY2hlY2sgJHBhbm5lbC0+dXNlcl9saW5rIGVuZGVkIHdpdGggIi8iIGlmIGJlIHJlbW92ZSBpdAogICAgICAgICAgICBpZiAoc3Vic3RyKCR1c2VyTGluaywgLTEpID09ICcvJykgewogICAgICAgICAgICAgICAgJHVzZXJMaW5rID0gc3Vic3RyKCR1c2VyTGluaywgMCwgLTEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkdXNlclN1YnNjcmlwdGlvbkxJbmsgPSAiJHVzZXJMaW5rL3skbmV3VVVJRH0vYWxsLnR4dD9uYW1lPXN1YmxpbmstdW5rbm93biZhc249dW5rbm93biZtb2RlPW5ldyI7CiAgICAgICAgICAgICR1c2VyUGFubmVsTGluayAgICAgICA9ICIkdXNlckxpbmsveyRuZXdVVUlEfS8jeyRyZXEtPmFjY291bnRJZH0iOwoKICAgICAgICAgICAgJGltYWdlID0gJHBubENudHJsLT5nZW5lcmF0ZVFyTU9DKCR1c2VyU3Vic2NyaXB0aW9uTEluayk7CiAgICAgICAgICAgICR0ZXh0ICA9ICR0aGlzLT5jdXN0b21UZXh0Q3RybC0+Z2V0VGV4dCgnYWN0aW9uLnN1YnNjcmlwdGlvbi5oaWRkaWZ5JywgWwogICAgICAgICAgICAgICAgJ3BhbmVsX2xpbmsnICAgICAgICA9PiAkdXNlclBhbm5lbExpbmssCiAgICAgICAgICAgICAgICAnc3Vic2NyaXB0aW9uX2xpbmsnID0+ICR1c2VyU3Vic2NyaXB0aW9uTEluaywKICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICRmb3JtYXR0ZXIgPSBuZXcgVGVsZWdyYW1NZXNzYWdlRm9ybWF0dGVyKCR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UpOwogICAgICAgICAgICAkdGV4dCAgICAgID0gJGZvcm1hdHRlci0+YWRkRm9ybWF0dGVkVGV4dCgnJywgJHRleHQpLT5nZXRNZXNzYWdlKCk7CiAgICAgICAgICAgIC8vIHNhdmUgYXMgZGVjdGl2YXRlIHByb2R1Y3QsIFNvIHdlIGNhbiB1c2UgaXQgaW4gZnV0dXJlIHdoZW4gdXNlciB3YW50IHRvIHJlY2hhcmdlIGl0OwogICAgICAgICAgICAkcmVzdWFsdCA9ICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPnNlbmRQaG90b0ZpbGUoJGNoYXRfaWQsICRpbWFnZSwgJHRleHQpOwoKICAgICAgICAgICAgJHJlcXVlc3QgICAgICAgICAgICAgICAgICAgICAgICA9IG5ldyBSZXF1ZXN0KCk7CiAgICAgICAgICAgICRyZXF1ZXN0LT5hY2NvdW50X2lkICAgICAgICAgICAgPSAkY2hhdF9pZDsKICAgICAgICAgICAgJHJlcXVlc3QtPnN1YnNjcmlwdGlvbl9saW5rICAgICA9ICIveyRuZXdVVUlEfS9hbGwudHh0P25hbWU9c3VibGluay11bmtub3duJmFzbj11bmtub3duJm1vZGU9bmV3IjsKICAgICAgICAgICAgJHJlcXVlc3QtPnByb2R1Y3RfY2F0ZWdvcmllc19pZCA9ICRzZWxlY3RlZFByQ2F0LT5pZDsKICAgICAgICAgICAgJHJlcXVlc3QtPnBhbmVsX2xpbmsgICAgICAgICAgICA9ICIveyRuZXdVVUlEfS8jeyRyZXEtPmFjY291bnRJZH0iOwogICAgICAgICAgICAkcmVxdWVzdC0+Y29uZmlncyAgICAgICAgICAgICAgID0gJyc7CiAgICAgICAgICAgICRyZXF1ZXN0LT5yZW1hcmsgICAgICAgICAgICAgICAgPSAiJGNoYXRfaWQtJHByb2R1Y3RJRCI7CiAgICAgICAgICAgICRwckNudHJsICAgICAgICAgICAgICAgICAgICAgICAgPSBuZXcgUHJvZHVjdENvbnRyb2xsZXIoKTsKICAgICAgICAgICAgJHByQ250cmwtPmFkZEF1dG9tYXRlZFByb2R1Y3REZXRhaWxzKCRyZXF1ZXN0KTsKICAgICAgICAgICAgcmV0dXJuICRuZXdVVUlEOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIFxMb2c6OmluZm8oImVycm9yIG9uIG5ld19oaWRkaWZ5X2NvbmZpZ190ZWxlZ3JhbV90ZXh0LT4gJHRoIik7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgfQogICAgcHVibGljIGZ1bmN0aW9uIHNlbmRfdXNpbmdfc3Vic2NyaXB0aW9uX21hbnVhbF9tZXNzYWdlKCRjaGF0X2lkLCAkcmVjaGFyZ2UgPSBudWxsLCAkcHJvZHVjdElEID0gbnVsbCkKICAgIHsKICAgICAgICAkb3ByID0gW107CiAgICAgICAgLy8gY2hlY2sgZmFxIGlzIGFjdGl2ZSBpbiBtZW51CiAgICAgICAgJGZhcUl0ZW1BbGlhc05hbWUgPSAkdGhpcy0+bWFpbk1lbnVJdGVtLT5nZXRBbGlhc05hbWVCeU5hbWUoJ9ii2YXZiNiy2LQg2KfYs9iq2YHYp9iv2Ycg2Ygg2LPZiNin2YTYp9iqINmF2KrYr9in2YjZhCcpOwogICAgICAgICRmYXFJdGVtICAgICAgICAgID0gJHRoaXMtPm1haW5NZW51SXRlbS0+aXNBY3RpdmVCeUFsaWFzTmFtZSgkZmFxSXRlbUFsaWFzTmFtZSk7CiAgICAgICAgaWYgKCRmYXFJdGVtID09IHRydWUgfHwgJGZhcUl0ZW0gPT0gMSkgewogICAgICAgICAgICAkdGV4dCA9ICR0aGlzLT5jdXN0b21UZXh0Q3RybC0+Z2V0VGV4dCgnYWN0aW9uLmhlbHAuZmFxJyk7CiAgICAgICAgICAgIGlmIChpc19hcnJheSgkdGV4dCkpIHsKICAgICAgICAgICAgICAgIC8vIHVzZSBmb3JtYXQgdGV4dCBzZXJ2aWNlCiAgICAgICAgICAgICAgICAkdGV4dCA9ICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPmZvcm1hdFRleHQoJHRleHQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRvcHJbXSA9IFsKICAgICAgICAgICAgICAgICR0ZXh0ID0+ICJ0b3R1cmlhbC1mYXFzIiwKICAgICAgICAgICAgXTsKICAgICAgICB9CiAgICAgICAgJGFwcERvd25sb2FkSXRlbUFsaWFzTmFtZSA9ICR0aGlzLT5tYWluTWVudUl0ZW0tPmdldEFsaWFzTmFtZUJ5TmFtZSgn2K/Yp9mG2YTZiNivINio2LHZhtin2YXZhycpOwogICAgICAgICRhcHBEb3dubG9hZEl0ZW0gICAgICAgICAgPSAkdGhpcy0+bWFpbk1lbnVJdGVtLT5pc0FjdGl2ZUJ5QWxpYXNOYW1lKCRhcHBEb3dubG9hZEl0ZW1BbGlhc05hbWUpOwogICAgICAgIGlmICgkYXBwRG93bmxvYWRJdGVtID09IHRydWUgfHwgJGFwcERvd25sb2FkSXRlbSA9PSAxKSB7CiAgICAgICAgICAgICR0ZXh0ID0gJHRoaXMtPmN1c3RvbVRleHRDdHJsLT5nZXRUZXh0KCdhY3Rpb24uaGVscC5hcHBEb3dubG9hZCcpOwogICAgICAgICAgICBpZiAoaXNfYXJyYXkoJHRleHQpKSB7CiAgICAgICAgICAgICAgICAvLyB1c2UgZm9ybWF0IHRleHQgc2VydmljZQogICAgICAgICAgICAgICAgJHRleHQgPSAkdGhpcy0+dGVsZWdyYW1TZXJ2aWNlLT5mb3JtYXRUZXh0KCR0ZXh0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkb3ByW10gPSBbCiAgICAgICAgICAgICAgICAkdGV4dCA9PiAidG90dXJpYWwtYXBwRG93bmxvYWQiLAogICAgICAgICAgICBdOwogICAgICAgIH0KICAgICAgICBpZiAoJHJlY2hhcmdlICE9IG51bGwpIHsKICAgICAgICAgICAgJHRleHQgPSAkdGhpcy0+Y3VzdG9tVGV4dEN0cmwtPmdldFRleHQoJ2FjdGlvbi5oaXN0b3J5LmJ1dHR1bi5yZWNoYXJnZScpOwogICAgICAgICAgICBpZiAoaXNfYXJyYXkoJHRleHQpKSB7CiAgICAgICAgICAgICAgICAvLyB1c2UgZm9ybWF0IHRleHQgc2VydmljZQogICAgICAgICAgICAgICAgJHRleHQgPSAkdGhpcy0+dGVsZWdyYW1TZXJ2aWNlLT5mb3JtYXRUZXh0KCR0ZXh0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkb3ByW10gPSBbCiAgICAgICAgICAgICAgICAkdGV4dCA9PiAicmVjaGFyZ2UteyRwcm9kdWN0SUR9IiwKICAgICAgICAgICAgXTsKICAgICAgICAgICAgJHRleHQgPSAkdGhpcy0+Y3VzdG9tVGV4dEN0cmwtPmdldFRleHQoJ2FjdGlvbi5oaXN0b3J5LmJ1dHR1bi5yZW1hcmsnKTsKICAgICAgICAgICAgaWYgKGlzX2FycmF5KCR0ZXh0KSkgewogICAgICAgICAgICAgICAgLy8gdXNlIGZvcm1hdCB0ZXh0IHNlcnZpY2UKICAgICAgICAgICAgICAgICR0ZXh0ID0gJHRoaXMtPnRlbGVncmFtU2VydmljZS0+Zm9ybWF0VGV4dCgkdGV4dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJG9wcltdID0gWwogICAgICAgICAgICAgICAgJHRleHQgPT4gInJlbWFyay17JHByb2R1Y3RJRH0iLAogICAgICAgICAgICBdOwoKICAgICAgICB9CgogICAgICAgICR0ZXh0ID0gJHRoaXMtPmN1c3RvbVRleHRDdHJsLT5nZXRUZXh0KCdhY3Rpb24uaGVscC51c2luZ19zdWJzY3JpcHRpb24nKTsKICAgICAgICAkdGhpcy0+dGVsZWdyYW1TZXJ2aWNlLT5zZW5kTWVzc2FnZVdpdGhJbmxpbmVLZXlib2FyZCgkY2hhdF9pZCwgJHRleHQsICRvcHIpOwogICAgfQogICAgcHVibGljIGZ1bmN0aW9uIHNlbmRfaW5zdWZmaWNpZW50X2JhbGFuY2VfbWVzc2FnZSgkY2hhdF9pZCwgJHByb2R1Y3RDYXRlZ29yeUlEKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRwcm9kdWN0Q2F0ZWdvcnkgPSAkdGhpcy0+cHJvZHVjdENhdGVnb3J5LT5maW5kKCRwcm9kdWN0Q2F0ZWdvcnlJRCk7CgogICAgICAgICAgICBpZiAoJHByb2R1Y3RDYXRlZ29yeSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBcTG9nOjppbmZvKCJwcm9kdWN0Q2F0ZWdvcnkgaXMgbnVsbCBpbiBzZW5kX2luc3VmZmljaWVudF9iYWxhbmNlX21lc3NhZ2UgLCBwcm9kdWN0Q2F0ZWdvcnlJRDogJHByb2R1Y3RDYXRlZ29yeUlEIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICR1c2VyX2JhbGxhbmNlICAgICAgICAgID0gJHRoaXMtPmFjY0JsQ3RybC0+Z2V0TG9nZ2VkVXNlckJhbGxhbmNjZSgkY2hhdF9pZCk7CiAgICAgICAgICAgICR1c2VyX2JhbGxhbmNlX2luX3RvbWFuID0gJHVzZXJfYmFsbGFuY2UtPmJhbGxhbmNlOwogICAgICAgICAgICAkdXNlcl9iYWxsYW5jZV9pbl90b21hbiA9IG51bWJlcl9mb3JtYXQoJHVzZXJfYmFsbGFuY2VfaW5fdG9tYW4sIDAsICcsJywgJy4nKTsKICAgICAgICAgICAgJHVzZXJfYmFsbGFuY2VfaW5fdG9tYW4gPSAkdXNlcl9iYWxsYW5jZV9pbl90b21hbiAuICcg2KrZiNmF2KfZhic7CiAgICAgICAgICAgICRwcm9kdWN0UHJpY2VJblRvbWFuICAgID0gJHByb2R1Y3RDYXRlZ29yeS0+cHJpY2U7CiAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSB0aGUgZGlmZnJlbmNlIGJldHdlZW4gdXNlcl9iYWxsYW5jZSBhbmQgcHJvZHVjdFByaWNlSW5Ub21hbgogICAgICAgICAgICAkbWFpbkRpZmZyZW5jZUluVG9tYW4gID0gJGRpZmZyZW5jZSAgPSAkcHJvZHVjdFByaWNlSW5Ub21hbiAtICR1c2VyX2JhbGxhbmNlLT5iYWxsYW5jZTsKICAgICAgICAgICAgJGRpZmZyZW5jZSAgICAgICAgICAgICA9IG51bWJlcl9mb3JtYXQoJGRpZmZyZW5jZSwgMCwgJywnLCAnLicpOwogICAgICAgICAgICAkZGlmZnJlbmNlICAgICAgICAgICAgID0gJGRpZmZyZW5jZSAuICcg2KrZiNmF2KfZhic7CiAgICAgICAgICAgICRwcm9kdWN0UHJpY2VJblRvbWFuICAgPSBudW1iZXJfZm9ybWF0KCRwcm9kdWN0UHJpY2VJblRvbWFuLCAwLCAnLCcsICcuJyk7CiAgICAgICAgICAgICRwcm9kdWN0UHJpY2VJblRvbWFuICAgPSAkcHJvZHVjdFByaWNlSW5Ub21hbiAuICcg2KrZiNmF2KfZhic7CiAgICAgICAgICAgICRtYWluRGlmZnJlbmNlSW5Eb2xsYXIgPSAkZGlmZnJlbmNlX2luX2RvbGxhciA9IDAuMDA7CgogICAgICAgICAgICAkZG9sbGFyVHJhbnNhY3Rpb24gPSAkdGhpcy0+dHJTZXR0aW5nLT5nZXREb2xsYXJUcmFuc2FjdGlvblNldHRpbmcoKTsKICAgICAgICAgICAgJHRleHQgICAgICAgICAgICAgID0gJyc7CiAgICAgICAgICAgIGlmICgkZG9sbGFyVHJhbnNhY3Rpb24gPT0gdHJ1ZSB8fCAkZG9sbGFyVHJhbnNhY3Rpb24gPT0gMSkgewogICAgICAgICAgICAgICAgJHByb2R1Y3RQcmljZUluRG9sbGFyICAgID0gJHByb2R1Y3RDYXRlZ29yeS0+cHJpY2VfaW5fZG9sbGFyOwogICAgICAgICAgICAgICAgJHVzZXJfYmFsbGFuY2VfaW5fZG9sbGFyID0gJHVzZXJfYmFsbGFuY2UtPmFjY291bnRfYmFsbGFuY2VfaW5fZG9sbGFyOwogICAgICAgICAgICAgICAgJG1haW5EaWZmcmVuY2VJbkRvbGxhciAgID0gJGRpZmZyZW5jZV9pbl9kb2xsYXIgICA9ICRwcm9kdWN0UHJpY2VJbkRvbGxhciAtICR1c2VyX2JhbGxhbmNlX2luX2RvbGxhcjsKICAgICAgICAgICAgICAgICRwcm9kdWN0UHJpY2VJbkRvbGxhciAgICA9IG51bWJlcl9mb3JtYXQoJHByb2R1Y3RQcmljZUluRG9sbGFyLCAyLCAnLCcsICcuJyk7CiAgICAgICAgICAgICAgICAkcHJvZHVjdFByaWNlSW5Eb2xsYXIgICAgPSAkcHJvZHVjdFByaWNlSW5Eb2xsYXIgLiAnINiv2YTYp9ixJzsKICAgICAgICAgICAgICAgICR1c2VyX2JhbGxhbmNlX2luX2RvbGxhciA9IG51bWJlcl9mb3JtYXQoJHVzZXJfYmFsbGFuY2VfaW5fZG9sbGFyLCAyLCAnLCcsICcuJyk7CiAgICAgICAgICAgICAgICAkdXNlcl9iYWxsYW5jZV9pbl9kb2xsYXIgPSAkdXNlcl9iYWxsYW5jZV9pbl9kb2xsYXIgLiAnINiv2YTYp9ixJzsKICAgICAgICAgICAgICAgICRkaWZmcmVuY2VfaW5fZG9sbGFyICAgICA9IG51bWJlcl9mb3JtYXQoJGRpZmZyZW5jZV9pbl9kb2xsYXIsIDIsICcsJywgJy4nKTsKICAgICAgICAgICAgICAgICRkaWZmcmVuY2VfaW5fZG9sbGFyICAgICA9ICRkaWZmcmVuY2VfaW5fZG9sbGFyIC4gJyDYr9mE2KfYsSc7CgogICAgICAgICAgICAgICAgJHRleHQgPSAkdGhpcy0+Y3VzdG9tVGV4dEN0cmwtPmdldFRleHQoJ2FjdGlvbi5wcm9jZXNzLmluc3VmZmljaWVudF9iYWxhbmNlX3dpdGhfZG9sbGFyJywgWwogICAgICAgICAgICAgICAgICAgICdwcm9kdWN0X2NhdGVnb3J5X25hbWUnICAgPT4gJHByb2R1Y3RDYXRlZ29yeS0+bmFtZSwKICAgICAgICAgICAgICAgICAgICAncHJvZHVjdF9wcmljZV9pbl90b21hbicgID0+ICRwcm9kdWN0UHJpY2VJblRvbWFuLAogICAgICAgICAgICAgICAgICAgICdwcm9kdWN0X3ByaWNlX2luX2RvbGxhcicgPT4gJHByb2R1Y3RQcmljZUluRG9sbGFyLAogICAgICAgICAgICAgICAgICAgICd1c2VyX2JhbGFuY2VfaW5fdG9tYW4nICAgPT4gJHVzZXJfYmFsbGFuY2VfaW5fdG9tYW4sCiAgICAgICAgICAgICAgICAgICAgJ3VzZXJfYmFsYW5jZV9pbl9kb2xsYXInICA9PiAkdXNlcl9iYWxsYW5jZV9pbl9kb2xsYXIsCiAgICAgICAgICAgICAgICAgICAgJ2RpZmZlcmVuY2VfaW5fdG9tYW4nICAgICA9PiAkZGlmZnJlbmNlLAogICAgICAgICAgICAgICAgICAgICdkaWZmZXJlbmNlX2luX2RvbGxhcicgICAgPT4gJGRpZmZyZW5jZV9pbl9kb2xsYXIsCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICRmb3JtYXR0ZXIgPSBuZXcgVGVsZWdyYW1NZXNzYWdlRm9ybWF0dGVyKCR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UpOwogICAgICAgICAgICAgICAgJHRleHQgICAgICA9ICRmb3JtYXR0ZXItPmFkZEZvcm1hdHRlZFRleHQoJycsICR0ZXh0KS0+Z2V0TWVzc2FnZSgpOwoKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICR0ZXh0ID0gJHRoaXMtPmN1c3RvbVRleHRDdHJsLT5nZXRUZXh0KCdhY3Rpb24ucHJvY2Vzcy5pbnN1ZmZpY2llbnRfYmFsYW5jZScsIFsKICAgICAgICAgICAgICAgICAgICAncHJvZHVjdF9jYXRlZ29yeV9uYW1lJyAgPT4gJHByb2R1Y3RDYXRlZ29yeS0+bmFtZSwKICAgICAgICAgICAgICAgICAgICAncHJvZHVjdF9wcmljZV9pbl90b21hbicgPT4gJHByb2R1Y3RQcmljZUluVG9tYW4sCiAgICAgICAgICAgICAgICAgICAgJ3VzZXJfYmFsYW5jZV9pbl90b21hbicgID0+ICR1c2VyX2JhbGxhbmNlX2luX3RvbWFuLAogICAgICAgICAgICAgICAgICAgICdkaWZmZXJlbmNlX2luX3RvbWFuJyAgICA9PiAkZGlmZnJlbmNlLAogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlzX2FycmF5KCR0ZXh0KSkgewogICAgICAgICAgICAgICAgJGZvcm1hdHRlciA9IG5ldyBUZWxlZ3JhbU1lc3NhZ2VGb3JtYXR0ZXIoJHRoaXMtPnRlbGVncmFtU2VydmljZSk7CiAgICAgICAgICAgICAgICAkdGV4dCAgICAgID0gJGZvcm1hdHRlci0+YWRkRm9ybWF0dGVkVGV4dCgnJywgJHRleHQpLT5nZXRNZXNzYWdlKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkdGV4dCA9ICR0ZXh0OwogICAgICAgICAgICB9CiAgICAgICAgICAgICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPnNlbmRNZXNzYWdlKCRjaGF0X2lkLCAkdGV4dCk7CiAgICAgICAgICAgICR0aGlzLT5zZW5kX2FkZF9iYWxsYW5jZV9vcHRpb25fbWVzc2FnZSgkY2hhdF9pZCwgJG1haW5EaWZmcmVuY2VJblRvbWFuLCAkbWFpbkRpZmZyZW5jZUluRG9sbGFyKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgXExvZzo6aW5mbygiZXJyb3Igb24gc2VuZF9pbnN1ZmZpY2llbnRfYmFsYW5jZV9tZXNzYWdlLT4gJHRoIik7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gc2VuZF9hZGRfYmFsbGFuY2Vfb3B0aW9uX21lc3NhZ2UoJGNoYXRfaWQsICRlc3RpbWF0ZWRQcmljZSwgJGVzdGltYXRlZFByaWNlSW5Eb2xsYXIpCiAgICB7CiAgICAgICAgJG9wciAgICAgICAgID0gW107CiAgICAgICAgJGhhc1phcmluUGFsID0gJHRoaXMtPnB5bW50Q250cmwtPmdldFphcmlucGFsU3RhdHVzKCk7CiAgICAgICAgaWYgKCRoYXNaYXJpblBhbCA9PSB0cnVlIHx8ICRoYXNaYXJpblBhbCA9PSAxKSB7CiAgICAgICAgICAgICRuZXdPcHIgPSAkdGhpcy0+Y3JlYXRlWmFyaW5wYWxQYXltZW50TGluaygkY2hhdF9pZCwgJGVzdGltYXRlZFByaWNlKTsKICAgICAgICAgICAgYXJyYXlfcHVzaCgkb3ByLCAkbmV3T3ByKTsKICAgICAgICB9CgogICAgICAgICRoYXNEb2xsYXJQYXkgPSAkdGhpcy0+dHJTZXR0aW5nLT5nZXREb2xsYXJUcmFuc2FjdGlvblNldHRpbmcoKTsKICAgICAgICBpZiAoJGhhc0RvbGxhclBheSA9PSB0cnVlIHx8ICRoYXNEb2xsYXJQYXkgPT0gMSkgewogICAgICAgICAgICAkbmV3T3ByID0gJHRoaXMtPmNyZWF0ZU5vd1BheW1lbnRzTGluaygkY2hhdF9pZCwgJGVzdGltYXRlZFByaWNlSW5Eb2xsYXIpOwogICAgICAgICAgICBhcnJheV9wdXNoKCRvcHIsICRuZXdPcHIpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvdW50KCRvcHIpID4gMCkgewogICAgICAgICAgICAkdGV4dCA9ICR0aGlzLT5jdXN0b21UZXh0Q3RybC0+Z2V0VGV4dCgnYWN0aW9uLnByb2Nlc3MuYWRkX29ubGluZV9iYWxhbmNlJyk7CiAgICAgICAgICAgICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPnNlbmRNZXNzYWdlV2l0aExpbmtCdXR0b25zKCRjaGF0X2lkLCAkdGV4dCwgJG9wcik7CiAgICAgICAgfQoKICAgICAgICAvLyBzZW5kIG9mZmxpbmUgaXRlbQogICAgICAgICRvcHIgPSBbXTsKCiAgICAgICAgJG9mZmxpbmVQYXltZW50ID0gJHRoaXMtPnB5bW50Q250cmwtPmdldEFsbEFjdGl2ZU9mZmxpbmVQYXltZW50VHlwZXMoKTsKICAgICAgICBpZiAoJG9mZmxpbmVQYXltZW50ICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKCRoYXNaYXJpblBhbCA9PSB0cnVlIHx8ICRoYXNaYXJpblBhbCA9PSAxIHx8ICRoYXNEb2xsYXJQYXkgPT0gdHJ1ZSB8fCAkaGFzRG9sbGFyUGF5ID09IDEpIHsKICAgICAgICAgICAgICAgICR0ZXh0ID0gJHRoaXMtPmN1c3RvbVRleHRDdHJsLT5nZXRUZXh0KCdhY3Rpb24ucHJvY2Vzcy5hZGRfb2ZmbGluZV9iYWxhbmNlX29wdGlvbl9hbmRfb25saW5lX2JhbGFuY2UnKTsKICAgICAgICAgICAgICAgIGlmIChpc19hcnJheSgkdGV4dCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyB1c2UgZm9ybWF0IHRleHQgc2VydmljZQogICAgICAgICAgICAgICAgICAgICR0ZXh0ID0gJHRoaXMtPnRlbGVncmFtU2VydmljZS0+Zm9ybWF0VGV4dCgkdGV4dCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkdGV4dCA9ICR0aGlzLT5jdXN0b21UZXh0Q3RybC0+Z2V0VGV4dCgnYWN0aW9uLnByb2Nlc3MuYWRkX29mZmxpbmVfYmFsYW5jZV9vcHRpb24nKTsKICAgICAgICAgICAgICAgIGlmIChpc19hcnJheSgkdGV4dCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyB1c2UgZm9ybWF0IHRleHQgc2VydmljZQogICAgICAgICAgICAgICAgICAgICR0ZXh0ID0gJHRoaXMtPnRlbGVncmFtU2VydmljZS0+Zm9ybWF0VGV4dCgkdGV4dCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRvcHIgPSBbXTsKCiAgICAgICAgICAgIGZvcmVhY2ggKCRvZmZsaW5lUGF5bWVudCBhcyAka2V5ID0+ICR2YWx1ZSkgewogICAgICAgICAgICAgICAgJG9wcltdID0gWwogICAgICAgICAgICAgICAgICAgICIkdmFsdWUtPm5hbWUiID0+ICJvZmZsaW5lR2F0ZXdheS0kdmFsdWUtPmlkICIsCiAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICB9CgogICAgICAgIH0KCiAgICAgICAgJHRoaXMtPnRlbGVncmFtU2VydmljZS0+c2VuZE1lc3NhZ2VXaXRoSW5saW5lS2V5Ym9hcmQoJGNoYXRfaWQsICR0ZXh0LCAkb3ByKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlWmFyaW5wYWxQYXltZW50TGluaygkY2hhdF9pZCwgJGVzdGltYXRlZFByaWNlKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRyZXF1ZXN0ICAgICAgICAgICAgID0gbmV3IFJlcXVlc3QoKTsKICAgICAgICAgICAgJHJlcXVlc3QtPmFjY291bnRfaWQgPSAkY2hhdF9pZDsKICAgICAgICAgICAgJHJlcXVlc3QtPmFtb3VudCAgICAgPSAkZXN0aW1hdGVkUHJpY2U7CiAgICAgICAgICAgICRiaWxsICAgICAgICAgICAgICAgID0gJHRoaXMtPmJpbGxDbnRybC0+Y3JlYXRlTmV3QmlsbCgkcmVxdWVzdCk7CgogICAgICAgICAgICAkdHJSZXF1ZXN0ICAgICAgICAgICAgID0gbmV3IFJlcXVlc3QoKTsKICAgICAgICAgICAgJHRyUmVxdWVzdC0+aW52b2ljZUlEICA9ICRiaWxsLT5iaWxsX2lkOwogICAgICAgICAgICAkdHJSZXF1ZXN0LT5hY2NvdW50X2lkID0gJGNoYXRfaWQ7CiAgICAgICAgICAgICR0clJlcXVlc3QtPmFtb3VudCAgICAgPSAkZXN0aW1hdGVkUHJpY2U7CiAgICAgICAgICAgICRwYXltZW50TGluayAgICAgICAgICAgPSAkdGhpcy0+dHJDbnRybC0+YWRkX29yZGVyKCR0clJlcXVlc3QpOwoKICAgICAgICAgICAgLy8gZm9ybWF0ICRlc3RpbWF0ZWRQcmljZSB0byAwIGRlY2ltYWwKICAgICAgICAgICAgJGZvcm1hdHRlZFByaWNlID0gbnVtYmVyX2Zvcm1hdCgkZXN0aW1hdGVkUHJpY2UsIDAsICcsJywgJy4nKTsKICAgICAgICAgICAgJHRleHQgICAgICAgICAgID0gJHRoaXMtPmN1c3RvbVRleHRDdHJsLT5nZXRUZXh0KCdhY3Rpb24ucHJvY2Vzcy5hZGRfb25saW5lX2JhbGFuY2UuemFyaW5wYWwnKTsKICAgICAgICAgICAgaWYgKGlzX2FycmF5KCR0ZXh0KSkgewogICAgICAgICAgICAgICAgLy8gdXNlIGZvcm1hdCB0ZXh0IHNlcnZpY2UKICAgICAgICAgICAgICAgICR0ZXh0ID0gJHRoaXMtPnRlbGVncmFtU2VydmljZS0+Zm9ybWF0VGV4dCgkdGV4dCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAndGV4dCcgPT4gJHRleHQgLiAiICRmb3JtYXR0ZWRQcmljZSDYqtmI2YXYp9mGIiwKICAgICAgICAgICAgICAgICd1cmwnICA9PiAkcGF5bWVudExpbmssCiAgICAgICAgICAgIF07CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgXExvZzo6ZXJyb3IoWyJjcmVhdGVaYXJpbnBhbFBheW1lbnRMaW5rOiAiIC4gJHRoXSk7CiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICB9CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlTm93UGF5bWVudHNMaW5rKCRjaGF0X2lkLCAkZXN0aW1hdGVkUHJpY2VJbkRvbGxhcikKICAgIHsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgJHJlcXVlc3QgICAgICAgICAgICAgPSBuZXcgUmVxdWVzdCgpOwogICAgICAgICAgICAkcmVxdWVzdC0+YWNjb3VudF9pZCA9ICRjaGF0X2lkOwogICAgICAgICAgICAkcmVxdWVzdC0+YW1vdW50ICAgICA9ICRlc3RpbWF0ZWRQcmljZUluRG9sbGFyOwogICAgICAgICAgICAkYmlsbCAgICAgICAgICAgICAgICA9ICR0aGlzLT5iaWxsQ250cmwtPmNyZWF0ZU5ld0JpbGxJbkRvbGxhcigkcmVxdWVzdCk7CgogICAgICAgICAgICAkb3BlbkxpbmsgPSAkdGhpcy0+cHltbnRDbnRybC0+Z2V0Tm93UGF5bWVudHNMaW5rKCk7CgogICAgICAgICAgICAkdHJDcnlwdG9DbnRybCAgICAgICAgID0gbmV3IFRyYW5zYWN0aW9uQ3J5cHRvQ29udHJvbGxlcigpOwogICAgICAgICAgICAkdHJSZXF1ZXN0ICAgICAgICAgICAgID0gbmV3IFJlcXVlc3QoKTsKICAgICAgICAgICAgJHRyUmVxdWVzdC0+aW52b2ljZUlEICA9ICRiaWxsLT5iaWxsX2lkOwogICAgICAgICAgICAkdHJSZXF1ZXN0LT5hY2NvdW50X2lkID0gJGNoYXRfaWQ7CiAgICAgICAgICAgICR0clJlcXVlc3QtPmFtb3VudCAgICAgPSAkZXN0aW1hdGVkUHJpY2VJbkRvbGxhcjsKICAgICAgICAgICAgJHBheW1lbnRMaW5rICAgICAgICAgICA9ICR0ckNyeXB0b0NudHJsLT5hZGRfb3JkZXJfY3J5cHRvX2J5X25vd3BheW1lbnQoJHRyUmVxdWVzdCk7CiAgICAgICAgICAgICRub3dwYXltZW50TGluayAgICAgICAgPSAkdGhpcy0+Z2V0X25vd3BheW1lbnRfcGF5bWVudF9saW5rX2Zyb21faHRtbCgkcGF5bWVudExpbmspOwoKICAgICAgICAgICAgLy8gZm9ybWF0ICRlc3RpbWF0ZWRQcmljZSB0byAwIGRlY2ltYWwKICAgICAgICAgICAgJGZvcm1hdHRlZFByaWNlID0gbnVtYmVyX2Zvcm1hdCgkZXN0aW1hdGVkUHJpY2VJbkRvbGxhciwgMCwgJywnLCAnLicpOwogICAgICAgICAgICAkdGV4dCAgICAgICAgICAgPSAkdGhpcy0+Y3VzdG9tVGV4dEN0cmwtPmdldFRleHQoJ2FjdGlvbi5wcm9jZXNzLmFkZF9vbmxpbmVfYmFsYW5jZS5kb2xsYXJwYXkubm93cGF5bWVudCcpOwogICAgICAgICAgICBpZiAoaXNfYXJyYXkoJHRleHQpKSB7CiAgICAgICAgICAgICAgICAvLyB1c2UgZm9ybWF0IHRleHQgc2VydmljZQogICAgICAgICAgICAgICAgJHRleHQgPSAkdGhpcy0+dGVsZWdyYW1TZXJ2aWNlLT5mb3JtYXRUZXh0KCR0ZXh0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICd0ZXh0JyA9PiAkdGV4dCAuICIgJGZvcm1hdHRlZFByaWNlINiv2YTYp9ixIiwKICAgICAgICAgICAgICAgICd1cmwnICA9PiAkbm93cGF5bWVudExpbmssCiAgICAgICAgICAgIF07CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgXExvZzo6ZXJyb3IoWyJjcmVhdGVOb3dQYXltZW50c0xpbms6ICIgLiAkdGhdKTsKICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRGYXFzKCRjaGF0SWQpCiAgICB7CiAgICAgICAgJHRoaXMtPmFkZE5ld0JvdExvZygnZmFxJywgJ9mG2YXYp9uM2LQg2LPZiNin2YTYp9iqINmF2KrYr9in2YjZhCDYqNmHINqp2KfYsdio2LEuJywgJGNoYXRJZCwgJ3Nob3cnKTsKICAgICAgICAkZmFxQ3RybCA9IG5ldyBGYXFDb250cm9sbGVyKCk7CiAgICAgICAgJGZhcXMgICAgPSAkZmFxQ3RybC0+Z2V0RmFxTGlzdCgpOwogICAgICAgICRvcHIgICAgID0gW107CiAgICAgICAgaWYgKCRmYXFzICE9IG51bGwpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJGZhcXMgYXMgJGtleSA9PiAkZmFxKSB7CiAgICAgICAgICAgICAgICAkb3ByW10gPSBbCiAgICAgICAgICAgICAgICAgICAgJGZhcS0+cXVlc3Rpb24gPT4gImZhcS17JGZhcS0+aWR9IiwKICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHRleHQgPSAkdGhpcy0+Y3VzdG9tVGV4dEN0cmwtPmdldFRleHQoJ2FjdGlvbi5oZWxwLmZhcScpOwogICAgICAgICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPnNlbmRNZXNzYWdlV2l0aElubGluZUtleWJvYXJkKCRjaGF0SWQsICR0ZXh0LCAkb3ByKTsKICAgICAgICByZXR1cm4gIiI7CgogICAgfQogICAgcHVibGljIGZ1bmN0aW9uIHN1YkZhcSgkY2hhdElkLCAkc2VsZWN0ZWRGYXFJRCkKICAgIHsKICAgICAgICAkdGhpcy0+YWRkTmV3Qm90TG9nKCdmYXEnLCAn2YbZhdin24zYtCDYs9mI2KfZhNin2Kog2YXYqtiv2KfZiNmEINio2Ycg2qnYp9ix2KjYsS4nLCAkY2hhdElkLCAnc2hvdycpOwogICAgICAgICRmYXFDdHJsID0gbmV3IEZhcUNvbnRyb2xsZXIoKTsKICAgICAgICAkZmFxICAgICA9ICRmYXFDdHJsLT5nZXRGYXFCeUlkKCRzZWxlY3RlZEZhcUlEKTsKICAgICAgICAkdGhpcy0+dGVsZWdyYW1TZXJ2aWNlLT5zZW5kTWVzc2FnZSgkY2hhdElkLCAkZmFxLT5hbnN3ZXIpOwogICAgICAgIHJldHVybiAiIjsKICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiBhcHBEb3dubG9hZCgkY2hhdElkKQogICAgewogICAgICAgICRhcHBDdHJsID0gbmV3IEFwcGxpY2F0aW9uQ29udHJvbGxlcigpOwogICAgICAgICRvc2VzICAgID0gJGFwcEN0cmwtPmdldEFwcGxpY2F0aW9uT1NlcygpOwogICAgICAgICRvcHIgICAgID0gW107CiAgICAgICAgaWYgKCRvc2VzICE9IG51bGwpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJG9zZXMgYXMgJGtleSA9PiAkb3MpIHsKICAgICAgICAgICAgICAgICRvcHJbXSA9IFsKICAgICAgICAgICAgICAgICAgICAkb3MtPm9zID0+ICJzdWJBcHBEb3dubG9hZE9zLXskb3MtPm9zfSIsCiAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICR0ZXh0ID0gJHRoaXMtPmN1c3RvbVRleHRDdHJsLT5nZXRUZXh0KCdhY3Rpb24uaGVscC5hcHBEb3dubG9hZC5vcycpOwogICAgICAgICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPnNlbmRNZXNzYWdlV2l0aElubGluZUtleWJvYXJkKCRjaGF0SWQsICR0ZXh0LCAkb3ByKTsKICAgICAgICByZXR1cm4gIiI7CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gc3ViQXBwRG93bmxvYWRPcygkY2hhdElkLCAkc2VsZWN0ZWRPc0lEKQogICAgewogICAgICAgICRhcHBDdHJsID0gbmV3IEFwcGxpY2F0aW9uQ29udHJvbGxlcigpOwogICAgICAgICRhcHAgICAgID0gJGFwcEN0cmwtPmdldEFsbEFjdGl2ZUFwbGljYXRpb25MaXN0QnlPUygkc2VsZWN0ZWRPc0lEKTsKICAgICAgICAvLyBsb2cgY291bnQgb2YgYXBwCiAgICAgICAgJG9wciA9IFtdOwogICAgICAgIGlmICgkYXBwICE9IG51bGwpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJGFwcCBhcyAka2V5ID0+ICRhcHApIHsKICAgICAgICAgICAgICAgICRvcHJbXSA9IFsKICAgICAgICAgICAgICAgICAgICAkYXBwLT5uYW1lID0+ICJzdWJBcHBEb3dubG9hZEFwcC17JGFwcC0+aWR9IiwKICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHRleHQgPSAkdGhpcy0+Y3VzdG9tVGV4dEN0cmwtPmdldFRleHQoJ2FjdGlvbi5oZWxwLmFwcERvd25sb2FkLmFwcCcpOwogICAgICAgICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPnNlbmRNZXNzYWdlV2l0aElubGluZUtleWJvYXJkKCRjaGF0SWQsICR0ZXh0LCAkb3ByKTsKICAgICAgICByZXR1cm4gIiI7CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gc3ViQXBwRG93bmxvYWRBcHAoJGNoYXRJZCwgJHNlbGVjdGVkQXBwSUQpCiAgICB7CiAgICAgICAgJGFwcEN0cmwgICAgICAgPSBuZXcgQXBwbGljYXRpb25Db250cm9sbGVyKCk7CiAgICAgICAgJGFwcCAgICAgICAgICAgPSAkYXBwQ3RybC0+Z2V0QWN0aXZlQXBsaWNhdGlvbkJ5SUQoJHNlbGVjdGVkQXBwSUQpOwogICAgICAgICRuYW1lICAgICAgICAgID0gJGFwcC0+bmFtZTsKICAgICAgICAkZGVzY3JpcHRpb24gICA9ICRhcHAtPmRlc2NyaXB0aW9uOwogICAgICAgICRkb3dubG9hZF9saW5rID0gJGFwcC0+ZG93bmxvYWRfbGluazsKICAgICAgICAvLyAkZmlsZV9zcmMgPSAkYXBwLT5maWxlX3NyYzsKICAgICAgICAkaG93X3RvX3VzZSAgID0gJGFwcC0+aG93X3RvX3VzZTsKICAgICAgICAkeW91dHViZV9saW5rID0gJGFwcC0+eW91dHViZV9saW5rOwogICAgICAgICR0ZXh0ICAgICAgICAgPSAkdGhpcy0+Y3VzdG9tVGV4dEN0cmwtPmdldFRleHQoJ2FjdGlvbi5oZWxwLmFwcERvd25sb2FkLmFwcC5uYW1lX2Rlc2NyaXB0aW9uJywgWwogICAgICAgICAgICAnbmFtZScgICAgICAgICAgPT4gJG5hbWUsCiAgICAgICAgICAgICdkZXNjcmlwdGlvbicgICA9PiAkZGVzY3JpcHRpb24sCiAgICAgICAgICAgICdkb3dubG9hZF9saW5rJyA9PiAkZG93bmxvYWRfbGluaywKICAgICAgICAgICAgJ2hvd190b191c2UnICAgID0+ICRob3dfdG9fdXNlLAogICAgICAgICAgICAneW91dHViZV9saW5rJyAgPT4gJHlvdXR1YmVfbGluaywKICAgICAgICBdKTsKICAgICAgICAkZm9ybWF0dGVyID0gbmV3IFRlbGVncmFtTWVzc2FnZUZvcm1hdHRlcigkdGhpcy0+dGVsZWdyYW1TZXJ2aWNlKTsKICAgICAgICAkdGV4dCAgICAgID0gJGZvcm1hdHRlci0+YWRkRm9ybWF0dGVkVGV4dCgnJywgJHRleHQpLT5nZXRNZXNzYWdlKCk7CgogICAgICAgICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPnNlbmRNZXNzYWdlKCRjaGF0SWQsICR0ZXh0KTsKICAgICAgICByZXR1cm4gIiI7CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gc3VwcG9ydCgkY2hhdElkKQogICAgewogICAgICAgICR0aGlzLT5hZGROZXdCb3RMb2coJ3N1cHBvcnQnLCAn2YbZhdin24zYtCDar9iy24zZhtmHINmH2KfbjCDZvti02KrbjNio2KfZhtuMINio2Ycg2qnYp9ix2KjYsS4nLCAkY2hhdElkLCAnc2hvdycpOwogICAgICAgICRzdXBwb3J0Q3RybCA9IG5ldyBTdXBwb3J0Q29udHJvbGxlcigpOwogICAgICAgICRzdXBwb3J0cyAgICA9ICRzdXBwb3J0Q3RybC0+Z2V0U3VwcG9yc3RMaXN0KCk7CiAgICAgICAgJG9wciAgICAgICAgID0gW107CiAgICAgICAgaWYgKCRzdXBwb3J0cyAhPSBudWxsKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRzdXBwb3J0cyBhcyAka2V5ID0+ICRzdXBwb3J0KSB7CiAgICAgICAgICAgICAgICAkb3ByW10gPSBbCiAgICAgICAgICAgICAgICAgICAgJHN1cHBvcnQtPnF1ZXN0aW9uID0+ICJzdXBwb3J0LXskc3VwcG9ydC0+aWR9IiwKICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHRleHQgPSAkdGhpcy0+Y3VzdG9tVGV4dEN0cmwtPmdldFRleHQoJ2FjdGlvbi5oZWxwLnN1cHBvcnQudGl0bGUnKTsKICAgICAgICAkdGhpcy0+dGVsZWdyYW1TZXJ2aWNlLT5zZW5kTWVzc2FnZVdpdGhJbmxpbmVLZXlib2FyZCgkY2hhdElkLCAkdGV4dCwgJG9wcik7CiAgICAgICAgcmV0dXJuICIiOwogICAgfQogICAgcHVibGljIGZ1bmN0aW9uIHN1YlN1cHBvcnQoJGNoYXRJZCwgJHN1cHBvcnRJZCkKICAgIHsKICAgICAgICAkc3VwcG9ydEN0cmwgPSBuZXcgU3VwcG9ydENvbnRyb2xsZXIoKTsKICAgICAgICAkc3VwcG9ydCAgICAgPSAkc3VwcG9ydEN0cmwtPmdldFN1cHBvcnRCeUlkKCRzdXBwb3J0SWQpOwogICAgICAgICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPnNlbmRNZXNzYWdlKCRjaGF0SWQsICRzdXBwb3J0LT5hbnN3ZXIpOwogICAgICAgIHJldHVybiAiIjsKCiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gdGVzdEFjY291bnQoJGNoYXRJZCkKICAgIHsKICAgICAgICAkdGhpcy0+YWRkTmV3Qm90TG9nKCd0ZXN0X2FjY291bnQnLCAn2KrYs9iqINin2qnYp9mG2Kog2KLYstmF2KfbjNi024wg2KjZhyDaqdin2LHYqNixLicsICRjaGF0SWQsICdzaG93Jyk7CiAgICAgICAgJHRlc3RBY2NvdW50Q250cmwgPSBuZXcgVGVzdEFjY291bnRDb250cm9sbGVyKCk7CiAgICAgICAgJHRlc3RBY2NvdW50ICAgICAgPSAkdGVzdEFjY291bnRDbnRybC0+Z2V0VGVzdEFjY291bnREZXRhaWxzKCk7CgogICAgICAgICR1c2VkVGVzdEFjY291bnRDbnRybCA9IG5ldyBVc2VkVGVzdEFjY291bnRDb250cm9sbGVyKCk7CiAgICAgICAgJGhhc0FjY291bnQgICAgICAgICAgID0gJHVzZWRUZXN0QWNjb3VudENudHJsLT5uZXdUZXN0QWNjb3VudCgkY2hhdElkLCAkdGVzdEFjY291bnQtPmlkKTsKCiAgICAgICAgaWYgKCRoYXNBY2NvdW50ID09IHRydWUgfHwgJGhhc0FjY291bnQgPT0gMSkgewogICAgICAgICAgICAkdGV4dCA9ICR0aGlzLT5jdXN0b21UZXh0Q3RybC0+Z2V0VGV4dCgnZXJyb3IudGVzdF9hY2NvdW50LmV4aXN0Jyk7CiAgICAgICAgICAgICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPnNlbmRNZXNzYWdlKCRjaGF0SWQsICR0ZXh0KTsKICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIH0KICAgICAgICAkdGV4dCA9ICR0aGlzLT5jdXN0b21UZXh0Q3RybC0+Z2V0VGV4dCgnYWN0aW9uLnRlc3RfYWNjb3VudC5zdWNjZXNzJyk7CgogICAgICAgICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPnNlbmRNZXNzYWdlKCRjaGF0SWQsICR0ZXh0KTsKICAgICAgICAkcGFuZWxDbnRybCA9IG5ldyBQYW5uZWxDb250cm9sbGVyKCk7CiAgICAgICAgJHBhbm5lbCAgICAgPSAkcGFuZWxDbnRybC0+Z2V0UGFubmVsQnlJZCgkdGVzdEFjY291bnQtPnBhbm5lbF9pZCk7CiAgICAgICAgLy8gZ2V0IHNlbGVjdGVkIGl0ZW0gc3BlY2VmaWMgZGF0YQogICAgICAgICRkYXkgICAgPSAkdGVzdEFjY291bnQtPmV4cGlyZV9kYXk7CiAgICAgICAgJHZvbHVtZSA9ICR0ZXN0QWNjb3VudC0+dm9sdW1lOwoKICAgICAgICBpZiAoJHBhbm5lbC0+dHlwZSA9PSAnaGlkZGlmeScpIHsKCiAgICAgICAgICAgIC8vICRuZXdVVUlEID0gJGhpZGRpZmNDbnRybC0+YWRkVXNlclRvSGlkZGlmeVBhbmVsT2xkQXBpKCRyZXEpOwogICAgICAgICAgICAkdXNlckxpbmsgPSAkcGFubmVsLT51c2VyX2xpbms7CiAgICAgICAgICAgICR0ZXh0ICAgICA9ICR0aGlzLT5jdXN0b21UZXh0Q3RybC0+Z2V0VGV4dCgnYWN0aW9uLnRlc3RfYWNjb3VudC5zdWNjZXNzJyk7CiAgICAgICAgICAgICR0aGlzLT5uZXdfaGlkZGlmeV9jb25maWdfdGVsZWdyYW1fdGV4dCgkdGVzdEFjY291bnQsICRwYW5uZWwsICR2b2x1bWUsICRkYXksICRjaGF0SWQsICR0ZXN0QWNjb3VudC0+aWQpOwogICAgICAgICAgICAkdGhpcy0+c2VuZF91c2luZ19zdWJzY3JpcHRpb25fbWFudWFsX21lc3NhZ2UoJGNoYXRJZCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gIiI7CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gZ2lmdENhcmQoJGNoYXRJZCkKICAgIHsKICAgICAgICAkdGV4dCA9ICR0aGlzLT5jdXN0b21UZXh0Q3RybC0+Z2V0VGV4dCgnYWN0aW9uLmhlbHAuZ2lmdENhcmQnKTsKICAgICAgICAkdGhpcy0+dGVsZWdyYW1TZXJ2aWNlLT5zZW5kTWVzc2FnZSgkY2hhdElkLCAkdGV4dCk7CiAgICAgICAgcmV0dXJuICIiOwogICAgfQogICAgcHVibGljIGZ1bmN0aW9uIHN1YkdpZnRDYXJkKCRjaGF0SWQsICRnaWZ0Q2FyZCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyDYqNix2LHYs9uMINmF2K3Yr9mI2K/bjNiqINiq2YTYp9i0INqp2KfYsdio2LEKICAgICAgICAgICAgJGF0dGVtcHRzQ2FjaGVLZXkgPSAiZ2lmdF9jYXJkX2F0dGVtcHRzX3skY2hhdElkfSI7CiAgICAgICAgICAgICRibG9ja2VkQ2FjaGVLZXkgID0gImdpZnRfY2FyZF9ibG9ja2VkX3skY2hhdElkfSI7CgogICAgICAgICAgICAvLyDYqNix2LHYs9uMINin24zZhtqp2Ycg2KLbjNinINqp2KfYsdio2LEg2YXYs9iv2YjYryDYtNiv2Ycg2KfYs9iqCiAgICAgICAgICAgIGlmIChDYWNoZTo6aGFzKCRibG9ja2VkQ2FjaGVLZXkpKSB7CiAgICAgICAgICAgICAgICAkYmxvY2tFeHBpcmVzSW4gPSBub3coKS0+ZGlmZkluTWludXRlcyhDYWNoZTo6Z2V0KCRibG9ja2VkQ2FjaGVLZXkpKTsKICAgICAgICAgICAgICAgICR0ZXh0ICAgICAgICAgICA9ICR0aGlzLT5jdXN0b21UZXh0Q3RybC0+Z2V0VGV4dCgnZXJyb3IuZ2lmdENhcmQudG9vX21hbnlfYXR0ZW1wdHMnLCBbCiAgICAgICAgICAgICAgICAgICAgJ21pbnV0ZXMnID0+ICRibG9ja0V4cGlyZXNJbiwKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgJHRoaXMtPnRlbGVncmFtU2VydmljZS0+c2VuZE1lc3NhZ2UoJGNoYXRJZCwgJHRleHQpOwogICAgICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyDYp9mB2LLYp9uM2LQg2KrYudiv2KfYryDYqtmE2KfYtOKAjNmH2KcKICAgICAgICAgICAgJGF0dGVtcHRzID0gQ2FjaGU6OmdldCgkYXR0ZW1wdHNDYWNoZUtleSwgMCkgKyAxOwogICAgICAgICAgICBDYWNoZTo6cHV0KCRhdHRlbXB0c0NhY2hlS2V5LCAkYXR0ZW1wdHMsIG5vdygpLT5hZGRIb3VyKCkpOwoKICAgICAgICAgICAgJGdpZnRDYXJkQ250cmwgPSBuZXcgR2lmdENhcmRDb250cm9sbGVyKCk7CiAgICAgICAgICAgICRnaWZ0Q2FyZCAgICAgID0gJGdpZnRDYXJkQ250cmwtPmdldEdpZnRDYXJkQnlDb2RlKCRnaWZ0Q2FyZCk7CgogICAgICAgICAgICBpZiAoJGdpZnRDYXJkID09IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vINin2q/YsSDYqti52K/Yp9ivINiq2YTYp9i04oCM2YfYpyDYp9iyINit2K8g2YXYrNin2LIg2KjbjNi02KrYsSDYtNivCiAgICAgICAgICAgICAgICBpZiAoJGF0dGVtcHRzID49IDMpIHsKICAgICAgICAgICAgICAgICAgICBDYWNoZTo6cHV0KCRibG9ja2VkQ2FjaGVLZXksIG5vdygpLT5hZGRIb3VyKCksIG5vdygpLT5hZGRIb3VyKCkpOwogICAgICAgICAgICAgICAgICAgIENhY2hlOjpmb3JnZXQoJGF0dGVtcHRzQ2FjaGVLZXkpOwoKICAgICAgICAgICAgICAgICAgICAkdGV4dCA9ICR0aGlzLT5jdXN0b21UZXh0Q3RybC0+Z2V0VGV4dCgnZXJyb3IuZ2lmdENhcmQuYmxvY2tlZCcpOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPnNlbmRNZXNzYWdlKCRjaGF0SWQsICR0ZXh0KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJHRleHQgPSAkdGhpcy0+Y3VzdG9tVGV4dEN0cmwtPmdldFRleHQoJ2Vycm9yLmdpZnRDYXJkLm5vdF9mb3VuZCcpOwogICAgICAgICAgICAgICAgJHRoaXMtPnRlbGVncmFtU2VydmljZS0+c2VuZE1lc3NhZ2UoJGNoYXRJZCwgJHRleHQpOwogICAgICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyDYp9qv2LEg2q/bjNmB2Kog2qnYp9ix2Kog2YXYudiq2KjYsSDYqNmI2K/YjCDaqdi0INix2Kcg2b7Yp9qpINmF24zigIzaqdmG24zZhQogICAgICAgICAgICBDYWNoZTo6Zm9yZ2V0KCRhdHRlbXB0c0NhY2hlS2V5KTsKCiAgICAgICAgICAgIC8vINin2K/Yp9mF2Ycg2YXZhti32YIg2YXZiNis2YjYrwogICAgICAgICAgICAkdXNlZEdpZnRDbnRybCAgICAgPSBuZXcgVXNlZEdpZnRDYXJkQ29udHJvbGxlcigpOwogICAgICAgICAgICAkdXNlclVzZWRJdGVtQ291bnQgPSAkdXNlZEdpZnRDbnRybC0+Z2V0Q291bnRPZlVzZVBlclVzZXIoJGdpZnRDYXJkLT5pZCwgJGNoYXRJZCk7CiAgICAgICAgICAgIGlmICgkdXNlclVzZWRJdGVtQ291bnQgPj0gJGdpZnRDYXJkLT5jb3VudF9vZl91c2VfcGVyX3VzZXIpIHsKICAgICAgICAgICAgICAgICR0ZXh0ID0gJHRoaXMtPmN1c3RvbVRleHRDdHJsLT5nZXRUZXh0KCdlcnJvci5naWZ0Q2FyZC5hbHJlYWR5X3VzZWQnKTsKICAgICAgICAgICAgICAgICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPnNlbmRNZXNzYWdlKCRjaGF0SWQsICR0ZXh0KTsKICAgICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgfQogICAgICAgICAgICAkcmV1YWx0ID0gJHVzZWRHaWZ0Q250cmwtPmFkZEdpZnRDYXJkVG9Vc2VyQWNjb3VudCgkZ2lmdENhcmQtPmlkLCAkY2hhdElkLCAkZ2lmdENhcmQpOwogICAgICAgICAgICBpZiAoJHJldWFsdCkgewogICAgICAgICAgICAgICAgJHRleHQgPSAkdGhpcy0+Y3VzdG9tVGV4dEN0cmwtPmdldFRleHQoJ2FjdGlvbi5oZWxwLmdpZnRDYXJkLnN1Y2Nlc3MnKTsKICAgICAgICAgICAgICAgICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPnNlbmRNZXNzYWdlKCRjaGF0SWQsICR0ZXh0KTsKICAgICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGV4dCA9ICR0aGlzLT5jdXN0b21UZXh0Q3RybC0+Z2V0VGV4dCgnZXJyb3IuZ2lmdENhcmQuYWxyZWFkeV91c2VkJyk7CiAgICAgICAgICAgICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPnNlbmRNZXNzYWdlKCRjaGF0SWQsICR0ZXh0KTsKICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIFxMb2c6OmVycm9yKFsic3ViR2lmdENhcmQ6ICIgLiAkdGhdKTsKICAgICAgICAgICAgJHRleHQgPSAkdGhpcy0+Y3VzdG9tVGV4dEN0cmwtPmdldFRleHQoJ2Vycm9yLnNlcnZlcl9lcnJvcicpOwogICAgICAgICAgICAkdGhpcy0+dGVsZWdyYW1TZXJ2aWNlLT5zZW5kTWVzc2FnZSgkY2hhdElkLCAkdGV4dCk7CiAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICB9CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gcmVmZXJyYWwoJGNoYXRJZCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkdGV4dCAgPSAkdGhpcy0+Y3VzdG9tVGV4dEN0cmwtPmdldFRleHQoJ2FjdGlvbi5yZWZlcnJhbC50aXRsZScpOwogICAgICAgICAgICAkb3ByICAgPSBbXTsKICAgICAgICAgICAgJG9wcltdID0gWwogICAgICAgICAgICAgICAgJHRleHQgPT4gInJlZmVycmFsLXskY2hhdElkfSIsCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIGlmIChpc19hcnJheSgkdGV4dCkpIHsKICAgICAgICAgICAgICAgIC8vIHVzZSBmb3JtYXQgdGV4dCBzZXJ2aWNlCiAgICAgICAgICAgICAgICAkdGV4dCA9ICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPmZvcm1hdFRleHQoJHRleHQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPnNlbmRNZXNzYWdlV2l0aElubGluZUtleWJvYXJkKCRjaGF0SWQsICR0ZXh0LCAkb3ByKTsKICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIFxMb2c6OmVycm9yKFsicmVmZXJyYWw6ICIgLiAkdGhdKTsKICAgICAgICAgICAgJHRleHQgPSAkdGhpcy0+Y3VzdG9tVGV4dEN0cmwtPmdldFRleHQoJ2Vycm9yLnNlcnZlcl9lcnJvcicpOwogICAgICAgICAgICAkdGhpcy0+dGVsZWdyYW1TZXJ2aWNlLT5zZW5kTWVzc2FnZSgkY2hhdElkLCAkdGV4dCk7CiAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICB9CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gc3ViUmVmZXJyYWwoJGNoYXRJZCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkcmVmZXJyYWxTZXR0aW5nQ250cmwgPSBuZXcgUmVmZXJyYWxTZXR0aW5nQ29udHJvbGxlcigpOwogICAgICAgICAgICAkc2V0dGluZ0NudHJsICAgICAgICAgPSBuZXcgU2V0dGluZ0NvbnRyb2xsZXIoKTsKICAgICAgICAgICAgJGJvdE5hbWUgICAgICAgICAgICAgID0gJHNldHRpbmdDbnRybC0+Z2V0X2JvdF9uYW1lKCk7CiAgICAgICAgICAgICRpbnZpdGVVcmwgICAgICAgICAgICA9ICJodHRwczovL3QubWUveyRib3ROYW1lfT9zdGFydD17JGNoYXRJZH0iOwoKICAgICAgICAgICAgLy8gZ2V0IHBlcmNlbnQgb2YgcmVmZXJyYWwKICAgICAgICAgICAgJHJlZmVycmFsUGVyY2VudCA9ICRyZWZlcnJhbFNldHRpbmdDbnRybC0+Z2V0X3JlZmVycmFsX3NldHRpbmdfcmVmZXJyYWxfcGVyY2VudCgpOwogICAgICAgICAgICAvLyBjaGVjayByZWZlcnJhbFBlcmNlbnQgaXMgbnVsbAogICAgICAgICAgICBpZiAoJHJlZmVycmFsUGVyY2VudCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAkcmVmZXJyYWxQZXJjZW50ID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBjaGVjayByZWZlcmFsIGlzIGRvdWJsZSBvciBub3QKCiAgICAgICAgICAgIC8vINiv2LHYtdivINqG2YjZhiDYp9i52LTYp9ixINmH2LPYqiDZiCDZhdiq2YYg2YfZhSDZgdin2LHYs9uM2Iwg2KrYsdiq24zYqCDZhtmI2LTYqtin2LHbjNi0INiq2LrbjNuM2LEg2YXbjCDaqdmG2Ycg2KjYsdin24wg2YfZhduM2YYg2YXbjCDYqNin24zYs9iqINmF2KrZhti0INix2Kcg2KjYtdmI2LHYqiDYp9iz2KrYsduM2YbaryDZiCDYqNix2LnaqdizINqp2YbbjNmFCiAgICAgICAgICAgIC8vINiq2KjYr9uM2YQg2KjZhyDYsdi02KrZhyDZiCDZhdi52qnZiNizINqp2LHYr9mGINiv2LHYtdivINio2LHYp9uMINmG2YXYp9uM2LQg2LXYrduM2K0g2K/YsSDZhdiq2YYg2YHYp9ix2LPbjAogICAgICAgICAgICAvLyDYqNix2LHYs9uMINin24zZhtqp2Ycg2KLbjNinINiv2LHYtdivINin2LnYtNin2LHbjCDZh9iz2Kog24zYpyDYrtuM2LEg2Ygg2Kfar9ixICDYsdmC2YUg2KfYudi02KfYsSDYp9mGINio2LHYp9io2LEg2KjYpyDYtdmB2LEg2YbYqNmI2K8KICAgICAgICAgICAgLy8gaWYgKGlzX2RvdWJsZSgkcmVmZXJyYWxQZXJjZW50KSkgewogICAgICAgICAgICAvLyAgICAgJHJlZmVycmFsUGVyY2VudFN0ciA9IChzdHJpbmcpICRyZWZlcnJhbFBlcmNlbnQ7CiAgICAgICAgICAgIC8vICAgICAkcmVmZXJyYWxQZXJjZW50U3RyID0gc3RycmV2KCRyZWZlcnJhbFBlcmNlbnRTdHIpOwogICAgICAgICAgICAvLyB9IGVsc2UgewogICAgICAgICAgICAvLyAgICAgJHJlZmVycmFsUGVyY2VudFN0ciA9ICIwIjsKICAgICAgICAgICAgLy8gfQoKICAgICAgICAgICAgJHRleHQgPSAkdGhpcy0+Y3VzdG9tVGV4dEN0cmwtPmdldFRleHQoJ2FjdGlvbi5yZWZlcnJhbC50ZXh0JywgWwogICAgICAgICAgICAgICAgJ2xpbmsnICAgID0+ICRpbnZpdGVVcmwsCiAgICAgICAgICAgICAgICAncGVyY2VudCcgPT4gJHJlZmVycmFsUGVyY2VudFN0ciwKICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPnNlbmRNZXNzYWdlKCRjaGF0SWQsICR0ZXh0KTsKICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIFxMb2c6OmVycm9yKFsic3ViUmVmZXJyYWw6ICIgLiAkdGhdKTsKICAgICAgICAgICAgJHRleHQgPSAkdGhpcy0+Y3VzdG9tVGV4dEN0cmwtPmdldFRleHQoJ2Vycm9yLnNlcnZlcl9lcnJvcicpOwogICAgICAgICAgICAkdGhpcy0+dGVsZWdyYW1TZXJ2aWNlLT5zZW5kTWVzc2FnZSgkY2hhdElkLCAkdGV4dCk7CiAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICB9CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gYmxvY2tfdXNlcl9jb21tYW5kKHN0cmluZyAkdHlwZSwgc3RyaW5nICRjaGF0SWQsIHN0cmluZyAkcmVhc29uID0gbnVsbCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkYmxvY2tlZFVzZXJDbnRybCA9IG5ldyBCbG9ja2VkVXNlckNvbnRyb2xsZXIoKTsKICAgICAgICAgICAgJHRleHQgICAgICAgICAgICAgPSBudWxsOwogICAgICAgICAgICBpZiAoJHR5cGUgPT0gJ2Jsb2NrJykgewogICAgICAgICAgICAgICAgJGJsb2NrZWRVc2VyQ250cmwtPmFkZEJsb2NrZWRVc2VyKG5ldyBSZXF1ZXN0KFsnYWNjb3VudElkJyA9PiAkY2hhdElkLCAncmVhc29uJyA9PiAkcmVhc29uXSkpOwogICAgICAgICAgICAgICAgJHRoaXMtPmFkZE5ld0JvdExvZygkdHlwZSwgItiq2YjYs9i3INmF2K/bjNixINmF2LPYr9mI2K8g2LTYry4iLCAkY2hhdElkLCAnc2hvdycpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJGJsb2NrZWRVc2VyQ250cmwtPnJlbW92ZUJsb2NrZWRVc2VyKG5ldyBSZXF1ZXN0KFsnYWNjb3VudElkJyA9PiAkY2hhdElkXSkpOwogICAgICAgICAgICAgICAgJHRoaXMtPmFkZE5ld0JvdExvZygkdHlwZSwgItix2YHYuSDZhdiz2K/ZiNiv24wg2KrZiNiz2Lcg2YXYr9uM2K8iLCAkY2hhdElkLCAnc2hvdycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBcTG9nOjplcnJvcihbImJsb2NrX3VzZXJfY29tbWFuZDogIiAuICR0aF0pOwogICAgICAgICAgICAkdGV4dCA9ICR0aGlzLT5jdXN0b21UZXh0Q3RybC0+Z2V0VGV4dCgnZXJyb3Iuc2VydmVyX2Vycm9yJyk7CiAgICAgICAgICAgICR0aGlzLT50ZWxlZ3JhbVNlcnZpY2UtPnNlbmRNZXNzYWdlKCRjaGF0SWQsICR0ZXh0KTsKICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIH0KICAgIH0KICAgIHByaXZhdGUgZnVuY3Rpb24gYWRkTmV3Qm90TG9nKCR0eXBlLCAkbWVzc2FnZSwgJGNoYXRJZCwgJG9wcikKICAgIHsKICAgICAgICAkbG9nQ3RybCA9IG5ldyBMb2dDb250cm9sbGVyKCk7CiAgICAgICAgJGxvZ0N0cmwtPmFkZE5ld0xvZygkdHlwZSwgJG1lc3NhZ2UsICRjaGF0SWQsICIiLCAkb3ByKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCn0K