<?php
bolt_decrypt( __FILE__ , 'sQK9fR'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnM7Cgp1c2UgQXBwXE1vZGVsc1xQYW5uZWw7CnVzZSBBcHBcTW9kZWxzXFByb3h5Owp1c2UgQXBwXE1vZGVsc1xJbmJvdW5kOwoKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxDYXJib247CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIEd1enpsZUh0dHBcQ2xpZW50Owp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcSHR0cDsKdXNlIFNpbXBsZVNvZnR3YXJlSU9cUXJDb2RlXEZhY2FkZXNcUXJDb2RlOwoKY2xhc3MgSGlkZGlmeVBhbm5lbENvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsKICAgIHB1YmxpYyBmdW5jdGlvbiBnZW5lcmF0ZVVVSUQoJGRhdGEgPSBudWxsKQogICAgewogICAgICAgIC8vIEdlbmVyYXRlIDE2IGJ5dGVzICgxMjggYml0cykgb2YgcmFuZG9tIGRhdGEgb3IgdXNlIHRoZSBkYXRhIHBhc3NlZCBpbnRvIHRoZSBmdW5jdGlvbi4KICAgICAgICAkZGF0YSA9ICRkYXRhID8/IHJhbmRvbV9ieXRlcygxNik7CiAgICAgICAgYXNzZXJ0KHN0cmxlbigkZGF0YSkgPT0gMTYpOwoKICAgICAgICAvLyBTZXQgdmVyc2lvbiB0byAwMTAwCiAgICAgICAgJGRhdGFbNl0gPSBjaHIoKG9yZCgkZGF0YVs2XSkgJiAweDBmKSB8IDB4NDApOwogICAgICAgIC8vIFNldCBiaXRzIDYtNyB0byAxMAogICAgICAgICRkYXRhWzhdID0gY2hyKChvcmQoJGRhdGFbOF0pICYgMHgzZikgfCAweDgwKTsKCiAgICAgICAgLy8gT3V0cHV0IHRoZSAzNiBjaGFyYWN0ZXIgVVVJRC4KICAgICAgICByZXR1cm4gdnNwcmludGYoJyVzJXMtJXMtJXMtJXMtJXMlcyVzJywgc3RyX3NwbGl0KGJpbjJoZXgoJGRhdGEpLCA0KSk7CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q2xlYXJIaWRkaWZ5UmVxdWVzdFVybCgkbWFpblVybCwgJHJlcXVlc3RBUGkpCiAgICB7CiAgICAgICAgLy8gZ2V0IHN1YnN0cmluZyBmcm9tIGVuZCBvZiBzdHIgdW50aWwgLwogICAgICAgICRtYWluVXJsID0gc3RyX3JlcGxhY2UoJy9hZG1pbi8nLCAnJywgJG1haW5VcmwpOwogICAgICAgICRtYWluVXJsID0gc3RyX3JlcGxhY2UoJy9hZG1pbicsICcnLCAkbWFpblVybCk7CiAgICAgICAgaWYgKHN0cl9zdGFydHNfd2l0aCgkcmVxdWVzdEFQaSwgJy8nKSkgewogICAgICAgICAgICAkcmVxdWVzdEFQaSA9IGx0cmltKCRyZXF1ZXN0QVBpLCAnLycpOwogICAgICAgIH0KICAgICAgICBpZiAoc3RyX2VuZHNfd2l0aCgkbWFpblVybCwgJy8nKSkgewogICAgICAgICAgICAkbWFpblVybCA9IHJ0cmltKCRtYWluVXJsLCAnLycpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gInskbWFpblVybH0veyRyZXF1ZXN0QVBpfSI7CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gZXh0cmFjdFVVSUQoJHN0cmluZykKICAgIHsKICAgICAgICAvLyBnZXQgc3Vic3RyaW5nIGJldHdlZW4gJy8nIGFuZCAnLycKICAgICAgICAkcGFydHMgPSBleHBsb2RlKCcvJywgJHN0cmluZyk7CgogICAgICAgIHJldHVybiAkcGFydHNbMV07CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gY2hlY2tIaWRkaWZ5UGFuZWxVcmwoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcGFubmVsVXJsID0gJHJlcXVlc3QtPnBhbm5lbFVybDsKICAgICAgICAvLyBjaGVjayBpcyAkcGFubmVsVXJsIGVuZGVkIHdpdGggIi8iCgogICAgICAgICRzZWNyZXRWYWx1ZSA9ICRyZXF1ZXN0LT5zZWNyZXRWYWx1ZTsKICAgICAgICBpZiAoc3RyX2VuZHNfd2l0aCgkcGFubmVsVXJsLCAnLycpKSB7CiAgICAgICAgICAgICRwYW5uZWxVcmwgPSBydHJpbSgkcGFubmVsVXJsLCAnLycpOwogICAgICAgIH0KCiAgICAgICAgJGNsaWVudCA9IG5ldyBDbGllbnQoWydjb29raWVzJyA9PiB0cnVlXSk7CgogICAgICAgICRyZXNwb25zZSA9ICRjbGllbnQtPnBvc3QoInskcGFubmVsVXJsfS8iLCBbCiAgICAgICAgICAgICdmb3JtX3BhcmFtcycgPT4gWwogICAgICAgICAgICAgICAgJ3NlY3JldF90ZXh0Ym94JyA9PiAkc2VjcmV0VmFsdWUsCiAgICAgICAgICAgIF0sCiAgICAgICAgXSk7CiAgICAgICAgJHN0YXR1c0NvZGUgPSAkcmVzcG9uc2UtPmdldFN0YXR1c0NvZGUoKTsKCiAgICAgICAgaWYgKCRzdGF0dXNDb2RlID09PSAyMDApIHsKICAgICAgICAgICAgJGNvb2tpZUphciA9IG5ldyBcR3V6emxlSHR0cFxDb29raWVcQ29va2llSmFyKCk7CiAgICAgICAgICAgICRjb29raWVKYXIgPSAkcmVzcG9uc2UtPmdldEhlYWRlcignU2V0LUNvb2tpZScpOwogICAgICAgICAgICAkYXJyID0gZXhwbG9kZSgnOycsICRjb29raWVKYXJbMF0pOwoKICAgICAgICAgICAgJGNvb2sgPSAkYXJyWzBdOwogICAgICAgICAgICAkZGVsaW1pdGVyUG9zID0gc3RycG9zKCRjb29rLCAnPScpOwogICAgICAgICAgICAkY29vayA9IHN1YnN0cigkY29vaywgJGRlbGltaXRlclBvcyArIDEpOwoKICAgICAgICAgICAgJGhlYWRlcnMgPSBbCiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJyA9PiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgICAgICAnQWNjZXB0JyA9PiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgIF07CgogICAgICAgICAgICAkY29va2llcyA9IFsKICAgICAgICAgICAgICAgICdzZXNzaW9uJyA9PiAkY29vaywKICAgICAgICAgICAgXTsKICAgICAgICAgICAgJHVybCA9ICIkcGFubmVsVXJsL2FwaS92Mi9hZG1pbi9zZXJ2ZXJfc3RhdHVzLyI7CgogICAgICAgICAgICAkc3Vic2VxdWVudFJlc3BvbnNlID0gSHR0cDo6d2l0aENvb2tpZXMoJGNvb2tpZXMsIHBhcnNlX3VybCgkdXJsLCBQSFBfVVJMX0hPU1QpKS0+Z2V0KCR1cmwpOwoKICAgICAgICAgICAgaWYgKCRzdWJzZXF1ZW50UmVzcG9uc2UtPmdldFN0YXR1c0NvZGUoKSA9PSAyMDApIHsKICAgICAgICAgICAgICAgICRjaGVja0lzSHRtbFBhZ2UgPSBzdHJwb3MoJHN1YnNlcXVlbnRSZXNwb25zZS0+Z2V0Qm9keSgpLCAnPGh0bWw+Jyk7CiAgICAgICAgICAgICAgICBpZiAoJGNoZWNrSXNIdG1sUGFnZSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihmYWxzZSwgNDAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKHRydWUsIDIwMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oZmFsc2UsIDQwMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oZmFsc2UsIDQwMSk7CiAgICAgICAgfQogICAgfQogICAgcHVibGljIGZ1bmN0aW9uIGdldE5ld0Nvb2tpZVRva2VuKCRwYW5uZWxJRCkKICAgIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIC8vICRwYW5uZWwgPSBQYW5uZWw6OmZpbmQoJHBhbm5lbElEKTsKCiAgICAgICAgLy8gJHBhbm5lbFVybCA9ICRwYW5uZWwtPmFkbWluX3VybDsKICAgICAgICAvLyAvLyBjaGVjayBpcyAkcGFubmVsVXJsIGVuZGVkIHdpdGggIi8iCgogICAgICAgIC8vICRzZWNyZXRWYWx1ZSA9ICRwYW5uZWwtPnNlY3JldF9jb2RlOwogICAgICAgIC8vIGlmIChzdHJfZW5kc193aXRoKCRwYW5uZWxVcmwsICcvJykpIHsKICAgICAgICAvLyAgICAgJHBhbm5lbFVybCA9IHJ0cmltKCRwYW5uZWxVcmwsICcvJyk7CiAgICAgICAgLy8gfQoKICAgICAgICAvLyAkY2xpZW50ID0gbmV3IENsaWVudChbJ2Nvb2tpZXMnID0+IHRydWVdKTsKCiAgICAgICAgLy8gJHJlc3BvbnNlID0gJGNsaWVudC0+cG9zdCgieyRwYW5uZWxVcmx9LyIsIFsKICAgICAgICAvLyAgICAgJ2Zvcm1fcGFyYW1zJyA9PiBbCiAgICAgICAgLy8gICAgICAgICAnc2VjcmV0X3RleHRib3gnID0+ICRzZWNyZXRWYWx1ZSwKICAgICAgICAvLyAgICAgXSwKICAgICAgICAvLyBdKTsKICAgICAgICAvLyAkc3RhdHVzQ29kZSA9ICRyZXNwb25zZS0+Z2V0U3RhdHVzQ29kZSgpOwoKICAgICAgICAvLyBpZiAoJHN0YXR1c0NvZGUgPT09IDIwMCkgewogICAgICAgIC8vICAgICAkY29va2llSmFyID0gbmV3IFxHdXp6bGVIdHRwXENvb2tpZVxDb29raWVKYXIoKTsKICAgICAgICAvLyAgICAgJGNvb2tpZUphciA9ICRyZXNwb25zZS0+Z2V0SGVhZGVyKCdTZXQtQ29va2llJyk7CiAgICAgICAgLy8gICAgICRhcnIgPSBleHBsb2RlKCc7JywgJGNvb2tpZUphclswXSk7CgogICAgICAgIC8vICAgICAkY29vayA9ICRhcnJbMF07CiAgICAgICAgLy8gICAgICRkZWxpbWl0ZXJQb3MgPSBzdHJwb3MoJGNvb2ssICc9Jyk7CiAgICAgICAgLy8gICAgICRjb29rID0gc3Vic3RyKCRjb29rLCAkZGVsaW1pdGVyUG9zICsgMSk7CgogICAgICAgIC8vICAgICAkaGVhZGVycyA9IFsKICAgICAgICAvLyAgICAgICAgICdDb250ZW50LVR5cGUnID0+ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAvLyAgICAgICAgICdBY2NlcHQnID0+ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAvLyAgICAgXTsKCiAgICAgICAgLy8gICAgICRjb29raWVzID0gWwogICAgICAgIC8vICAgICAgICAgJ3Nlc3Npb24nID0+ICRjb29rLAogICAgICAgIC8vICAgICBdOwogICAgICAgIC8vICAgICAkdXJsID0gInskcGFubmVsVXJsfS9hcGkvdjIvYWRtaW4vc2VydmVyX3N0YXR1cy8iOwoKICAgICAgICAvLyAgICAgJHN1YnNlcXVlbnRSZXNwb25zZSA9IEh0dHA6OndpdGhDb29raWVzKCRjb29raWVzLCBwYXJzZV91cmwoJHVybCwgUEhQX1VSTF9IT1NUKSktPmdldCgkdXJsKTsKCiAgICAgICAgLy8gICAgIGlmICgkc3Vic2VxdWVudFJlc3BvbnNlLT5nZXRTdGF0dXNDb2RlKCkgPT0gMjAwKSB7CiAgICAgICAgLy8gICAgICAgICAkY2hlY2tJc0h0bWxQYWdlID0gc3RycG9zKCRzdWJzZXF1ZW50UmVzcG9uc2UtPmdldEJvZHkoKSwgJzxodG1sPicpOwogICAgICAgIC8vICAgICAgICAgaWYgKCRjaGVja0lzSHRtbFBhZ2UgIT09IGZhbHNlKSB7CiAgICAgICAgLy8gICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIC8vICAgICAgICAgfQogICAgICAgIC8vICAgICAgICAgLy8gc2F2ZSBuZXcgaGVhZGVyIGNvb2tpZQogICAgICAgIC8vICAgICAgICAgJHBhbm5lbC0+Y29va2llX3Nlc3Npb24gPSAkY29vazsKICAgICAgICAvLyAgICAgICAgICRwYW5uZWwtPnVwZGF0ZSgpOwogICAgICAgIC8vICAgICAgICAgXExvZzo6aW5mbygncGFubmVsIGNvb2tpZSB1cGRhdGVkJyk7CiAgICAgICAgLy8gICAgIH0KICAgICAgICAvLyAgICAgcmV0dXJuOwogICAgICAgIC8vIH0gZWxzZSB7CiAgICAgICAgLy8gICAgIHJldHVybjsKICAgICAgICAvLyB9CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkSGlkZGlmeVBhbm5lbChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRhdXRoQ250cmwgPSBuZXcgQXV0aENvbnRyb2xsZXIoKTsKICAgICAgICAgICAgJGdldFBvd2VyUHNMaWNlbnNlVHlwZSA9ICRhdXRoQ250cmwtPmdldFBvd2VyUHNMaWNlbnNlVHlwZSgpOwogICAgICAgICAgICAvLyBjaGVjayBsaWNlbnNlCiAgICAgICAgICAgICRwYW5lbENvdW50ID0gcGFubmVsOjp3aGVyZSgndHlwZScsICdoaWRkaWZ5JyktPmNvdW50KCk7CiAgICAgICAgICAgICRoYXNBY2NvdW50TGltaXRhdGlvbiA9IGZhbHNlOwogICAgICAgICAgICBpZiAoJHBhbmVsQ291bnQgPj0gMiAmJiAkZ2V0UG93ZXJQc0xpY2Vuc2VUeXBlID09ICdzaWx2ZXInKSB7CiAgICAgICAgICAgICAgICAkaGFzQWNjb3VudExpbWl0YXRpb24gPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkcGFuZWxDb3VudCA+PSAxICYmICRnZXRQb3dlclBzTGljZW5zZVR5cGUgPT0gJ2ZyZWUnKSB7CiAgICAgICAgICAgICAgICAkaGFzQWNjb3VudExpbWl0YXRpb24gPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkaGFzQWNjb3VudExpbWl0YXRpb24gPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oJ9io2Ycg2YXYrdiv2YjYr9uM2Kog2KfZgdiy2YjYr9mGINm+2YbZhCDYsdiz24zYr9mHINin24zYr9iMINio2LHYp9uMINin2YHYstmI2K/ZhiDZvtmG2YQg2KzYr9uM2K8g2KjYpyDZvti02KrbjNio2KfZhtuMINiq2YXYp9izINio2q/bjNix24zYryDZiCDYp9qp2KfZhtiqINiu2YjYryDYsdinINin2LHYqtmC2Kcg2KjYr9mH24zYry4nLCAyMDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGFkZCBwYW5uZWwKICAgICAgICAgICAgJHBhbm5lbCA9IG5ldyBQYW5uZWwoKTsKICAgICAgICAgICAgJHBhbm5lbC0+dHlwZSA9ICdoaWRkaWZ5JzsKICAgICAgICAgICAgJHBhbm5lbC0+bG9jYXRpb24gPSAkcmVxdWVzdC0+bG9jYXRpb24gPz8gbnVsbDsKICAgICAgICAgICAgJHBhbm5lbC0+YWRtaW5fdXJsID0gJHJlcXVlc3QtPmFkbWluX3VybDsKICAgICAgICAgICAgJHBhbm5lbC0+dXNlcl9saW5rID0gJHJlcXVlc3QtPnVzZXJfbGluayA/PyBudWxsOwogICAgICAgICAgICAkcGFubmVsLT5jYXBhY2l0eSA9ICRyZXF1ZXN0LT5jYXBhY2l0eSA/PyAxMzMzMzMzOwogICAgICAgICAgICAkcGFubmVsLT5zZWNyZXRfY29kZSA9ICRyZXF1ZXN0LT5zZWNyZXRWYWx1ZTsKICAgICAgICAgICAgJHBhbm5lbC0+dXJsX3BvcnQgPSBwYXJzZV91cmwoJHJlcXVlc3QtPmFkbWluX3VybCwgUEhQX1VSTF9IT1NUKTsKICAgICAgICAgICAgLy8gY2hlY2sgY29va2llCiAgICAgICAgICAgICRwYW5uZWwtPnNhdmUoKTsKICAgICAgICAgICAgJHRoaXMtPmNoZWNrQ29va2llU2Vhc29uKCRwYW5uZWwtPmlkKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oJHBhbm5lbC0+aWQsIDIwMCk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgXExvZzo6aW5mbygiVGhyb3dhYmxlICR0aCIpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihmYWxzZSwgNTAwKTsKICAgICAgICB9CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gdXBkYXRlSGlkZGlmeVBhbm5lbChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRwYW5uZWwgPSBQYW5uZWw6OmZpbmQoJHJlcXVlc3QtPmlkKTsKICAgICAgICAgICAgJHBhbm5lbC0+bG9jYXRpb24gPSAkcmVxdWVzdC0+bG9jYXRpb24gPz8gbnVsbDsKICAgICAgICAgICAgJHBhbm5lbC0+YWRtaW5fdXJsID0gJHJlcXVlc3QtPmFkbWluX3VybDsKICAgICAgICAgICAgJHBhbm5lbC0+Y2FwYWNpdHkgPSAkcmVxdWVzdC0+Y2FwYWNpdHkgPz8gMTMzMzMzMzsKICAgICAgICAgICAgJHBhbm5lbC0+c2VjcmV0X2NvZGUgPSAkcmVxdWVzdC0+c2VjcmV0VmFsdWU7CiAgICAgICAgICAgICRwYW5uZWwtPnVzZXJfbGluayA9ICRyZXF1ZXN0LT51c2VyX2xpbmsgPz8gbnVsbDsKCiAgICAgICAgICAgICRwYW5uZWwtPnVybF9wb3J0ID0gcGFyc2VfdXJsKCRyZXF1ZXN0LT5hZG1pbl91cmwsIFBIUF9VUkxfSE9TVCk7CiAgICAgICAgICAgIC8vIGNoZWNrIGNvb2tpZQogICAgICAgICAgICBpZiAoJHBhbm5lbC0+dXBkYXRlKCkpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5nZXROZXdDb29raWVUb2tlbigkcmVxdWVzdC0+aWQpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24odHJ1ZSwgMjAxKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oZmFsc2UsIDUwMCk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgXExvZzo6aW5mbygiVGhyb3dhYmxlICR0aCIpOwoKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oZmFsc2UsIDUwMCk7CiAgICAgICAgfQogICAgfQogICAgcHVibGljIGZ1bmN0aW9uIGNoZWNrQ29va2llU2Vhc29uKCRwYW5uZWxJRCkKICAgIHsKICAgICAgICAkcGFubmVsID0gUGFubmVsOjpmaW5kKCRwYW5uZWxJRCk7CiAgICAgICAgJGNoZWNrTGFzdFRpbWVVcGRhdGVkID0gJHBhbm5lbC0+dXBkYXRlZF9hdC0+ZGlmZkluRGF5cyhub3coKSkgPiA1OwoKICAgICAgICBpZiAoJHBhbm5lbC0+c2VjcmV0X2NvZGUgPT0gbnVsbCB8fCAoJHBhbm5lbC0+c2VjcmV0X2NvZGUgPSAnJyB8fCAkY2hlY2tMYXN0VGltZVVwZGF0ZWQgPT0gZmFsc2UpKSB7CiAgICAgICAgICAgICR0aGlzLT5nZXROZXdDb29raWVUb2tlbigkcGFubmVsSUQpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICByZXR1cm47CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0SGlkZGlmeVBhbmVsVXNlcnNCeVBhbm5lbElEKCRwYW5uZWxJRCkKICAgIHsKICAgICAgICAkcGFubmVsID0gUGFubmVsOjpmaW5kKCRwYW5uZWxJRCk7CgogICAgICAgICRhZG1pblVVSUQgPSAkcGFubmVsLT5zZWNyZXRfY29kZTsKCiAgICAgICAgJGRhdGEgPSAkdGhpcy0+c2VuZEdldFJlcXVlc3RUb0hpZGRpZnlQYW5uZWwoJHBhbm5lbElELCAiJGFkbWluVVVJRC9hcGkvdjEvdXNlci8iKTsKICAgICAgICByZXR1cm4gJGRhdGE7CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0SGlkZGlmeVBhbmVsVXNlckJ5UGFubmVsSUQoJHBhbm5lbElELCAkdXNlclVVSUQpCiAgICB7CiAgICAgICAgJGRhdGEgPSAkdGhpcy0+c2VuZEdldFJlcXVlc3RUb0hpZGRpZnlQYW5uZWwoJHBhbm5lbElELCAiYXBpL3YyL2FkbWluL3VzZXIvJHVzZXJVVUlELyIpOwogICAgICAgIHJldHVybiAkZGF0YTsKICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRIaWRkaWZ5UGFuZWxBbGxDb25maWdzVXNlckJ5UGFubmVsSUQoJHBhbm5lbElELCAkdXNlclVVSUQpCiAgICB7CiAgICAgICAgJGRhdGEgPSAkdGhpcy0+c2VuZEdldFJlcXVlc3RUb0hpZGRpZnlQYW5uZWwoJHBhbm5lbElELCAnL2FwaS92Mi91c2VyL2FsbC1jb25maWdzLycpOwogICAgICAgIHJldHVybiAkZGF0YTsKICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRVc2VyVG9IaWRkaWZ5UGFuZWwoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcGFubmVsSUQgPSAkcmVxdWVzdC0+cGFubmVsSUQ7CiAgICAgICAgJHZvbCA9ICRyZXF1ZXN0LT52b2w7CiAgICAgICAgJGRheSA9ICRyZXF1ZXN0LT5kYXk7CiAgICAgICAgJGFjY291bnRJZCA9ICRyZXF1ZXN0LT5hY2NvdW50SWQ7CiAgICAgICAgJHBhbm5lbCA9IFBhbm5lbDo6ZmluZCgkcGFubmVsSUQpOwoKICAgICAgICAkYWRtaW5VVUlEID0gJHBhbm5lbC0+c2VjcmV0X2NvZGU7CiAgICAgICAgJGNvbW1lbnQgPSAkcmVxdWVzdC0+Y29tbWVudCA/PyAnJzsKCiAgICAgICAgJHV1aWQgPSAkdGhpcy0+Z2VuZXJhdGVVVUlEKCk7CiAgICAgICAgJHBhcmFtcyA9IFsKICAgICAgICAgICAgJ3V1aWQnID0+ICIkdXVpZCIsCiAgICAgICAgICAgICduYW1lJyA9PiAiYm90JGFjY291bnRJZCIsCiAgICAgICAgICAgICdjdXJyZW50X3VzYWdlX0dCJyA9PiAwLAogICAgICAgICAgICAndXNhZ2VfbGltaXRfR0InID0+ICR2b2wsCiAgICAgICAgICAgICdwYWNrYWdlX2RheXMnID0+ICRkYXksCiAgICAgICAgICAgICdtb2RlJyA9PiAnbm9fcmVzZXQnLAogICAgICAgICAgICAnYWRkZWRfYnlfdXVpZCcgPT4gIiRhZG1pblVVSUQiLAogICAgICAgICAgICAnY29tbWVudCcgPT4gIiRjb21tZW50IiwKICAgICAgICBdOwogICAgICAgICRkYXRhID0gJHRoaXMtPnNlbmRQdXRSZXF1ZXN0VG9IaWRkaWZ5UGFubmVsKCRwYW5uZWxJRCwgJy9hcGkvdjIvYWRtaW4vdXNlci8nLCAkcGFyYW1zKTsKICAgICAgICBpZiAoJGRhdGEgIT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuICR1dWlkOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJGRhdGE7CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkVXNlclRvSGlkZGlmeVBhbmVsT2xkQXBpKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHBhbm5lbElEID0gJHJlcXVlc3QtPnBhbm5lbElEOwogICAgICAgICR2b2wgPSAkcmVxdWVzdC0+dm9sOwogICAgICAgICRkYXkgPSAkcmVxdWVzdC0+ZGF5OwogICAgICAgICRhY2NvdW50SWQgPSAkcmVxdWVzdC0+YWNjb3VudElkOwogICAgICAgICRwYW5uZWwgPSBQYW5uZWw6OmZpbmQoJHBhbm5lbElEKTsKCiAgICAgICAgJGFkbWluVVVJRCA9ICRwYW5uZWwtPnNlY3JldF9jb2RlOwogICAgICAgICRjb21tZW50ID0gJHJlcXVlc3QtPmNvbW1lbnQgPz8gJyc7CgogICAgICAgICR1dWlkID0gJHRoaXMtPmdlbmVyYXRlVVVJRCgpOwogICAgICAgICRwYXJhbXMgPSBbCiAgICAgICAgICAgICd1dWlkJyA9PiAiJHV1aWQiLAogICAgICAgICAgICAnbmFtZScgPT4gImJvdCRhY2NvdW50SWQiLAogICAgICAgICAgICAnY3VycmVudF91c2FnZV9HQicgPT4gMCwKICAgICAgICAgICAgJ3VzYWdlX2xpbWl0X0dCJyA9PiAkdm9sLAogICAgICAgICAgICAncGFja2FnZV9kYXlzJyA9PiAkZGF5LAogICAgICAgICAgICAnbW9kZScgPT4gJ25vX3Jlc2V0JywKICAgICAgICAgICAgJ2FkZGVkX2J5X3V1aWQnID0+ICIkYWRtaW5VVUlEIiwKICAgICAgICAgICAgJ2NvbW1lbnQnID0+ICIkY29tbWVudCIsCiAgICAgICAgXTsKICAgICAgICAkZGF0YSA9ICR0aGlzLT5zZW5kUG9zdFJlcXVlc3RUb0hpZGRpZnlQYW5uZWwoJHBhbm5lbElELCAiJGFkbWluVVVJRC9hcGkvdjEvdXNlci8iLCAkcGFyYW1zKTsKICAgICAgICBpZiAoJGRhdGEgIT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuICR1dWlkOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJGRhdGE7CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gdXBkYXRlVXNlck9mSGlkZGlmeVBhbmVsKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHBhbm5lbElEID0gJHJlcXVlc3QtPnBhbm5lbElEOwogICAgICAgICRwYW5uZWwgPSBQYW5uZWw6OmZpbmQoJHBhbm5lbElEKTsKCiAgICAgICAgJHZvbCA9ICRyZXF1ZXN0LT52b2w7CiAgICAgICAgJGRheSA9ICRyZXF1ZXN0LT5kYXk7CiAgICAgICAgJGFjY291bnRJZCA9ICRyZXF1ZXN0LT5hY2NvdW50SWQ7CiAgICAgICAgJGFkbWluVVVJRCA9ICRwYW5uZWwtPnNlY3JldF9jb2RlOwogICAgICAgICR1dWlkID0gJHJlcXVlc3QtPnV1aWQ7CiAgICAgICAgJGNvbW1lbnQgPSAkcmVxdWVzdC0+Y29tbWVudCA/PyAnJzsKICAgICAgICAkcGFyYW1zID0gWwogICAgICAgICAgICAndXVpZCcgPT4gIiR1dWlkIiwKICAgICAgICAgICAgJ25hbWUnID0+ICdhc2Rhc2RzYScsCiAgICAgICAgICAgIC8vICduYW1lJyA9PiAiYm90JGFjY291bnRJZCIsCiAgICAgICAgICAgICdjdXJyZW50X3VzYWdlX0dCJyA9PiAwLAogICAgICAgICAgICAndXNhZ2VfbGltaXRfR0InID0+ICR2b2wsCiAgICAgICAgICAgICdwYWNrYWdlX2RheXMnID0+ICRkYXksCiAgICAgICAgICAgICdtb2RlJyA9PiAnbm9fcmVzZXQnLAogICAgICAgICAgICAnYWRkZWRfYnlfdXVpZCcgPT4gIiRhZG1pblVVSUQiLAogICAgICAgICAgICAnY29tbWVudCcgPT4gIiRjb21tZW50IiwKICAgICAgICBdOwogICAgICAgICRkYXRhID0gJHRoaXMtPnNlbmRQYXRjaFJlcXVlc3RUb0hpZGRpZnlQYW5uZWwoJHBhbm5lbElELCAiL2FwaS92Mi9hZG1pbi91c2VyLyR1dWlkLyIsICRwYXJhbXMpOwogICAgICAgIHJldHVybiAkZGF0YTsKICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiB1cGRhdGVVc2VyTmFtZU9mSGlkZGlmeVBhbmVsT2xkQXBpKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHBhbm5lbElEID0gJHJlcXVlc3QtPnBhbm5lbElEOwogICAgICAgICRwYW5uZWwgPSBQYW5uZWw6OmZpbmQoJHBhbm5lbElEKTsKICAgICAgICAkYWRtaW5VVUlEID0gJHBhbm5lbC0+c2VjcmV0X2NvZGU7CgogICAgICAgICR1dWlkID0gJHJlcXVlc3QtPnV1aWQ7CiAgICAgICAgJG5hbWUgPSAkcmVxdWVzdC0+bmFtZSA/PyAnJzsKICAgICAgICAkcGFyYW1zID0gWwogICAgICAgICAgICAndXVpZCcgPT4gIiR1dWlkIiwKICAgICAgICAgICAgJ25hbWUnID0+ICIkbmFtZSIsCiAgICAgICAgXTsKICAgICAgICAkdXJsID0gJHRoaXMtPmdldENsZWFySGlkZGlmeVJlcXVlc3RVcmwoJHBhbm5lbC0+YWRtaW5fdXJsLCAkcGFubmVsLT5zZWNyZXRfY29kZSk7CiAgICAgICAgJHVybCA9ICIkYWRtaW5VVUlEL2FwaS92MS91c2VyLz91dWlkPXskdXVpZH0iOwoKICAgICAgICAkZGF0YSA9ICR0aGlzLT5zZW5kUG9zdFJlcXVlc3RUb0hpZGRpZnlQYW5uZWwoJHBhbm5lbElELCAkdXJsLCAkcGFyYW1zKTsKICAgICAgICByZXR1cm4gJGRhdGE7CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gcmVjaGFyZ2VVc2VyT2ZIaWRkaWZ5UGFuZWxPbGRBcGkoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcGFubmVsSUQgPSAkcmVxdWVzdC0+cGFubmVsSUQ7CiAgICAgICAgJHBhbm5lbCA9IFBhbm5lbDo6ZmluZCgkcGFubmVsSUQpOwogICAgICAgICR2b2wgPSAkcmVxdWVzdC0+dm9sOwogICAgICAgICRkYXkgPSAkcmVxdWVzdC0+ZGF5OwoKICAgICAgICAkYWRtaW5VVUlEID0gJHBhbm5lbC0+c2VjcmV0X2NvZGU7CgogICAgICAgICR1dWlkID0gJHJlcXVlc3QtPnV1aWQ7CiAgICAgICAgJG5hbWUgPSAkcmVxdWVzdC0+bmFtZSA/PyAnJzsKICAgICAgICAkY29tbWVudCA9ICRyZXF1ZXN0LT5jb21tZW50ID8/ICcnOwogICAgICAgIC8vIGdldCB0b2RheSBkYXRlIGFzIGZvcm1hdCBsaWtlIDIwMjQtMDEtMDEKICAgICAgICAkdG9kYXkgPSBkYXRlKCdZLW0tZCcpOwogICAgICAgICRwYXJhbXMgPSBbCiAgICAgICAgICAgICd1dWlkJyA9PiAiJHV1aWQiLAogICAgICAgICAgICAnbmFtZScgPT4gIiRuYW1lIiwKICAgICAgICAgICAgJ2N1cnJlbnRfdXNhZ2VfR0InID0+IDAsCiAgICAgICAgICAgICd1c2FnZV9saW1pdF9HQicgPT4gJHZvbCwKICAgICAgICAgICAgJ3BhY2thZ2VfZGF5cycgPT4gJGRheSwKICAgICAgICAgICAgJ21vZGUnID0+ICdub19yZXNldCcsCiAgICAgICAgICAgICdzdGFydF9kYXRlJyA9PiAiJHRvZGF5IiwKICAgICAgICAgICAgJ2FkZGVkX2J5X3V1aWQnID0+ICIkYWRtaW5VVUlEIiwKICAgICAgICAgICAgJ2NvbW1lbnQnID0+ICIkY29tbWVudCIsCiAgICAgICAgXTsKICAgICAgICAkdXJsID0gJHRoaXMtPmdldENsZWFySGlkZGlmeVJlcXVlc3RVcmwoJHBhbm5lbC0+YWRtaW5fdXJsLCAkcGFubmVsLT5zZWNyZXRfY29kZSk7CiAgICAgICAgJHVybCA9ICIkYWRtaW5VVUlEL2FwaS92MS91c2VyLz91dWlkPXskdXVpZH0iOwoKICAgICAgICAkZGF0YSA9ICR0aGlzLT5zZW5kUG9zdFJlcXVlc3RUb0hpZGRpZnlQYW5uZWwoJHBhbm5lbElELCAkdXJsLCAkcGFyYW1zKTsKICAgICAgICByZXR1cm4gJGRhdGE7CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gdXBncmFkZVVzZXJPZkhpZGRpZnlQYW5lbE9sZEFwaShSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRwYW5uZWxJRCA9ICRyZXF1ZXN0LT5wYW5uZWxJRDsKICAgICAgICAkcGFubmVsID0gUGFubmVsOjpmaW5kKCRwYW5uZWxJRCk7CiAgICAgICAgJHZvbCA9ICRyZXF1ZXN0LT52b2w7CiAgICAgICAgJGRheSA9ICRyZXF1ZXN0LT5kYXk7CgogICAgICAgICRhZG1pblVVSUQgPSAkcGFubmVsLT5zZWNyZXRfY29kZTsKCiAgICAgICAgJHV1aWQgPSAkcmVxdWVzdC0+dXVpZDsKICAgICAgICAkbmFtZSA9ICRyZXF1ZXN0LT5uYW1lID8/ICcnOwogICAgICAgICRjb21tZW50ID0gJHJlcXVlc3QtPmNvbW1lbnQgPz8gJyc7CiAgICAgICAgLy8gZ2V0IHRvZGF5IGRhdGUgYXMgZm9ybWF0IGxpa2UgMjAyNC0wMS0wMQogICAgICAgICR0b2RheSA9IGRhdGUoJ1ktbS1kJyk7CiAgICAgICAgJHBhcmFtcyA9IFsKICAgICAgICAgICAgJ3V1aWQnID0+ICIkdXVpZCIsCiAgICAgICAgICAgICduYW1lJyA9PiAiJG5hbWUiLAogICAgICAgICAgICAndXNhZ2VfbGltaXRfR0InID0+ICR2b2wsCiAgICAgICAgICAgICdwYWNrYWdlX2RheXMnID0+ICRkYXksCiAgICAgICAgICAgICdtb2RlJyA9PiAnbm9fcmVzZXQnLAogICAgICAgICAgICAnYWRkZWRfYnlfdXVpZCcgPT4gIiRhZG1pblVVSUQiLAogICAgICAgICAgICAnY29tbWVudCcgPT4gIiRjb21tZW50IiwKICAgICAgICBdOwogICAgICAgICR1cmwgPSAkdGhpcy0+Z2V0Q2xlYXJIaWRkaWZ5UmVxdWVzdFVybCgkcGFubmVsLT5hZG1pbl91cmwsICRwYW5uZWwtPnNlY3JldF9jb2RlKTsKICAgICAgICAkdXJsID0gIiRhZG1pblVVSUQvYXBpL3YxL3VzZXIvP3V1aWQ9eyR1dWlkfSI7CgogICAgICAgICRkYXRhID0gJHRoaXMtPnNlbmRQb3N0UmVxdWVzdFRvSGlkZGlmeVBhbm5lbCgkcGFubmVsSUQsICR1cmwsICRwYXJhbXMpOwogICAgICAgIHJldHVybiAkZGF0YTsKICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiBjaGFuZ2VVc2VyQWN0aXZhdGlvbk9mSGlkZGlmeVBhbmVsT2xkQXBpKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHBhbm5lbElEID0gJHJlcXVlc3QtPnBhbm5lbElEOwogICAgICAgICRwYW5uZWwgPSBQYW5uZWw6OmZpbmQoJHBhbm5lbElEKTsKCiAgICAgICAgJGFkbWluVVVJRCA9ICRwYW5uZWwtPnNlY3JldF9jb2RlOwoKICAgICAgICAkdXVpZCA9ICRyZXF1ZXN0LT51dWlkOwogICAgICAgICRjb21tZW50ID0gJHJlcXVlc3QtPmNvbW1lbnQgPz8gJyc7CgogICAgICAgICRlbmFibGUgPSAkcmVxdWVzdC0+ZW5hYmxlID09IHRydWUgfHwgJHJlcXVlc3QtPmVuYWJsZSA9PSAxID8gdHJ1ZSA6IGZhbHNlOwogICAgICAgIC8vIGdldCB0b2RheSBkYXRlIGFzIGZvcm1hdCBsaWtlIDIwMjQtMDEtMDEKICAgICAgICAkdG9kYXkgPSBkYXRlKCdZLW0tZCcpOwogICAgICAgICRwYXJhbXMgPSBbCiAgICAgICAgICAgICd1dWlkJyA9PiAiJHV1aWQiLAogICAgICAgICAgICAnY29tbWVudCcgPT4gIiRjb21tZW50IiwKICAgICAgICAgICAgJ2VuYWJsZScgPT4gJGVuYWJsZSwKICAgICAgICAgICAgJ2FkZGVkX2J5X3V1aWQnID0+ICIkYWRtaW5VVUlEIiwKICAgICAgICBdOwogICAgICAgICR1cmwgPSAkdGhpcy0+Z2V0Q2xlYXJIaWRkaWZ5UmVxdWVzdFVybCgkcGFubmVsLT5hZG1pbl91cmwsICRwYW5uZWwtPnNlY3JldF9jb2RlKTsKICAgICAgICAkdXJsID0gIiRhZG1pblVVSUQvYXBpL3YxL3VzZXIvP3V1aWQ9eyR1dWlkfSI7CgogICAgICAgICRkYXRhID0gJHRoaXMtPnNlbmRQb3N0UmVxdWVzdFRvSGlkZGlmeVBhbm5lbCgkcGFubmVsSUQsICR1cmwsICRwYXJhbXMpOwogICAgICAgIHJldHVybiAkZGF0YTsKICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiBkZWxldGVVc2VyT2ZIaWRkaWZ5UGFuZWxPbGRBcGkoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcGFubmVsSUQgPSAkcmVxdWVzdC0+cGFubmVsSUQ7CiAgICAgICAgJHBhbm5lbCA9IFBhbm5lbDo6ZmluZCgkcGFubmVsSUQpOwogICAgICAgICR2b2wgPSAkcmVxdWVzdC0+dm9sOwogICAgICAgICRkYXkgPSAkcmVxdWVzdC0+ZGF5OwoKICAgICAgICAkYWRtaW5VVUlEID0gJHBhbm5lbC0+c2VjcmV0X2NvZGU7CgogICAgICAgICR1dWlkID0gJHJlcXVlc3QtPnV1aWQ7CiAgICAgICAgJG5hbWUgPSAkcmVxdWVzdC0+bmFtZSA/PyAnJzsKICAgICAgICAkY29tbWVudCA9ICRyZXF1ZXN0LT5jb21tZW50ID8/ICcnOwoKICAgICAgICAkcGFyYW1zID0gWwogICAgICAgICAgICAndXVpZCcgPT4gIiR1dWlkIiwKICAgICAgICAgICAgJ25hbWUnID0+ICIkbmFtZSIsCiAgICAgICAgICAgICd1c2FnZV9saW1pdF9HQicgPT4gJHZvbCwKICAgICAgICAgICAgJ3BhY2thZ2VfZGF5cycgPT4gJGRheSwKICAgICAgICAgICAgJ21vZGUnID0+ICdub19yZXNldCcsCiAgICAgICAgICAgICdhZGRlZF9ieV91dWlkJyA9PiAiJGFkbWluVVVJRCIsCiAgICAgICAgICAgICdjb21tZW50JyA9PiAiJGNvbW1lbnQiLAogICAgICAgICAgICAnZW5hYmxlJyA9PiBmYWxzZSwKICAgICAgICAgICAgJ3N0YXJ0X2RhdGUnID0+ICcyMDI0LTAxLTAxJywKICAgICAgICBdOwogICAgICAgICR1cmwgPSAkdGhpcy0+Z2V0Q2xlYXJIaWRkaWZ5UmVxdWVzdFVybCgkcGFubmVsLT5hZG1pbl91cmwsICRwYW5uZWwtPnNlY3JldF9jb2RlKTsKICAgICAgICAkdXJsID0gIiRhZG1pblVVSUQvYXBpL3YxL3VzZXIvP3V1aWQ9eyR1dWlkfSI7CgogICAgICAgICRkYXRhID0gJHRoaXMtPnNlbmRQb3N0UmVxdWVzdFRvSGlkZGlmeVBhbm5lbCgkcGFubmVsSUQsICR1cmwsICRwYXJhbXMpOwogICAgICAgIHJldHVybiAkZGF0YTsKICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiBkZWxldGVVc2VyT2ZIaWRkaWZ5UGFuZWwoJHBhbm5lbElELCAkdXNlclVVSUQpCiAgICB7CiAgICAgICAgJGRhdGEgPSAkdGhpcy0+c2VuZERlbGV0ZVJlcXVlc3RUb0hpZGRpZnlQYW5uZWwoJHBhbm5lbElELCAiL2FwaS92Mi9hZG1pbi91c2VyLyR1c2VyVVVJRC8iKTsKICAgICAgICByZXR1cm4gJGRhdGE7CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gc2VuZEdldFJlcXVlc3RUb0hpZGRpZnlQYW5uZWwoJHBhbm5lbElELCAkcmVxdWVzdEFQaSkKICAgIHsKICAgICAgICAkcGFubmVsID0gUGFubmVsOjpmaW5kKCRwYW5uZWxJRCk7CiAgICAgICAgJHRoaXMtPmNoZWNrQ29va2llU2Vhc29uKCRwYW5uZWwtPmlkKTsKICAgICAgICAvLyAkdXJsID0gJyc7CiAgICAgICAgLy8gaWYgKHN0cl9lbmRzX3dpdGgoJHBhbm5lbC0+YWRtaW5fdXJsLCAnLycpKSB7CiAgICAgICAgLy8gICAgICR1cmwgPSAieyRwYW5uZWwtPmFkbWluX3VybH17JHJlcXVlc3RBUGl9IjsKICAgICAgICAvLyB9IGVsc2UgewogICAgICAgIC8vICAgICAkdXJsID0gInskcGFubmVsLT5hZG1pbl91cmx9L3skcmVxdWVzdEFQaX0iOwogICAgICAgIC8vIH0KICAgICAgICAkdXJsID0gJHRoaXMtPmdldENsZWFySGlkZGlmeVJlcXVlc3RVcmwoJHBhbm5lbC0+YWRtaW5fdXJsLCAkcmVxdWVzdEFQaSk7CiAgICAgICAgXExvZzo6aW5mbygidXJsID0+ICR1cmwiKTsKICAgICAgICAkY29va2llcyA9IFsKICAgICAgICAgICAgJ3Nlc3Npb24nID0+ICRwYW5uZWwtPmNvb2tpZV9zZXNzaW9uLAogICAgICAgIF07CgogICAgICAgICRzdWJzZXF1ZW50UmVzcG9uc2UgPSBIdHRwOjp3aXRoQ29va2llcygkY29va2llcywgJHBhbm5lbC0+dXJsX3BvcnQpLT5nZXQoJHVybCk7CgogICAgICAgIGlmICgkc3Vic2VxdWVudFJlc3BvbnNlLT5nZXRTdGF0dXNDb2RlKCkgPT0gMjAwKSB7CiAgICAgICAgICAgICRjaGVja0lzSHRtbFBhZ2UgPSBzdHJwb3MoJHN1YnNlcXVlbnRSZXNwb25zZS0+Z2V0Qm9keSgpLCAnPGh0bWw+Jyk7CiAgICAgICAgICAgIGlmICgkY2hlY2tJc0h0bWxQYWdlICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgXExvZzo6aW5mbygidXJsID0+IHskc3Vic2VxdWVudFJlc3BvbnNlLT5nZXRCb2R5KCl9Iik7CgogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oZmFsc2UsIDQwMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gZGQoJHN1YnNlcXVlbnRSZXNwb25zZSk7CiAgICAgICAgICAgIHJldHVybiBqc29uX2RlY29kZSgkc3Vic2VxdWVudFJlc3BvbnNlLT5nZXRCb2R5KCksIHRydWUpOwogICAgICAgIH0KICAgICAgICBcTG9nOjppbmZvKCJ1cmwgPT4geyRzdWJzZXF1ZW50UmVzcG9uc2UtPmdldEJvZHkoKX0iKTsKCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oZmFsc2UsIDQwMSk7CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gc2VuZERlbGV0ZVJlcXVlc3RUb0hpZGRpZnlQYW5uZWwoJHBhbm5lbElELCAkcmVxdWVzdEFQaSkKICAgIHsKICAgICAgICAkcGFubmVsID0gUGFubmVsOjpmaW5kKCRwYW5uZWxJRCk7CiAgICAgICAgJHRoaXMtPmNoZWNrQ29va2llU2Vhc29uKCRwYW5uZWwtPmlkKTsKICAgICAgICAvLyAkdXJsID0gJyc7CiAgICAgICAgLy8gaWYgKHN0cl9lbmRzX3dpdGgoJHBhbm5lbC0+YWRtaW5fdXJsLCAnLycpKSB7CiAgICAgICAgLy8gICAgICR1cmwgPSAieyRwYW5uZWwtPmFkbWluX3VybH17JHJlcXVlc3RBUGl9IjsKICAgICAgICAvLyB9IGVsc2UgewogICAgICAgIC8vICAgICAkdXJsID0gInskcGFubmVsLT5hZG1pbl91cmx9L3skcmVxdWVzdEFQaX0iOwogICAgICAgIC8vIH0KICAgICAgICAkdXJsID0gJHRoaXMtPmdldENsZWFySGlkZGlmeVJlcXVlc3RVcmwoJHBhbm5lbC0+YWRtaW5fdXJsLCAkcmVxdWVzdEFQaSk7CgogICAgICAgIFxMb2c6OmluZm8oInVybCA9PiAkdXJsIik7CiAgICAgICAgJGNvb2tpZXMgPSBbCiAgICAgICAgICAgICdzZXNzaW9uJyA9PiAkcGFubmVsLT5jb29raWVfc2Vzc2lvbiwKICAgICAgICBdOwoKICAgICAgICAkc3Vic2VxdWVudFJlc3BvbnNlID0gSHR0cDo6d2l0aENvb2tpZXMoJGNvb2tpZXMsICRwYW5uZWwtPnVybF9wb3J0KS0+ZGVsZXRlKCR1cmwpOwoKICAgICAgICBpZiAoJHN1YnNlcXVlbnRSZXNwb25zZS0+Z2V0U3RhdHVzQ29kZSgpID09IDIwMCkgewogICAgICAgICAgICAkY2hlY2tJc0h0bWxQYWdlID0gc3RycG9zKCRzdWJzZXF1ZW50UmVzcG9uc2UtPmdldEJvZHkoKSwgJzxodG1sPicpOwogICAgICAgICAgICBpZiAoJGNoZWNrSXNIdG1sUGFnZSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKGZhbHNlLCA0MDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGRkKCRzdWJzZXF1ZW50UmVzcG9uc2UpOwogICAgICAgICAgICByZXR1cm4ganNvbl9kZWNvZGUoJHN1YnNlcXVlbnRSZXNwb25zZS0+Z2V0Qm9keSgpLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oZmFsc2UsIDQwMSk7CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gc2VuZFB1dFJlcXVlc3RUb0hpZGRpZnlQYW5uZWwoJHBhbm5lbElELCAkcmVxdWVzdEFQaSwgJHBhcmFtcyA9IFtdKQogICAgewogICAgICAgICRwYW5uZWwgPSBQYW5uZWw6OmZpbmQoJHBhbm5lbElEKTsKICAgICAgICAkdGhpcy0+Y2hlY2tDb29raWVTZWFzb24oJHBhbm5lbC0+aWQpOwogICAgICAgICR1cmwgPSAkdGhpcy0+Z2V0Q2xlYXJIaWRkaWZ5UmVxdWVzdFVybCgkcGFubmVsLT5hZG1pbl91cmwsICRyZXF1ZXN0QVBpKTsKCiAgICAgICAgXExvZzo6aW5mbygidXJsID0+ICR1cmwiKTsKICAgICAgICAkY29va2llcyA9IFsKICAgICAgICAgICAgJ3Nlc3Npb24nID0+ICRwYW5uZWwtPmNvb2tpZV9zZXNzaW9uLAogICAgICAgIF07CgogICAgICAgICRzdWJzZXF1ZW50UmVzcG9uc2UgPSBIdHRwOjp3aXRoQ29va2llcygkY29va2llcywgJHBhbm5lbC0+dXJsX3BvcnQpLT5wdXQoJHVybCwgJHBhcmFtcyk7CiAgICAgICAgXExvZzo6aW5mbygibWVzc2FnZTEgPT4geyRzdWJzZXF1ZW50UmVzcG9uc2UtPmdldEJvZHkoKX0iKTsKCiAgICAgICAgaWYgKCRzdWJzZXF1ZW50UmVzcG9uc2UtPmdldFN0YXR1c0NvZGUoKSA9PSAyMDApIHsKICAgICAgICAgICAgJGNoZWNrSXNIdG1sUGFnZSA9IHN0cnBvcygkc3Vic2VxdWVudFJlc3BvbnNlLT5nZXRCb2R5KCksICc8aHRtbD4nKTsKICAgICAgICAgICAgaWYgKCRjaGVja0lzSHRtbFBhZ2UgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihmYWxzZSwgNDAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBkZCgkc3Vic2VxdWVudFJlc3BvbnNlKTsKICAgICAgICAgICAgXExvZzo6aW5mbygibWVzc2FnZSA9PiB7JHN1YnNlcXVlbnRSZXNwb25zZS0+Z2V0Qm9keSgpfSIpOwogICAgICAgICAgICByZXR1cm4ganNvbl9kZWNvZGUoJHN1YnNlcXVlbnRSZXNwb25zZS0+Z2V0Qm9keSgpLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oZmFsc2UsIDQwMSk7CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gc2VuZFBvc3RSZXF1ZXN0VG9IaWRkaWZ5UGFubmVsKCRwYW5uZWxJRCwgJHJlcXVlc3RBUGksICRwYXJhbXMgPSBbXSkKICAgIHsKICAgICAgICAkcGFubmVsID0gUGFubmVsOjpmaW5kKCRwYW5uZWxJRCk7CiAgICAgICAgJHRoaXMtPmNoZWNrQ29va2llU2Vhc29uKCRwYW5uZWwtPmlkKTsKICAgICAgICAkdXJsID0gJHRoaXMtPmdldENsZWFySGlkZGlmeVJlcXVlc3RVcmwoJHBhbm5lbC0+YWRtaW5fdXJsLCAkcmVxdWVzdEFQaSk7CgogICAgICAgIFxMb2c6OmluZm8oInVybCA9PiAkdXJsIik7CiAgICAgICAgJGNvb2tpZXMgPSBbCiAgICAgICAgICAgICdzZXNzaW9uJyA9PiAkcGFubmVsLT5jb29raWVfc2Vzc2lvbiwKICAgICAgICBdOwoKICAgICAgICAkc3Vic2VxdWVudFJlc3BvbnNlID0gSHR0cDo6d2l0aENvb2tpZXMoJGNvb2tpZXMsICRwYW5uZWwtPnVybF9wb3J0KS0+cG9zdCgkdXJsLCAkcGFyYW1zKTsKICAgICAgICBcTG9nOjppbmZvKCJtZXNzYWdlMSA9PiB7JHN1YnNlcXVlbnRSZXNwb25zZS0+Z2V0Qm9keSgpfSIpOwoKICAgICAgICBpZiAoJHN1YnNlcXVlbnRSZXNwb25zZS0+Z2V0U3RhdHVzQ29kZSgpID09IDIwMCkgewogICAgICAgICAgICAkY2hlY2tJc0h0bWxQYWdlID0gc3RycG9zKCRzdWJzZXF1ZW50UmVzcG9uc2UtPmdldEJvZHkoKSwgJzxodG1sPicpOwogICAgICAgICAgICBpZiAoJGNoZWNrSXNIdG1sUGFnZSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKGZhbHNlLCA0MDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGRkKCRzdWJzZXF1ZW50UmVzcG9uc2UpOwogICAgICAgICAgICBcTG9nOjppbmZvKCJtZXNzYWdlID0+IHskc3Vic2VxdWVudFJlc3BvbnNlLT5nZXRCb2R5KCl9Iik7CiAgICAgICAgICAgIHJldHVybiBqc29uX2RlY29kZSgkc3Vic2VxdWVudFJlc3BvbnNlLT5nZXRCb2R5KCksIHRydWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihmYWxzZSwgNDAxKTsKICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZW5kUGF0Y2hSZXF1ZXN0VG9IaWRkaWZ5UGFubmVsKCRwYW5uZWxJRCwgJHJlcXVlc3RBUGksICRwYXJhbXMgPSBbXSkKICAgIHsKICAgICAgICAkcGFubmVsID0gUGFubmVsOjpmaW5kKCRwYW5uZWxJRCk7CiAgICAgICAgJHRoaXMtPmNoZWNrQ29va2llU2Vhc29uKCRwYW5uZWwtPmlkKTsKICAgICAgICAvLyAkdXJsID0gJyc7CiAgICAgICAgLy8gaWYgKHN0cl9lbmRzX3dpdGgoJHBhbm5lbC0+YWRtaW5fdXJsLCAnLycpKSB7CiAgICAgICAgLy8gICAgICR1cmwgPSAieyRwYW5uZWwtPmFkbWluX3VybH17JHJlcXVlc3RBUGl9IjsKICAgICAgICAvLyB9IGVsc2UgewogICAgICAgIC8vICAgICAkdXJsID0gInskcGFubmVsLT5hZG1pbl91cmx9L3skcmVxdWVzdEFQaX0iOwogICAgICAgIC8vIH0KICAgICAgICAkdXJsID0gJHRoaXMtPmdldENsZWFySGlkZGlmeVJlcXVlc3RVcmwoJHBhbm5lbC0+YWRtaW5fdXJsLCAkcmVxdWVzdEFQaSk7CgogICAgICAgIFxMb2c6OmluZm8oInVybCA9PiAkdXJsIik7CiAgICAgICAgJGNvb2tpZXMgPSBbCiAgICAgICAgICAgICdzZXNzaW9uJyA9PiAkcGFubmVsLT5jb29raWVfc2Vzc2lvbiwKICAgICAgICBdOwoKICAgICAgICAkc3Vic2VxdWVudFJlc3BvbnNlID0gSHR0cDo6d2l0aENvb2tpZXMoJGNvb2tpZXMsICRwYW5uZWwtPnVybF9wb3J0KS0+cGF0Y2goJHVybCwgJHBhcmFtcyk7CiAgICAgICAgXExvZzo6aW5mbygiZ2V0U3RhdHVzQ29kZSA9PiB7JHN1YnNlcXVlbnRSZXNwb25zZS0+Z2V0U3RhdHVzQ29kZSgpfSIpOwogICAgICAgIFxMb2c6OmluZm8oImdldEJvZHkgPT4geyRzdWJzZXF1ZW50UmVzcG9uc2UtPmdldEJvZHkoKX0iKTsKICAgICAgICBpZiAoJHN1YnNlcXVlbnRSZXNwb25zZS0+Z2V0U3RhdHVzQ29kZSgpID09IDIwMCkgewogICAgICAgICAgICAkY2hlY2tJc0h0bWxQYWdlID0gc3RycG9zKCRzdWJzZXF1ZW50UmVzcG9uc2UtPmdldEJvZHkoKSwgJzxodG1sPicpOwogICAgICAgICAgICBpZiAoJGNoZWNrSXNIdG1sUGFnZSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKGZhbHNlLCA0MDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGRkKCRzdWJzZXF1ZW50UmVzcG9uc2UpOwogICAgICAgICAgICByZXR1cm4ganNvbl9kZWNvZGUoJHN1YnNlcXVlbnRSZXNwb25zZS0+Z2V0Qm9keSgpLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oZmFsc2UsIDQwMSk7CiAgICB9Cn0K