<?php
bolt_decrypt( __FILE__ , 'eErWCJ'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnM7CnVzZSBTaGV0YWJpdFxNdWx0aXBheVxJbnZvaWNlOwp1c2UgU2hldGFiaXRcUGF5bWVudFxGYWNhZGVcUGF5bWVudDsKdXNlIFNoZXRhYml0XE11bHRpcGF5XEV4Y2VwdGlvbnNcSW52YWxpZFBheW1lbnRFeGNlcHRpb247CnVzZSBTb2FwQ2xpZW50Owp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcQ29uZmlnOwoKdXNlIEFwcFxNb2RlbHNcVHJhbnNhY3Rpb247CnVzZSBBcHBcTW9kZWxzXFBheW1lbnRUeXBlOwp1c2UgQXBwXE1vZGVsc1xDcnlwdG9QYXltZW50Owp1c2UgQXBwXE1vZGVsc1xUcmFuc2FjdGlvbkltYWdlOwp1c2UgQXBwXE1vZGVsc1xCaWxsOwoKdXNlIElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0OwpjbGFzcyBUcmFuc2FjdGlvbkNvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsKICAgIHB1YmxpYyAkYWNjb3VudF9pZDsKICAgIHB1YmxpYyAkYW1vdW50OwogICAgcHVibGljICRhbW91bnRfZG9sbGFyOwogICAgcHVibGljIGZ1bmN0aW9uIGFkZF9vcmRlcihSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRweW1udENudHJybCA9IG5ldyBQYXltZW50VHlwZUNvbnRyb2xsZXIoKTsKCiAgICAgICAgY29uZmlnOjpzZXQoJ3BheW1lbnQuZHJpdmVycy56YXJpbnBhbC5tZXJjaGFudElkJywgJHB5bW50Q250cnJsLT5nZXRaYXJpbnBhbE1lcmNoYW50SUQoKSk7CgogICAgICAgICRzZXR0aW5nQ250cmwgPSBuZXcgU2V0dGluZ0NvbnRyb2xsZXIoKTsKICAgICAgICAkbWFpblVybCA9ICRzZXR0aW5nQ250cmwtPmdldE1haW5VcmwoKTsKCiAgICAgICAgY29uZmlnOjpzZXQoJ3BheW1lbnQuZHJpdmVycy56YXJpbnBhbC5jYWxsYmFja1VybCcsICJ7JG1haW5Vcmx9L29yZGVyIik7CgogICAgICAgICR2YWx1ZSA9IGNvbmZpZygncGF5bWVudC5kcml2ZXJzLnphcmlucGFsLm1lcmNoYW50SWQnKTsKICAgICAgICAvL2dldCBhbW91bnQgZnJvbSBiaWxsCiAgICAgICAgJGJpbGwgPSBCaWxsOjp3aGVyZSgnYmlsbF9pZCcsICRyZXF1ZXN0LT5pbnZvaWNlSUQpLT5maXJzdCgpOwoKICAgICAgICAkdGhpcy0+YW1vdW50ID0gJGJpbGwtPmFtb3VudDsKICAgICAgICAkdGhpcy0+YWNjb3VudF9pZCA9ICRyZXF1ZXN0LT5hY2NvdW50X2lkOwogICAgICAgIGlmICgkdGhpcy0+YW1vdW50ICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gQ3JlYXRlIG5ldyBpbnZvaWNlLgogICAgICAgICAgICAvLyBnZXR6YXJpbnBhbCBtZXJjaGVudCBpZCBmcm9tIC5lbnYKICAgICAgICAgICAgJHphcmlucGFsTWVyY2hlbnRJRCA9IFBheW1lbnRUeXBlOjp3aGVyZSgnbmFtZScsICfYstix24zZhiDZvtin2YQnKS0+Zmlyc3QoKS0+bWVyY2hhbnRfaWQ7CiAgICAgICAgICAgIGlmICgkemFyaW5wYWxNZXJjaGVudElEID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiAnWkFSSU5QQUxfTUVSQ0hBTlRfSUQgaXMgbm90IHNldCBpbiAuZW52JzsKICAgICAgICAgICAgfQogICAgICAgICAgICAkY2FsbGJhY2tVcmwgPSAkbWFpblVybCAuICcvb3JkZXInOwoKICAgICAgICAgICAgJHJlc3BvbnNlID0gemFyaW5wYWwoKQogICAgICAgICAgICAgICAgLT5tZXJjaGFudElkKCR6YXJpbnBhbE1lcmNoZW50SUQpIC8vINiq2LnbjNuM2YYg2YXYsdqG2YbYqiDaqdivINiv2LEg2K3bjNmGINin2KzYsdinIC0g2KfYrtiq24zYp9ix24wKICAgICAgICAgICAgICAgIC0+YW1vdW50KCR0aGlzLT5hbW91bnQpIC8vINmF2KjZhNi6INiq2LHYp9qp2YbYtAogICAgICAgICAgICAgICAgLT5yZXF1ZXN0KCkKICAgICAgICAgICAgICAgIC0+ZGVzY3JpcHRpb24oJ9iu2LHbjNivINqp2KfZhNinJykgLy8g2KrZiNi224zYrdin2Kog2KrYsdin2qnZhti0CiAgICAgICAgICAgICAgICAtPmNhbGxiYWNrVXJsKCRjYWxsYmFja1VybCkgLy8g2KLYr9ix2LMg2KjYsdqv2LTYqiDZvtizINin2LIg2b7Ysdiv2KfYrtiqCiAgICAgICAgICAgICAgICAtPnNlbmQoKTsKICAgICAgICAgICAgaWYgKCEkcmVzcG9uc2UtPnN1Y2Nlc3MoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRyZXNwb25zZS0+ZXJyb3IoKS0+bWVzc2FnZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRhdXRob3JpdHkgPSAkcmVzcG9uc2UtPmF1dGhvcml0eSgpOwoKICAgICAgICAgICAgLy8gc2F2ZSBhdXRob3JpdHkgaW4gZGIgYXMgbmV3IGJpbGwgdHJhbnNhY3Rpb25faWQKICAgICAgICAgICAgLy8gY3JlYXRlIGEgbmV3IHRyYW5zYWN0aW9uCiAgICAgICAgICAgICR0cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbigpOwogICAgICAgICAgICAkdHJhbnNhY3Rpb24tPmFjY291bnRfaWQgPSAkdGhpcy0+YWNjb3VudF9pZDsKICAgICAgICAgICAgJHRyYW5zYWN0aW9uLT51c2VybmFtZSA9ICcnOwogICAgICAgICAgICAkdHJhbnNhY3Rpb24tPmFtb3VudCA9ICR0aGlzLT5hbW91bnQ7CiAgICAgICAgICAgICR0cmFuc2FjdGlvbi0+Y29uZmlybWVkID0gMDsKICAgICAgICAgICAgJHRyYW5zYWN0aW9uLT5yZWNpcGVfbnVtYmVyID0gJGF1dGhvcml0eTsKICAgICAgICAgICAgJHRyYW5zYWN0aW9uLT5wYXltZW50X3R5cGVfaWQgPSBQYXltZW50VHlwZTo6d2hlcmUoJ25hbWUnLCAn2LLYsduM2YYg2b7Yp9mEJyktPmZpcnN0KCktPmlkOwoKICAgICAgICAgICAgJHRyYW5zYWN0aW9uLT5zYXZlKCk7CgogICAgICAgICAgICAkcmVzdWx0ID0gWydzdWNjZXNzJyA9PiAkcmVzcG9uc2UtPnJlZGlyZWN0KCldOwogICAgICAgICAgICAvLyBcTG9nOjppbmZvKCdhZGRfb3JkZXInLCBbJ3Jlc3VsdCcgPT4gJHJlc3VsdF0pOwoKICAgICAgICAgICAgJGxpbmsgPSAnaHR0cHM6Ly93d3cuemFyaW5wYWwuY29tL3BnL1N0YXJ0UGF5LycgLiAkYXV0aG9yaXR5OwoKICAgICAgICAgICAgcmV0dXJuICRsaW5rOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAn2KfbjNmGINi12YjYsdiq2K3Ys9in2Kgg2YXZiNis2YjYryDZhtmF24wg2KjYp9i02K8uJzsKICAgICAgICB9CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gb3JkZXIoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkdHJhbnNhY3Rpb25faWQgPSAkcmVxdWVzdC0+dHJhbnNhY3Rpb25faWQ7CiAgICAgICAgICAgICRzdGF0dXMgPSAkcmVxdWVzdC0+c3RhdHVzOwoKICAgICAgICAgICAgJGFtb3VudCA9ICR0aGlzLT5nZXRBbW91bnRCeVJlY2lwZU5VbWJlcigkdHJhbnNhY3Rpb25faWQpOwoKICAgICAgICAgICAgLy8gICRyZWNlaXB0ID0gUGF5bWVudDo6YW1vdW50KCRhbW91bnQpLT50cmFuc2FjdGlvbklkKCR0cmFuc2FjdGlvbl9pZCktPnZlcmlmeSgpOwogICAgICAgICAgICAvLyBjb25maXJtIHRyYW5zYWN0aW9uCiAgICAgICAgICAgIC8vIGdldCB0cmFuc2FjdGlvbiB3aXRoICR0cmFuc2FjdGlvbl9pZAogICAgICAgICAgICAkdHJhbnNhY3Rpb24gPSBUcmFuc2FjdGlvbjo6d2hlcmUoJ3JlY2lwZV9udW1iZXInLCAkdHJhbnNhY3Rpb25faWQpLT5maXJzdCgpOwogICAgICAgICAgICAvLyBjaGVjayBpZiB0cmFuc2FjdGlvbiB3YXMgY29uZmlybWVkIGJlZm9yZSBzbyByZXR1cm4gaXQncyBjb25maXJtZWQgc3RhdHVzCgogICAgICAgICAgICBpZiAoJHRyYW5zYWN0aW9uLT5jb25maXJtZWQgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuICfYqtix2KfaqdmG2LQg2Kraqdix2KfYsduMINmF24wg2KjYp9i02K8uJzsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBpZiAoJHN0YXR1cyAhPT0gJ09LJykgewogICAgICAgICAgICAvLyAgICAgcmV0dXJuICfYqtix2KfaqdmG2LQg2YbYp9mF2YjZgdmCINmF24wg2KjYp9i02K8uJzsKICAgICAgICAgICAgLy8gfQoKICAgICAgICAgICAgJGF1dGhvcml0eSA9ICR0cmFuc2FjdGlvbl9pZDsgLy8g2K/YsduM2KfZgdiqINqp2YjYptix24wg2KfYs9iq2LHbjNmG2q8g2KfYsdiz2KfZhCDYtNiv2Ycg2KrZiNiz2Lcg2LLYsduM2YYg2b7Yp9mECiAgICAgICAgICAgICR6YXJpbnBhbE1lcmNoZW50SUQgPSBQYXltZW50VHlwZTo6d2hlcmUoJ25hbWUnLCAn2LLYsduM2YYg2b7Yp9mEJyktPmZpcnN0KCktPm1lcmNoYW50X2lkOwoKICAgICAgICAgICAgJHJlc3BvbnNlID0gemFyaW5wYWwoKQogICAgICAgICAgICAgICAgLT5tZXJjaGFudElkKCR6YXJpbnBhbE1lcmNoZW50SUQpIC8vINiq2LnbjNuM2YYg2YXYsdqG2YbYqiDaqdivINiv2LEg2K3bjNmGINin2KzYsdinIC0g2KfYrtiq24zYp9ix24wKICAgICAgICAgICAgICAgIC0+YW1vdW50KCRhbW91bnQpCiAgICAgICAgICAgICAgICAtPnZlcmlmaWNhdGlvbigpCiAgICAgICAgICAgICAgICAtPmF1dGhvcml0eSgkYXV0aG9yaXR5KQogICAgICAgICAgICAgICAgLT5zZW5kKCk7CgogICAgICAgICAgICBpZiAoISRyZXNwb25zZS0+c3VjY2VzcygpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHJlc3BvbnNlLT5lcnJvcigpLT5tZXNzYWdlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRjb25maXJtUmVxID0gbmV3IFJlcXVlc3QoKTsKICAgICAgICAgICAgJGNvbmZpcm1SZXEtPmlkID0gJHRyYW5zYWN0aW9uLT5pZDsKICAgICAgICAgICAgJGNvbmZpcm1SZXEtPmNvbmZpcm1lZCA9IDE7CiAgICAgICAgICAgICRjb25maXJtUmVxLT5hbW91bnQgPSAkdHJhbnNhY3Rpb24tPmFtb3VudDsKICAgICAgICAgICAgJGNvbmZpcm1SZXEtPmFjY291bnRfaWQgPSAkdHJhbnNhY3Rpb24tPmFjY291bnRfaWQ7CiAgICAgICAgICAgICRjb25maXJtUmVxLT5yZWNpcGVOVW1iZXIgPSAkdHJhbnNhY3Rpb24tPnJlY2lwZV9udW1iZXI7CiAgICAgICAgICAgICRjb25maXJtUmVxLT5wYXltZW50VHlwZUlkID0gJHRyYW5zYWN0aW9uLT5wYXltZW50X3R5cGVfaWQ7CiAgICAgICAgICAgICRjb25maXJtUmVxLT5pc1BheW1udEJhY2sgPSB0cnVlOwoKICAgICAgICAgICAgJHRoaXMtPmVkaXRVc2VyVHJhbmFjdGlvbigkY29uZmlybVJlcSk7CgogICAgICAgICAgICByZXR1cm4gJ9m+2LHYr9in2K7YqiDYqNinINmF2YjZgdmC24zYqiDYp9mG2KzYp9mFINi02K8uINmF24wg2KrZiNin2YbbjNivINin24zZhiDZvtmG2KzYsdmHINix2Kcg2KjYqNmG2K/bjNivLic7CiAgICAgICAgfSBjYXRjaCAoSW52YWxpZFBheW1lbnRFeGNlcHRpb24gJGV4Y2VwdGlvbikgewogICAgICAgICAgICAkdHJhbnNhY3Rpb25faWQgPSAkcmVxdWVzdC0+dHJhbnNhY3Rpb25faWQ7CgogICAgICAgICAgICAkdHJhbnNhY3Rpb24gPSBUcmFuc2FjdGlvbjo6d2hlcmUoJ3JlY2lwZV9udW1iZXInLCAkdHJhbnNhY3Rpb25faWQpLT5maXJzdCgpOwoKICAgICAgICAgICAgJHRoaXMtPnJlbW92ZVVuY29uZmlybWVkVHJhbnNhY3Rpb24oJHRyYW5zYWN0aW9uLT5pZCk7CiAgICAgICAgICAgIFxMb2c6OmluZm8oImJhY2sgZnJvbSB6YXJpbnBhbCAkZXhjZXB0aW9uIik7CiAgICAgICAgICAgIC8vICR0aGlzLT5yZW1vdmVVbmNvbmZpcm1lZFRyYW5zYWN0aW9uKCR0cmFuc2FjdGlvbl9pZCk7CiAgICAgICAgICAgIHJldHVybiAn2K7Yt9inINiv2LEg2KfZhtis2KfZhSDYudmF2YTbjNin2KonOwogICAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRVc2VyVHJhbmFjdGlvbigkdXNlcklEKQogICAgewogICAgICAgICRkYXRhID0gVHJhbnNhY3Rpb246OndoZXJlKCdhY2NvdW50X2lkJywgJHVzZXJJRCktPmdldCgpOwogICAgICAgIGlmICgkZGF0YSAhPSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiAkZGF0YTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkVXNlclRyYW5hY3Rpb24oJHVzZXJJRCwgJGFtb3VudCwgJHJlY2lwZU5VbWJlciwgJHBheW1lbnRUeXBlSWQpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCRwYXltZW50VHlwZUlkID09IDAgfHwgJHBheW1lbnRUeXBlSWQgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgJHBheSA9IFBheW1lbnRUeXBlOjp3aGVyZSgnaXNfYWN0aXZlJywgdHJ1ZSktPndoZXJlKCd0eXBlJywgJ29mZmxpbmUnKS0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICRwYXltZW50VHlwZUlkID0gJHBheS0+aWQ7CiAgICAgICAgfQogICAgICAgICR0cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbigpOwogICAgICAgICR0cmFuc2FjdGlvbi0+YWNjb3VudF9pZCA9ICR1c2VySUQ7CiAgICAgICAgJHRyYW5zYWN0aW9uLT51c2VybmFtZSA9ICcnOwogICAgICAgICR0cmFuc2FjdGlvbi0+YW1vdW50ID0gJGFtb3VudDsKICAgICAgICAkdHJhbnNhY3Rpb24tPnJlY2lwZV9udW1iZXIgPSAkcmVjaXBlTlVtYmVyOwogICAgICAgICR0cmFuc2FjdGlvbi0+cGF5bWVudF90eXBlX2lkID0gJHBheW1lbnRUeXBlSWQ7CiAgICAgICAgJHRyYW5zYWN0aW9uLT5zYXZlKCk7CiAgICAgICAgLy8gY2hlY2sgdXNlciBoYXZlIHJlZmVycmFsLCBpZiBoYXMgY3JlYXRlIHJlZmVycmFsIGxvZwogICAgICAgICRyZWZlcnJhbExvZ3NDbnRybCA9IG5ldyBSZWZlcnJhbExvZ3NDb250cm9sbGVyKCk7CiAgICAgICAgJGhhc1JlZiA9ICRyZWZlcnJhbExvZ3NDbnRybC0+Y2hlY2tfdXNlcl9pc19yZWZlcnJlZCgkdHJhbnNhY3Rpb24tPmFjY291bnRfaWQpOwoKICAgICAgICBpZiAoJGhhc1JlZiA9PSB0cnVlKSB7CiAgICAgICAgICAgIC8vIGdldCBhbW91bnQgZnJvbSByZWZlcnJhbHNldHRpbmcgYW5kIGNhbGN1bGF0ZSBieSBwZXJjZW50IHN0b3JlZCBpbiBkYgogICAgICAgICAgICAkcmVmZXJyYWxTZXR0aW5nQ250cmwgPSBuZXcgUmVmZXJyYWxTZXR0aW5nQ29udHJvbGxlcigpOwogICAgICAgICAgICAkcmVmZXJyYWxfcGVyY2VudCA9ICRyZWZlcnJhbFNldHRpbmdDbnRybC0+Z2V0X3JlZmVycmFsX3NldHRpbmdfcmVmZXJyYWxfcGVyY2VudCgpOwogICAgICAgICAgICAkYW1vdW50ID0gMDsKICAgICAgICAgICAgaWYgKCRyZWZlcnJhbF9wZXJjZW50ICE9PSBudWxsIHx8ICRyZWZlcnJhbF9wZXJjZW50ICE9PSAwKSB7CiAgICAgICAgICAgICAgICAkYW1vdW50ID0gKCR0cmFuc2FjdGlvbi0+YW1vdW50IC8gMTAwKSAqICRyZWZlcnJhbF9wZXJjZW50OwogICAgICAgICAgICB9CgogICAgICAgICAgICAkcmVmZXJSZXEgPSBuZXcgUmVxdWVzdCgpOwogICAgICAgICAgICAkcmVmZXJSZXEtPnJlZmVycmFsX3RvX2lkID0gJHVzZXJJRDsKCiAgICAgICAgICAgICRyZWZlclJlcS0+YW1vdW50ID0gJGFtb3VudDsKICAgICAgICAgICAgJHJlZmVyUmVxLT50cmFuc2FjdGlvbl9pZCA9ICR0cmFuc2FjdGlvbi0+aWQ7CgogICAgICAgICAgICAkcmVmZXJyYWxMb2dzQ250cmwtPmFkZF9uZXdfcmVmZXJyYWxfbG9ncygkcmVmZXJSZXEpOwogICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAkdHJhbnNhY3Rpb24tPmlkOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIFxMb2c6OmluZm8oIlRocm93YWJsZSAgJHRoIik7CiAgICAgICAgfQogICAgfQogICAgcHVibGljIGZ1bmN0aW9uIHJlbW92ZVVuY29uZmlybWVkVHJhbnNhY3Rpb24oJGlkKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICR0cmFuc2FjdGlvbiA9IFRyYW5zYWN0aW9uOjpmaW5kKCRpZCk7CiAgICAgICAgICAgIGlmICgkdHJhbnNhY3Rpb24tPmNvbmZpcm1lZCA9PSBmYWxzZSB8fCAkdHJhbnNhY3Rpb24tPmNvbmZpcm1lZCA9PSAwKSB7CiAgICAgICAgICAgICAgICAvLyByZW1vdmUgdHJhbnNhY3Rpb24gaW1hZ2Ugb24gZGlzawogICAgICAgICAgICAgICAgJHRyYW5zYWN0aW9uSW1hZ2UgPSBUcmFuc2FjdGlvbkltYWdlOjp3aGVyZSgndHJhbnNhY3Rpb25faWQnLCAkaWQpLT5maXJzdCgpOwogICAgICAgICAgICAgICAgaWYgKCR0cmFuc2FjdGlvbkltYWdlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAkcGF0aCA9IHB1YmxpY19wYXRoKCkgLiAnJyAuICR0cmFuc2FjdGlvbkltYWdlLT5pbWdfc3JjOwogICAgICAgICAgICAgICAgICAgIGlmIChmaWxlX2V4aXN0cygkcGF0aCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW5saW5rKCRwYXRoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJHRyYW5zYWN0aW9uLT5kZWxldGUoKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKHRydWUsIDIwMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihmYWxzZSwgNDAxKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIFxMb2c6OmluZm8oIiR0aCIpOwoKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oJ05PIERhdGEgRm91bmRlZCcsIDQwNCk7CiAgICAgICAgfQogICAgfQogICAgcHVibGljIGZ1bmN0aW9uIGVkaXRVc2VyVHJhbmFjdGlvbihSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICR0cmFuc2FjdGlvbiA9IFRyYW5zYWN0aW9uOjpmaW5kKCRyZXF1ZXN0LT5pZCk7CiAgICAgICAgICAgIGlmICgkdHJhbnNhY3Rpb24gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgJGlzQ29uZmlybWVkID0gJHJlcXVlc3QtPmNvbmZpcm1lZCA9PSAxIHx8ICRyZXF1ZXN0LT5jb25maXJtZWQgPT0gdHJ1ZSA/IHRydWUgOiBmYWxzZTsKCiAgICAgICAgICAgICAgICAvLyBpZiAoJHRyYW5zYWN0aW9uLT5hbW91bnQgIT0gJHJlcXVlc3QtPmFtb3VudCAmJiAkaXNDb25maXJtZWQgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgaWYgKCRpc0NvbmZpcm1lZCA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgJGFjY0JsQ3RybCA9IG5ldyBBY2NvdW50QmFsbGFuY2VDb250cm9sbGVyKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCR0cmFuc2FjdGlvbi0+YW1vdW50ID4gJHJlcXVlc3QtPmFtb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICAkYWNjQmxDdHJsLT5kZWNVc2VyQWNjdW50QmFsYW5jZSgkdHJhbnNhY3Rpb24tPmFjY291bnRfaWQsICR0cmFuc2FjdGlvbi0+YW1vdW50IC0gJHJlcXVlc3QtPmFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFjY0JsQ3RybC0+aW5jVXNlckFjY3VudEJhbGFuY2UoJHRyYW5zYWN0aW9uLT5hY2NvdW50X2lkLCAkcmVxdWVzdC0+YW1vdW50KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICR0cmFuc2FjdGlvbi0+YW1vdW50ID0gJHJlcXVlc3QtPmFtb3VudDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0cmFuc2FjdGlvbi0+cmVjaXBlX251bWJlciA9ICRyZXF1ZXN0LT5yZWNpcGVOVW1iZXI7CiAgICAgICAgICAgICAgICAkdHJhbnNhY3Rpb24tPnBheW1lbnRfdHlwZV9pZCA9ICRyZXF1ZXN0LT5wYXltZW50VHlwZUlkOwogICAgICAgICAgICAgICAgJHRyYW5zYWN0aW9uLT5jb25maXJtZWQgPSAkaXNDb25maXJtZWQ7CgogICAgICAgICAgICAgICAgaWYgKCR0cmFuc2FjdGlvbi0+dXBkYXRlKCkpIHsKICAgICAgICAgICAgICAgICAgICAkcmVmZXJyYWxMb2dzQ250cmwgPSBuZXcgUmVmZXJyYWxMb2dzQ29udHJvbGxlcigpOwogICAgICAgICAgICAgICAgICAgICRyZWZlcnJhbFNldHRpbmdDbnRybCA9IG5ldyBSZWZlcnJhbFNldHRpbmdDb250cm9sbGVyKCk7CgogICAgICAgICAgICAgICAgICAgICRyZWZlcnJhbF9wZXJjZW50ID0gJHJlZmVycmFsU2V0dGluZ0NudHJsLT5nZXRfcmVmZXJyYWxfc2V0dGluZ19yZWZlcnJhbF9wZXJjZW50KCk7CiAgICAgICAgICAgICAgICAgICAgJGFtb3VudCA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRyZWZlcnJhbF9wZXJjZW50ICE9PSBudWxsIHx8ICRyZWZlcnJhbF9wZXJjZW50ICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhbW91bnQgPSAoJHRyYW5zYWN0aW9uLT5hbW91bnQgLyAxMDApICogJHJlZmVycmFsX3BlcmNlbnQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgkaXNDb25maXJtZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJlc3VsdCA9IGFwcCgndGVsZWdyYW1fYm90JyktPnNlbmRNZXNzYWdlKCLYqtix2KfaqdmG2LQg2LTZhdinINio2Kcg2YXZiNmB2YLbjNiqINir2KjYqiDYtNivINmIINmF2KjZhNi6IHskdHJhbnNhY3Rpb24tPmFtb3VudH0g2KjZhyDYrdiz2KfYqCDYtNmF2Kcg2KfZgdiy2YjYr9mHINi02K8uIiwgJHRyYW5zYWN0aW9uLT5hY2NvdW50X2lkLCBudWxsLCAnTWFya0Rvd24nKTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2V0IHJlZmVycmFsIHdhbGxldAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHJlcXVlc3QtPmlzUGF5bW50QmFjayA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmVmZXJyYWxMb2dzQ250cmwtPmFkZF9hbW91bnRfdG9fcmVmcmVycmFsX3VzZXJfTG9nX2FuZF9yZWZlcnJhbF93YWxsZXQoJHRyYW5zYWN0aW9uLT5pZCwgJGFtb3VudCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmVmZXJyYWxMb2dzQ250cmwtPmFkZF9hbW91bnRfdG9fcmVmcmVycmFsX3VzZXJfTG9nX2FuZF9yZWZlcnJhbF93YWxsZXQoJHRyYW5zYWN0aW9uLT5pZCwgJGFtb3VudCwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJlc3VsdCA9IGFwcCgndGVsZWdyYW1fYm90JyktPnNlbmRNZXNzYWdlKCfYqtix2KfaqdmG2LQg2LTZhdinINmF2YjYsdivINiq2KfbjNuM2K8g2YbZhduMINio2KfYtNivLicsICR0cmFuc2FjdGlvbi0+YWNjb3VudF9pZCwgbnVsbCwgJ01hcmtEb3duJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNldCByZWZlcnJhbCB3YWxsZXQKICAgICAgICAgICAgICAgICAgICAgICAgJHJlZmVycmFsTG9nc0NudHJsID0gbmV3IFJlZmVycmFsTG9nc0NvbnRyb2xsZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHJlZmVycmFsTG9nc0NudHJsLT5kZWNyZWFzZV9hbW91bnRfdG9fcmVmcmVycmFsX3VzZXJfTG9nX2FuZF9yZWZlcnJhbF93YWxsZXQoJHRyYW5zYWN0aW9uLT5pZCwgJGFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbigkdHJhbnNhY3Rpb24sIDIwMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIFxMb2c6OmluZm8oJ0ZhaWxlZCB0byB1cGRhdGUgdHJhbnNhY3Rpb24nKTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oJHRyYW5zYWN0aW9uLCA0MDQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgXExvZzo6aW5mbygnTk8gRGF0YSBGb3VuZGVkJyk7CgogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oJ05PIERhdGEgRm91bmRlZCcsIDQwNCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBcTG9nOjppbmZvKCJUaHJvd2FibGUgICR0aCIpOwogICAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRBbW91bnRCeVJlY2lwZU5VbWJlcigkcmVjaXBlTlVtYmVyKQogICAgewogICAgICAgICRkYXRhID0gVHJhbnNhY3Rpb246OndoZXJlKCdyZWNpcGVfbnVtYmVyJywgJHJlY2lwZU5VbWJlciktPmZpcnN0KCk7CiAgICAgICAgaWYgKCRkYXRhICE9IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuICRkYXRhLT5hbW91bnQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgfQogICAgcHVibGljIGZ1bmN0aW9uIHNldENvbmZpcm1lZFRyYW5zYWN0aW9uKCRyZWNpcGVOVW1iZXIpCiAgICB7CiAgICAgICAgJGRhdGEgPSBUcmFuc2FjdGlvbjo6d2hlcmUoJ3JlY2lwZV9udW1iZXInLCAkcmVjaXBlTlVtYmVyKS0+Zmlyc3QoKTsKICAgICAgICBpZiAoJGRhdGEgIT0gbnVsbCkgewogICAgICAgICAgICAkZGF0YS0+Y29uZmlybWVkID0gdHJ1ZTsKICAgICAgICAgICAgJGRhdGEtPnVwZGF0ZSgpOwoKICAgICAgICAgICAgJHJlc3VsdCA9IGFwcCgndGVsZWdyYW1fYm90JyktPnNlbmRNZXNzYWdlKCLYqtix2KfaqdmG2LQg2LTZhdinINio2Kcg2YXZiNmB2YLbjNiqINir2KjYqiDYtNivINmIINmF2KjZhNi6IHskZGF0YS0+YW1vdW50fSDYqNmHINit2LPYp9ioINi02YXYpyDYp9mB2LLZiNiv2Ycg2LTYry4iLCAkZGF0YS0+YWNjb3VudF9pZCwgbnVsbCwgJ01hcmtEb3duJyk7CiAgICAgICAgICAgIC8vIHNldCByZWZlcnJhbCB3YWxsZXQKICAgICAgICAgICAgJHJlZmVycmFsTG9nc0NudHJsID0gbmV3IFJlZmVycmFsTG9nc0NvbnRyb2xsZXIoKTsKICAgICAgICAgICAgJHJlZmVycmFsTG9nc0NudHJsLT5hZGRfYW1vdW50X3RvX3JlZnJlcnJhbF91c2VyX0xvZ19hbmRfcmVmZXJyYWxfd2FsbGV0KCRkYXRhLT5pZCwgJGRhdGEtPmFtb3VudCk7CgogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQogICAgcHVibGljIGZ1bmN0aW9uIGdldFVzZXJBY2NvdW50SURCeVRyYW5zYWN0aW9uSWQoJHJlY2lwZU5VbWJlcikKICAgIHsKICAgICAgICAkZGF0YSA9IFRyYW5zYWN0aW9uOjp3aGVyZSgncmVjaXBlX251bWJlcicsICRyZWNpcGVOVW1iZXIpLT5maXJzdCgpOwogICAgICAgIGlmICgkZGF0YSAhPSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiAkZGF0YS0+YWNjb3VudF9pZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGdldENvbmZpcm1lZFRyYW5zYWN0aW9ucygkY291bnQgPSAxMCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gVHJhbnNhY3Rpb246OndoZXJlKCdjb25maXJtZWQnLCB0cnVlKQogICAgICAgICAgICAgICAgLT53aXRoKFsncGF5bWVudF90eXBlcycsICd0cmFuc2FjdGlvbl9pbWFnZScsICd1c2VyJ10pCiAgICAgICAgICAgICAgICAtPnRha2UoJGNvdW50KQogICAgICAgICAgICAgICAgLT5vcmRlckJ5KCdpZCcsICdkZXNjJykKICAgICAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oJGRhdGEsIDQwNCk7CiAgICAgICAgfQogICAgfQogICAgcHVibGljIGZ1bmN0aW9uIGdldFVuQ29uZmlybWVkVHJhbnNhY3Rpb25zKCRjb3VudCA9IDEwKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBUcmFuc2FjdGlvbjo6d2hlcmUoJ2NvbmZpcm1lZCcsIGZhbHNlKQogICAgICAgICAgICAgICAgLT53aXRoKFsncGF5bWVudF90eXBlcycsICd0cmFuc2FjdGlvbl9pbWFnZScsICd1c2VyJ10pCiAgICAgICAgICAgICAgICAtPnRha2UoJGNvdW50KQogICAgICAgICAgICAgICAgLT5vcmRlckJ5KCdpZCcsICdkZXNjJykKICAgICAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oJGRhdGEsIDQwNCk7CiAgICAgICAgfQogICAgfQp9Cg==