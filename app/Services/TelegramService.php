<?php
bolt_decrypt( __FILE__ , 'o8Th1l'); return 0;
##!!!##Cm5hbWVzcGFjZSBBcHBcU2VydmljZXM7Cgp1c2UgQXBwXFNlcnZpY2VzXFRlbGVncmFtTWVzc2FnZUZvcm1hdHRlcjsKCmNsYXNzIFRlbGVncmFtU2VydmljZQp7CiAgICBwcml2YXRlIHN0cmluZyAkYmFzZVVybDsKICAgIHByaXZhdGUgc3RyaW5nICRib3RUb2tlbjsKCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoKQogICAgewogICAgICAgICR0aGlzLT5iYXNlVXJsID0gJ2h0dHBzOi8vYXBpLnRlbGVncmFtLm9yZy8nOwogICAgICAgICR0b2tlbiA9IGNvbmZpZygnc2VydmljZXMudGVsZWdyYW0uYm90X3Rva2VuJyk7CgogICAgICAgIC8vINiq2YXbjNiyINqp2LHYr9mGINiq2YjaqdmGCiAgICAgICAgJHRva2VuID0gcHJlZ19yZXBsYWNlKCcvYm90Oj9ib3QvaScsICdib3QnLCAkdG9rZW4pOwogICAgICAgIGlmICghc3RyX3N0YXJ0c193aXRoKCR0b2tlbiwgJ2JvdCcpKSB7CiAgICAgICAgICAgICR0b2tlbiA9ICdib3QnIC4gJHRva2VuOwogICAgICAgIH0KCiAgICAgICAgJHRoaXMtPmJvdFRva2VuID0gJHRva2VuOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzZW5kTWVzc2FnZShzdHJpbmcgJGNoYXRJZCwgc3RyaW5nfGFycmF5ICR0ZXh0LCBhcnJheSAkb3B0aW9ucyA9IFtdKTogYXJyYXkKICAgIHsKICAgICAgICBpZiAoaXNfYXJyYXkoJHRleHQpKSB7CiAgICAgICAgICAgIC8vIHVzZSBmb3JtYXQgdGV4dCBzZXJ2aWNlCiAgICAgICAgICAgICR0ZXh0ID0gJHRoaXMtPmZvcm1hdFRleHQoJHRleHQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXMtPm1ha2VSZXF1ZXN0KCdzZW5kTWVzc2FnZScsIGFycmF5X21lcmdlKFsKICAgICAgICAgICAgJ2NoYXRfaWQnID0+ICRjaGF0SWQsCiAgICAgICAgICAgICd0ZXh0JyA9PiAkdGV4dCwKICAgICAgICAgICAgJ3BhcnNlX21vZGUnID0+ICdIVE1MJywKICAgICAgICBdLCAkb3B0aW9ucykpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzZW5kTWFya2Rvd25NZXNzYWdlKHN0cmluZyAkY2hhdElkLCBzdHJpbmd8YXJyYXkgJHRleHQsIGFycmF5ICRvcHRpb25zID0gW10pOiBhcnJheQogICAgewogICAgICAgIGlmIChpc19hcnJheSgkdGV4dCkpIHsKICAgICAgICAgICAgLy8gdXNlIGZvcm1hdCB0ZXh0IHNlcnZpY2UKICAgICAgICAgICAgJHRleHQgPSAkdGhpcy0+Zm9ybWF0VGV4dCgkdGV4dCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkdGhpcy0+c2VuZE1lc3NhZ2UoJGNoYXRJZCwgJHRleHQsIGFycmF5X21lcmdlKFsKICAgICAgICAgICAgJ3BhcnNlX21vZGUnID0+ICdNYXJrZG93blYyJywKICAgICAgICBdLCAkb3B0aW9ucykpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzZW5kSFRNTE1lc3NhZ2Uoc3RyaW5nICRjaGF0SWQsIHN0cmluZ3xhcnJheSAkdGV4dCwgYXJyYXkgJG9wdGlvbnMgPSBbXSk6IGFycmF5CiAgICB7CiAgICAgICAgaWYgKGlzX2FycmF5KCR0ZXh0KSkgewogICAgICAgICAgICAvLyB1c2UgZm9ybWF0IHRleHQgc2VydmljZQogICAgICAgICAgICAkdGV4dCA9ICR0aGlzLT5mb3JtYXRUZXh0KCR0ZXh0KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICR0aGlzLT5zZW5kTWVzc2FnZSgkY2hhdElkLCAkdGV4dCwgYXJyYXlfbWVyZ2UoWwogICAgICAgICAgICAncGFyc2VfbW9kZScgPT4gJ0hUTUwnLAogICAgICAgIF0sICRvcHRpb25zKSk7CiAgICB9CiAgICAvLyBjaGVjayB0aGF0IHRoZSBjaGF0SWQgaXMgY2hhbm5lbCBtZW1iZXIKICAgIHB1YmxpYyBmdW5jdGlvbiBjaGVja0NoYXRJZElzQ2hhbm5lbE1lbWJlcihzdHJpbmcgJGNoYXRJZCwgJGNoYW5uZWxJZCk6IGJvb2wKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkdXJsID0gJHRoaXMtPmJhc2VVcmwgLiAkdGhpcy0+Ym90VG9rZW4gLiAnL2dldENoYXRNZW1iZXInOwogICAgICAgICAgICAkcGFyYW1zID0gWwogICAgICAgICAgICAgICAgJ2NoYXRfaWQnID0+ICJAIiAuICRjaGFubmVsSWQsIC8vINin2LbYp9mB2Ycg2qnYsdiv2YYgQCDYqNix2KfbjCDYp9i32YXbjNmG2KfZhgogICAgICAgICAgICAgICAgJ3VzZXJfaWQnID0+ICRjaGF0SWQsCiAgICAgICAgICAgIF07CgogICAgICAgICAgICAkcmVzcG9uc2UgPSAkdGhpcy0+bWFrZVJlcXVlc3QoJ2dldENoYXRNZW1iZXInLCAkcGFyYW1zKTsKCiAgICAgICAgICAgIC8vINio2LHYsdiz24wg2YjYtti524zYqiDYudi22YjbjNiqINqp2KfYsdio2LEKICAgICAgICAgICAgaWYgKGlzc2V0KCRyZXNwb25zZVsnb2snXSkgJiYgJHJlc3BvbnNlWydvayddID09PSB0cnVlICYmIGlzc2V0KCRyZXNwb25zZVsncmVzdWx0J11bJ3N0YXR1cyddKSkgewogICAgICAgICAgICAgICAgJHN0YXR1cyA9ICRyZXNwb25zZVsncmVzdWx0J11bJ3N0YXR1cyddOwogICAgICAgICAgICAgICAgLy8g2Kfar9ixINqp2KfYsdio2LEgbGVmdCDbjNinIGtpY2tlZCDYqNin2LTYryDbjNi52YbbjCDYudi22Ygg2qnYp9mG2KfZhCDZhtuM2LPYqgogICAgICAgICAgICAgICAgJHJlcyA9IGluX2FycmF5KCRzdGF0dXMsIFsnbGVmdCcsICdraWNrZWQnXSk7CiAgICAgICAgICAgICAgICByZXR1cm4gJHJlcyA9PSAxIHx8ICRyZXMgPT0gdHJ1ZSA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyDYr9ixINi12YjYsdiqINmH2LEg2K7Yt9in24zbjCDZgdix2LYg2YXbjNqp2YbbjNmFINqp2KfYsdio2LEg2LnYttmIINmG24zYs9iqCgogICAgICAgIH0gY2F0Y2ggKFxFeGNlcHRpb24gJGUpIHsKICAgICAgICAgICAgXExvZzo6ZXJyb3IoItiu2LfYpyDYr9ixINio2LHYsdiz24wg2LnYttmI24zYqiDaqdin2LHYqNixINiv2LEg2qnYp9mG2KfZhDogIiAuICRlLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog2KfbjNis2KfYryDZhdiq2YYg2KjYpyDZgdix2YXYqiBIVE1MINio2LHYp9uMINiq2YTar9ix2KfZhQogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHRleHQg2YXYqtmGINin2LXZhNuMCiAgICAgKiBAcmV0dXJuIHN0cmluZyDZhdiq2YYg2YHYsdmF2Kog2LTYr9mHCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBmb3JtYXRIVE1MKHN0cmluZyAkdGV4dCk6IHN0cmluZwogICAgewogICAgICAgIHJldHVybiBodG1sc3BlY2lhbGNoYXJzKCR0ZXh0LCBFTlRfUVVPVEVTIHwgRU5UX0hUTUw1LCAnVVRGLTgnKTsKICAgIH0KCiAgICAvKioKICAgICAqINin24zYrNin2K8g2YXYqtmGINio2Kcg2YHYsdmF2KogTWFya2Rvd24g2KjYsdin24wg2KrZhNqv2LHYp9mFCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkdGV4dCDZhdiq2YYg2KfYtdmE24wKICAgICAqIEByZXR1cm4gc3RyaW5nINmF2KrZhiDZgdix2YXYqiDYtNiv2YcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGZvcm1hdE1hcmtkb3duKHN0cmluZyAkdGV4dCk6IHN0cmluZwogICAgewogICAgICAgICRlc2NhcGVDaGFycyA9IFsnXycsICcqJywgJ1snLCAnXScsICcoJywgJyknLCAnficsICdgJywgJz4nLCAnIycsICcrJywgJy0nLCAnPScsICd8JywgJ3snLCAnfScsICcuJywgJyEnXTsKICAgICAgICByZXR1cm4gc3RyX3JlcGxhY2UoJGVzY2FwZUNoYXJzLCBhcnJheV9tYXAoZm4oJGNoYXIpID0+ICJcXCRjaGFyIiwgJGVzY2FwZUNoYXJzKSwgJHRleHQpOwogICAgfQoKICAgIC8qKgogICAgICog2KfbjNis2KfYryDZhNuM2YbaqSDYqNinINmB2LHZhdiqIEhUTUwKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNyZWF0ZUhUTUxMaW5rKHN0cmluZyAkdGV4dCwgc3RyaW5nICR1cmwpOiBzdHJpbmcKICAgIHsKICAgICAgICByZXR1cm4gc3ByaW50ZignPGEgaHJlZj0iJXMiPiVzPC9hPicsICR0aGlzLT5mb3JtYXRIVE1MKCR1cmwpLCAkdGhpcy0+Zm9ybWF0SFRNTCgkdGV4dCkpOwogICAgfQoKICAgIC8qKgogICAgICog2KfbjNis2KfYryDZhNuM2YbaqSDYqNinINmB2LHZhdiqIE1hcmtkb3duCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGVNYXJrZG93bkxpbmsoc3RyaW5nICR0ZXh0LCBzdHJpbmcgJHVybCk6IHN0cmluZwogICAgewogICAgICAgIHJldHVybiBzcHJpbnRmKCdbJXNdKCVzKScsICR0aGlzLT5mb3JtYXRNYXJrZG93bigkdGV4dCksICR0aGlzLT5mb3JtYXRNYXJrZG93bigkdXJsKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDYp9uM2KzYp9ivINmF2KrZhiDZvtix2LHZhtqvINio2KcgSFRNTAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYm9sZEhUTUwoc3RyaW5nICR0ZXh0KTogc3RyaW5nCiAgICB7CiAgICAgICAgcmV0dXJuIHNwcmludGYoJzxiPiVzPC9iPicsICR0aGlzLT5mb3JtYXRIVE1MKCR0ZXh0KSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDYp9uM2KzYp9ivINmF2KrZhiDZvtix2LHZhtqvINio2KcgTWFya2Rvd24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGJvbGRNYXJrZG93bihzdHJpbmcgJHRleHQpOiBzdHJpbmcKICAgIHsKICAgICAgICByZXR1cm4gc3ByaW50ZignKiVzKicsICR0aGlzLT5mb3JtYXRNYXJrZG93bigkdGV4dCkpOwogICAgfQoKICAgIC8qKgogICAgICog2KfbjNis2KfYryDZhdiq2YYg2qnYrCDYqNinIEhUTUwKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGl0YWxpY0hUTUwoc3RyaW5nICR0ZXh0KTogc3RyaW5nCiAgICB7CiAgICAgICAgcmV0dXJuIHNwcmludGYoJzxpPiVzPC9pPicsICR0aGlzLT5mb3JtYXRIVE1MKCR0ZXh0KSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDYp9uM2KzYp9ivINmF2KrZhiDaqdisINio2KcgTWFya2Rvd24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGl0YWxpY01hcmtkb3duKHN0cmluZyAkdGV4dCk6IHN0cmluZwogICAgewogICAgICAgIHJldHVybiBzcHJpbnRmKCdfJXNfJywgJHRoaXMtPmZvcm1hdE1hcmtkb3duKCR0ZXh0KSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDYp9uM2KzYp9ivINmF2KrZhiDaqdivINio2KcgSFRNTAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY29kZUhUTUwoc3RyaW5nICR0ZXh0KTogc3RyaW5nCiAgICB7CiAgICAgICAgcmV0dXJuIHNwcmludGYoJzxjb2RlPiVzPC9jb2RlPicsICR0aGlzLT5mb3JtYXRIVE1MKCR0ZXh0KSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDYp9uM2KzYp9ivINmF2KrZhiDaqdivINio2KcgTWFya2Rvd24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNvZGVNYXJrZG93bihzdHJpbmcgJHRleHQpOiBzdHJpbmcKICAgIHsKICAgICAgICByZXR1cm4gc3ByaW50ZignYCVzYCcsICR0aGlzLT5mb3JtYXRNYXJrZG93bigkdGV4dCkpOwogICAgfQoKICAgIC8qKgogICAgICog2KfbjNis2KfYryDYqNmE2YjaqSDaqdivINio2KcgSFRNTAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcHJlSFRNTChzdHJpbmcgJHRleHQsIHN0cmluZyAkbGFuZ3VhZ2UgPSAnJyk6IHN0cmluZwogICAgewogICAgICAgIGlmICgkbGFuZ3VhZ2UpIHsKICAgICAgICAgICAgcmV0dXJuIHNwcmludGYoCiAgICAgICAgICAgICAgICAnPHByZT48Y29kZSBjbGFzcz0ibGFuZ3VhZ2UtJXMiPiVzPC9jb2RlPjwvcHJlPicsCiAgICAgICAgICAgICAgICAkdGhpcy0+Zm9ybWF0SFRNTCgkbGFuZ3VhZ2UpLAogICAgICAgICAgICAgICAgJHRoaXMtPmZvcm1hdEhUTUwoJHRleHQpCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzcHJpbnRmKCc8cHJlPiVzPC9wcmU+JywgJHRoaXMtPmZvcm1hdEhUTUwoJHRleHQpKTsKICAgIH0KCiAgICAvKioKICAgICAqINin24zYrNin2K8g2KjZhNmI2qkg2qnYryDYqNinIE1hcmtkb3duCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBwcmVNYXJrZG93bihzdHJpbmcgJHRleHQsIHN0cmluZyAkbGFuZ3VhZ2UgPSAnJyk6IHN0cmluZwogICAgewogICAgICAgIHJldHVybiBzcHJpbnRmKAogICAgICAgICAgICAnYGBgJXNcbiVzXG5gYGAnLAogICAgICAgICAgICAkbGFuZ3VhZ2UsCiAgICAgICAgICAgICR0aGlzLT5mb3JtYXRNYXJrZG93bigkdGV4dCkKICAgICAgICApOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzZW5kTWVzc2FnZVdpdGhLZXlib2FyZChzdHJpbmcgJGNoYXRJZCwgc3RyaW5nfGFycmF5ICR0ZXh0LCBhcnJheSAkYnV0dG9ucywgYm9vbCAkcmVzaXplID0gdHJ1ZSk6IGFycmF5CiAgICB7CiAgICAgICAgaWYgKGlzX2FycmF5KCR0ZXh0KSkgewogICAgICAgICAgICAvLyB1c2UgZm9ybWF0IHRleHQgc2VydmljZQogICAgICAgICAgICAkdGV4dCA9ICR0aGlzLT5mb3JtYXRUZXh0KCR0ZXh0KTsKICAgICAgICB9CiAgICAgICAgJHJlc3BvbnNlID0gJHRoaXMtPnNlbmRNZXNzYWdlKCRjaGF0SWQsICR0ZXh0LCBbCiAgICAgICAgICAgICdyZXBseV9tYXJrdXAnID0+IGpzb25fZW5jb2RlKFsKICAgICAgICAgICAgICAgICdrZXlib2FyZCcgPT4gJHRoaXMtPmZvcm1hdEtleWJvYXJkQnV0dG9ucygkYnV0dG9ucyksCiAgICAgICAgICAgICAgICAncmVzaXplX2tleWJvYXJkJyA9PiAkcmVzaXplLAogICAgICAgICAgICBdKSwKICAgICAgICBdKTsKICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzZW5kTWVzc2FnZVdpdGhJbmxpbmVLZXlib2FyZChzdHJpbmcgJGNoYXRJZCwgc3RyaW5nfGFycmF5ICR0ZXh0LCBhcnJheSAkYnV0dG9ucyk6IGFycmF5CiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGlzX2FycmF5KCR0ZXh0KSkgewogICAgICAgICAgICAgICAgLy8gdXNlIGZvcm1hdCB0ZXh0IHNlcnZpY2UKICAgICAgICAgICAgICAgICR0ZXh0ID0gJHRoaXMtPmZvcm1hdFRleHQoJHRleHQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRyZXNwb25zZSA9ICR0aGlzLT5zZW5kTWVzc2FnZSgkY2hhdElkLCAkdGV4dCwgWwogICAgICAgICAgICAgICAgJ3JlcGx5X21hcmt1cCcgPT4ganNvbl9lbmNvZGUoWwogICAgICAgICAgICAgICAgICAgICdpbmxpbmVfa2V5Ym9hcmQnID0+ICR0aGlzLT5mb3JtYXRJbmxpbmVLZXlib2FyZEJ1dHRvbnMoJGJ1dHRvbnMpLAogICAgICAgICAgICAgICAgXSksCiAgICAgICAgICAgIF0pOwogICAgICAgICAgICAvLyBsb2cgcmVzcG9uc2UgYXMgYSBhcnJheQogICAgICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgICAgIH0gY2F0Y2ggKFxFeGNlcHRpb24gJGUpIHsKICAgICAgICAgICAgXExvZzo6ZXJyb3IoInNlbmRNZXNzYWdlV2l0aElubGluZUtleWJvYXJkICIgLiAkZS0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gcmVtb3ZlS2V5Ym9hcmQoc3RyaW5nICRjaGF0SWQsIHN0cmluZyAkdGV4dCk6IGFycmF5CiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5zZW5kTWVzc2FnZSgkY2hhdElkLCAkdGV4dCwgWwogICAgICAgICAgICAncmVwbHlfbWFya3VwJyA9PiBqc29uX2VuY29kZShbCiAgICAgICAgICAgICAgICAncmVtb3ZlX2tleWJvYXJkJyA9PiB0cnVlLAogICAgICAgICAgICBdKSwKICAgICAgICBdKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZm9yY2VSZXBseShzdHJpbmcgJGNoYXRJZCwgc3RyaW5nfGFycmF5ICR0ZXh0KTogYXJyYXkKICAgIHsKICAgICAgICBpZiAoaXNfYXJyYXkoJHRleHQpKSB7CiAgICAgICAgICAgIC8vIHVzZSBmb3JtYXQgdGV4dCBzZXJ2aWNlCiAgICAgICAgICAgICR0ZXh0ID0gJHRoaXMtPmZvcm1hdFRleHQoJHRleHQpOwogICAgICAgIH0KICAgICAgICAkYnV0dG9ucyA9IFtbWyd0ZXh0JyA9PiAn2YTYutmIJywgJ2NhbGxiYWNrX2RhdGEnID0+ICdjYW5jZWwnXV1dOwoKICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRNZXNzYWdlKCRjaGF0SWQsICR0ZXh0LCBbCiAgICAgICAgICAgICdyZXBseV9tYXJrdXAnID0+IGpzb25fZW5jb2RlKFsKICAgICAgICAgICAgICAgICdmb3JjZV9yZXBseScgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdzZWxlY3RpdmUnID0+IHRydWUsCiAgICAgICAgICAgICAgICAnaW5wdXRfZmllbGRfcGxhY2Vob2xkZXInID0+ICR0ZXh0LAogICAgICAgICAgICAgICAgJ2tleWJvYXJkJyA9PiAkYnV0dG9ucywKICAgICAgICAgICAgXSksCiAgICAgICAgXSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHNlbmRQaG90b0ZpbGUoc3RyaW5nICRjaGF0SWQsIHN0cmluZyAkcGhvdG9QYXRoLCBzdHJpbmd8YXJyYXkgJGNhcHRpb24gPSAnJywgYXJyYXkgJG9wdGlvbnMgPSBbXSk6IGFycmF5CiAgICB7CiAgICAgICAgLy8g2KfbjNis2KfYryBDVVJMRmlsZSDYp9iyINmB2KfbjNmEINiq2LXZiNuM2LEKICAgICAgICAkcGhvdG8gPSBuZXcgXENVUkxGaWxlKCRwaG90b1BhdGgpOwogICAgICAgIGlmIChpc19hcnJheSgkY2FwdGlvbikpIHsKICAgICAgICAgICAgLy8gdXNlIGZvcm1hdCB0ZXh0IHNlcnZpY2UKICAgICAgICAgICAgJGNhcHRpb24gPSAkdGhpcy0+Zm9ybWF0VGV4dCgkY2FwdGlvbik7CiAgICAgICAgfQogICAgICAgICRyZXN1bHQgPSAkdGhpcy0+bWFrZVJlcXVlc3RGaWxlKCdzZW5kUGhvdG8nLCBhcnJheV9tZXJnZShbCiAgICAgICAgICAgICdjaGF0X2lkJyA9PiAkY2hhdElkLAogICAgICAgICAgICAncGhvdG8nID0+ICRwaG90bywKICAgICAgICAgICAgJ2NhcHRpb24nID0+ICRjYXB0aW9uLAogICAgICAgICAgICAncGFyc2VfbW9kZScgPT4gJ0hUTUwnLAogICAgICAgIF0sICRvcHRpb25zKSk7CgogICAgICAgIC8vINm+2KfaqSDaqdix2K/ZhiDZgdin24zZhCDZhdmI2YLYqiDYqNi52K8g2KfYsiDYp9ix2LPYp9mECiAgICAgICAgaWYgKGZpbGVfZXhpc3RzKCRwaG90b1BhdGgpKSB7CiAgICAgICAgICAgIHVubGluaygkcGhvdG9QYXRoKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzZW5kUGhvdG8oc3RyaW5nICRjaGF0SWQsIHN0cmluZyAkcGhvdG8sIHN0cmluZ3xhcnJheSAkY2FwdGlvbiA9ICcnLCBhcnJheSAkb3B0aW9ucyA9IFtdKTogYXJyYXkKICAgIHsKICAgICAgICBpZiAoaXNfYXJyYXkoJGNhcHRpb24pKSB7CiAgICAgICAgICAgIC8vIHVzZSBmb3JtYXQgdGV4dCBzZXJ2aWNlCiAgICAgICAgICAgICRjYXB0aW9uID0gJHRoaXMtPmZvcm1hdFRleHQoJGNhcHRpb24pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXMtPm1ha2VSZXF1ZXN0KCdzZW5kUGhvdG8nLCBhcnJheV9tZXJnZShbCiAgICAgICAgICAgICdjaGF0X2lkJyA9PiAkY2hhdElkLAogICAgICAgICAgICAncGhvdG8nID0+ICRwaG90bywKICAgICAgICAgICAgJ2NhcHRpb24nID0+ICRjYXB0aW9uLAogICAgICAgICAgICAncGFyc2VfbW9kZScgPT4gJ0hUTUwnLAogICAgICAgIF0sICRvcHRpb25zKSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHNlbmREb2N1bWVudChzdHJpbmcgJGNoYXRJZCwgc3RyaW5nICRkb2N1bWVudCwgc3RyaW5nfGFycmF5ICRjYXB0aW9uID0gJycsIGFycmF5ICRvcHRpb25zID0gW10pOiBhcnJheQogICAgewogICAgICAgIGlmIChpc19hcnJheSgkY2FwdGlvbikpIHsKICAgICAgICAgICAgLy8gdXNlIGZvcm1hdCB0ZXh0IHNlcnZpY2UKICAgICAgICAgICAgJGNhcHRpb24gPSAkdGhpcy0+Zm9ybWF0VGV4dCgkY2FwdGlvbik7CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRyZXN1bHQgPSAkdGhpcy0+bWFrZVJlcXVlc3QoJ3NlbmREb2N1bWVudCcsIGFycmF5X21lcmdlKFsKICAgICAgICAgICAgICAgICdjaGF0X2lkJyA9PiAkY2hhdElkLAogICAgICAgICAgICAgICAgJ2RvY3VtZW50JyA9PiAkZG9jdW1lbnQsCiAgICAgICAgICAgICAgICAnY2FwdGlvbicgPT4gJGNhcHRpb24sCiAgICAgICAgICAgICAgICAncGFyc2VfbW9kZScgPT4gJ0hUTUwnLAogICAgICAgICAgICBdLCAkb3B0aW9ucykpOwogICAgICAgICAgICAvLyBcTG9nOjppbmZvKCJzZW5kRG9jdW1lbnQgcmVzdWx0PT4gJHJlc3VsdCIpOwogICAgICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBcTG9nOjplcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICB9CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gc2VuZERvY3VtZW50RmlsZShzdHJpbmcgJGNoYXRJZCwgc3RyaW5nICRkb2N1bWVudCwgc3RyaW5nfGFycmF5ICRjYXB0aW9uID0gJycsIGFycmF5ICRvcHRpb25zID0gW10pOiBhcnJheQogICAgewogICAgICAgIGlmIChpc19hcnJheSgkY2FwdGlvbikpIHsKICAgICAgICAgICAgLy8gdXNlIGZvcm1hdCB0ZXh0IHNlcnZpY2UKICAgICAgICAgICAgJGNhcHRpb24gPSAkdGhpcy0+Zm9ybWF0VGV4dCgkY2FwdGlvbik7CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRkb2N1bWVudCA9IG5ldyBcQ1VSTEZpbGUoJGRvY3VtZW50KTsKICAgICAgICAgICAgJHJlc3VsdCA9ICR0aGlzLT5tYWtlUmVxdWVzdEZpbGUoJ3NlbmREb2N1bWVudCcsIGFycmF5X21lcmdlKFsKICAgICAgICAgICAgICAgICdjaGF0X2lkJyA9PiAkY2hhdElkLAogICAgICAgICAgICAgICAgJ2RvY3VtZW50JyA9PiAkZG9jdW1lbnQsCiAgICAgICAgICAgICAgICAnY2FwdGlvbicgPT4gJGNhcHRpb24sCiAgICAgICAgICAgICAgICAncGFyc2VfbW9kZScgPT4gJ0hUTUwnLAogICAgICAgICAgICBdLCAkb3B0aW9ucykpOwogICAgICAgICAgICAvLyBcTG9nOjppbmZvKCJzZW5kRG9jdW1lbnQgcmVzdWx0PT4gJHJlc3VsdCIpOwogICAgICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBcTG9nOjplcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHNlbmRMb2NhdGlvbihzdHJpbmcgJGNoYXRJZCwgZmxvYXQgJGxhdGl0dWRlLCBmbG9hdCAkbG9uZ2l0dWRlKTogYXJyYXkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPm1ha2VSZXF1ZXN0KCdzZW5kTG9jYXRpb24nLCBbCiAgICAgICAgICAgICdjaGF0X2lkJyA9PiAkY2hhdElkLAogICAgICAgICAgICAnbGF0aXR1ZGUnID0+ICRsYXRpdHVkZSwKICAgICAgICAgICAgJ2xvbmdpdHVkZScgPT4gJGxvbmdpdHVkZSwKICAgICAgICBdKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0RmlsZShzdHJpbmcgJGZpbGVJZCk6IGFycmF5CiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5tYWtlUmVxdWVzdCgnZ2V0RmlsZScsIFsKICAgICAgICAgICAgJ2ZpbGVfaWQnID0+ICRmaWxlSWQsCiAgICAgICAgXSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGRvd25sb2FkRmlsZShzdHJpbmcgJGZpbGVQYXRoKTogc3RyaW5nCiAgICB7CiAgICAgICAgJHVybCA9ICJodHRwczovL2FwaS50ZWxlZ3JhbS5vcmcvZmlsZXskdGhpcy0+Ym90VG9rZW59L3skZmlsZVBhdGh9IjsKICAgICAgICByZXR1cm4gZmlsZV9nZXRfY29udGVudHMoJHVybCk7CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gZG93bmxvYWRJbWFnZUZpbGUoJGZpbGVfcGF0aCkKICAgIHsKICAgICAgICAkdXJsID0gImh0dHBzOi8vYXBpLnRlbGVncmFtLm9yZy9maWxlLyIgLiAkdGhpcy0+Ym90VG9rZW4gLiAiLyIgLiAkZmlsZV9wYXRoOwogICAgICAgIC8vICR1cmwgPSAiaHR0cHM6Ly9hcGkudGVsZWdyYW0ub3JnL2ZpbGUvYm90IiAuICR0aGlzLT5ib3RUb2tlbiAuICIvIiAuICRmaWxlX3BhdGg7CiAgICAgICAgcmV0dXJuIGZpbGVfZ2V0X2NvbnRlbnRzKCR1cmwpOwogICAgfQogICAgcHVibGljIGZ1bmN0aW9uIHNlbmRWb2ljZShzdHJpbmcgJGNoYXRJZCwgc3RyaW5nICR2b2ljZSwgc3RyaW5nfGFycmF5ICRjYXB0aW9uID0gJycsIGFycmF5ICRvcHRpb25zID0gW10pOiBhcnJheQogICAgewogICAgICAgIGlmIChpc19hcnJheSgkY2FwdGlvbikpIHsKICAgICAgICAgICAgLy8gdXNlIGZvcm1hdCB0ZXh0IHNlcnZpY2UKICAgICAgICAgICAgJGNhcHRpb24gPSAkdGhpcy0+Zm9ybWF0VGV4dCgkY2FwdGlvbik7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkdGhpcy0+bWFrZVJlcXVlc3QoJ3NlbmRWb2ljZScsIGFycmF5X21lcmdlKFsKICAgICAgICAgICAgJ2NoYXRfaWQnID0+ICRjaGF0SWQsCiAgICAgICAgICAgICd2b2ljZScgPT4gJHZvaWNlLAogICAgICAgICAgICAnY2FwdGlvbicgPT4gJGNhcHRpb24sCiAgICAgICAgICAgICdwYXJzZV9tb2RlJyA9PiAnSFRNTCcsCiAgICAgICAgXSwgJG9wdGlvbnMpKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gc2VuZFZpZGVvKHN0cmluZyAkY2hhdElkLCBzdHJpbmcgJHZpZGVvLCBzdHJpbmd8YXJyYXkgJGNhcHRpb24gPSAnJywgYXJyYXkgJG9wdGlvbnMgPSBbXSk6IGFycmF5CiAgICB7CiAgICAgICAgaWYgKGlzX2FycmF5KCRjYXB0aW9uKSkgewogICAgICAgICAgICAvLyB1c2UgZm9ybWF0IHRleHQgc2VydmljZQogICAgICAgICAgICAkY2FwdGlvbiA9ICR0aGlzLT5mb3JtYXRUZXh0KCRjYXB0aW9uKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICR0aGlzLT5tYWtlUmVxdWVzdCgnc2VuZFZpZGVvJywgYXJyYXlfbWVyZ2UoWwogICAgICAgICAgICAnY2hhdF9pZCcgPT4gJGNoYXRJZCwKICAgICAgICAgICAgJ3ZpZGVvJyA9PiAkdmlkZW8sCiAgICAgICAgICAgICdjYXB0aW9uJyA9PiAkY2FwdGlvbiwKICAgICAgICAgICAgJ3BhcnNlX21vZGUnID0+ICdIVE1MJywKICAgICAgICBdLCAkb3B0aW9ucykpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzZW5kQ29udGFjdChzdHJpbmcgJGNoYXRJZCwgc3RyaW5nICRwaG9uZU51bWJlciwgc3RyaW5nICRmaXJzdE5hbWUsIHN0cmluZyAkbGFzdE5hbWUgPSAnJyk6IGFycmF5CiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5tYWtlUmVxdWVzdCgnc2VuZENvbnRhY3QnLCBbCiAgICAgICAgICAgICdjaGF0X2lkJyA9PiAkY2hhdElkLAogICAgICAgICAgICAncGhvbmVfbnVtYmVyJyA9PiAkcGhvbmVOdW1iZXIsCiAgICAgICAgICAgICdmaXJzdF9uYW1lJyA9PiAkZmlyc3ROYW1lLAogICAgICAgICAgICAnbGFzdF9uYW1lJyA9PiAkbGFzdE5hbWUsCiAgICAgICAgXSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHNlbmRDaGF0QWN0aW9uKHN0cmluZyAkY2hhdElkLCBzdHJpbmcgJGFjdGlvbik6IGFycmF5CiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5tYWtlUmVxdWVzdCgnc2VuZENoYXRBY3Rpb24nLCBbCiAgICAgICAgICAgICdjaGF0X2lkJyA9PiAkY2hhdElkLAogICAgICAgICAgICAnYWN0aW9uJyA9PiAkYWN0aW9uLCAvLyB0eXBpbmcsIHVwbG9hZF9waG90bywgcmVjb3JkX3ZpZGVvLCB1cGxvYWRfdmlkZW8sIHJlY29yZF92b2ljZSwgdXBsb2FkX3ZvaWNlLCB1cGxvYWRfZG9jdW1lbnQKICAgICAgICBdKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gYW5zd2VyQ2FsbGJhY2tRdWVyeShzdHJpbmcgJGNhbGxiYWNrUXVlcnlJZCwgc3RyaW5nfGFycmF5ICR0ZXh0ID0gJycsIGJvb2wgJHNob3dBbGVydCA9IGZhbHNlKTogYXJyYXkKICAgIHsKICAgICAgICBpZiAoaXNfYXJyYXkoJHRleHQpKSB7CiAgICAgICAgICAgIC8vIHVzZSBmb3JtYXQgdGV4dCBzZXJ2aWNlCiAgICAgICAgICAgICR0ZXh0ID0gJHRoaXMtPmZvcm1hdFRleHQoJHRleHQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXMtPm1ha2VSZXF1ZXN0KCdhbnN3ZXJDYWxsYmFja1F1ZXJ5JywgWwogICAgICAgICAgICAnY2FsbGJhY2tfcXVlcnlfaWQnID0+ICRjYWxsYmFja1F1ZXJ5SWQsCiAgICAgICAgICAgICd0ZXh0JyA9PiAkdGV4dCwKICAgICAgICAgICAgJ3Nob3dfYWxlcnQnID0+ICRzaG93QWxlcnQsCiAgICAgICAgXSk7CiAgICB9CgogICAgcHJpdmF0ZSBmdW5jdGlvbiBmb3JtYXRLZXlib2FyZEJ1dHRvbnMoYXJyYXkgJGJ1dHRvbnMpOiBhcnJheQogICAgewogICAgICAgICRrZXlib2FyZCA9IFtdOwogICAgICAgIGZvcmVhY2ggKCRidXR0b25zIGFzICRyb3cpIHsKICAgICAgICAgICAgJGtleWJvYXJkUm93ID0gW107CiAgICAgICAgICAgIGZvcmVhY2ggKCRyb3cgYXMgJGJ1dHRvbikgewogICAgICAgICAgICAgICAgaWYgKCFpc3NldCgkYnV0dG9uWydjYWxsYmFja19kYXRhJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgJGJ1dHRvblsnY2FsbGJhY2tfZGF0YSddID0gJyc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAka2V5Ym9hcmRSb3dbXSA9ICRidXR0b247CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGtleWJvYXJkW10gPSAka2V5Ym9hcmRSb3c7CiAgICAgICAgfQogICAgICAgIHJldHVybiAka2V5Ym9hcmQ7CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gZm9ybWF0VGV4dChhcnJheSAkdGV4dCk6IHN0cmluZwogICAgewogICAgICAgICRmb3JtYXR0ZXIgPSBuZXcgVGVsZWdyYW1NZXNzYWdlRm9ybWF0dGVyKCR0aGlzKTsKICAgICAgICAkdGV4dCA9ICRmb3JtYXR0ZXItPmFkZEZvcm1hdHRlZFRleHQoJycsICR0ZXh0KS0+Z2V0TWVzc2FnZSgpOwogICAgICAgIHJldHVybiAkdGV4dDsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZm9ybWF0SW5saW5lS2V5Ym9hcmRCdXR0b25zKGFycmF5ICRidXR0b25zKTogYXJyYXkKICAgIHsKICAgICAgICAka2V5Ym9hcmQgPSBbXTsKICAgICAgICBmb3JlYWNoICgkYnV0dG9ucyBhcyAkcm93KSB7CiAgICAgICAgICAgICRrZXlib2FyZFJvdyA9IFtdOwogICAgICAgICAgICBmb3JlYWNoICgkcm93IGFzICR0ZXh0ID0+ICRjYWxsYmFja0RhdGEpIHsKICAgICAgICAgICAgICAgICRrZXlib2FyZFJvd1tdID0gWwogICAgICAgICAgICAgICAgICAgICd0ZXh0JyA9PiAkdGV4dCwKICAgICAgICAgICAgICAgICAgICAnY2FsbGJhY2tfZGF0YScgPT4gJGNhbGxiYWNrRGF0YSwKICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGtleWJvYXJkW10gPSAka2V5Ym9hcmRSb3c7CiAgICAgICAgfQogICAgICAgIHJldHVybiAka2V5Ym9hcmQ7CiAgICB9CgogICAgcHJpdmF0ZSBmdW5jdGlvbiBtYWtlUmVxdWVzdChzdHJpbmcgJG1ldGhvZCwgYXJyYXkgJHBhcmFtcyA9IFtdKTogYXJyYXkKICAgIHsKICAgICAgICAkdXJsID0gJHRoaXMtPmJhc2VVcmwgLiAkdGhpcy0+Ym90VG9rZW4gLiAnLycgLiAkbWV0aG9kOwoKICAgICAgICAkY2ggPSBjdXJsX2luaXQoKTsKICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfVVJMLCAkdXJsKTsKICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUkVUVVJOVFJBTlNGRVIsIHRydWUpOwogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9QT1NULCB0cnVlKTsKICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUE9TVEZJRUxEUywganNvbl9lbmNvZGUoJHBhcmFtcykpOwogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9IVFRQSEVBREVSLCBbJ0NvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vanNvbiddKTsKCiAgICAgICAgJHJlc3BvbnNlID0gY3VybF9leGVjKCRjaCk7CiAgICAgICAgJGVycm9yID0gY3VybF9lcnJvcigkY2gpOwogICAgICAgIGN1cmxfY2xvc2UoJGNoKTsKCiAgICAgICAgaWYgKCRlcnJvcikgewogICAgICAgICAgICB0aHJvdyBuZXcgXEV4Y2VwdGlvbign2K7Yt9inINiv2LEg2KfYsdiq2KjYp9i3INio2Kcg2KrZhNqv2LHYp9mFOiAnIC4gJGVycm9yKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBqc29uX2RlY29kZSgkcmVzcG9uc2UsIHRydWUpID8/IFtdOwogICAgfQoKICAgIHByaXZhdGUgZnVuY3Rpb24gbWFrZVJlcXVlc3RGaWxlKHN0cmluZyAkbWV0aG9kLCBhcnJheSAkcGFyYW1zID0gW10pOiBhcnJheQogICAgewogICAgICAgICR1cmwgPSAkdGhpcy0+YmFzZVVybCAuICR0aGlzLT5ib3RUb2tlbiAuICcvJyAuICRtZXRob2Q7CgogICAgICAgICRjaCA9IGN1cmxfaW5pdCgpOwogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9VUkwsICR1cmwpOwogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9SRVRVUk5UUkFOU0ZFUiwgdHJ1ZSk7CiAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1BPU1QsIHRydWUpOwogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9QT1NURklFTERTLCAkcGFyYW1zKTsKICAgICAgICAvLyDYqNix2KfbjCDYp9ix2LPYp9mEINmB2KfbjNmEINmG24zYp9iy24wg2KjZhyDYqtmG2LjbjNmFIENvbnRlbnQtVHlwZSDZhtuM2LPYqgogICAgICAgIC8vIENVUkwg2KjZhyDYtdmI2LHYqiDYrtmI2K/aqdin2LEgQ29udGVudC1UeXBlOiBtdWx0aXBhcnQvZm9ybS1kYXRhINix2Kcg2KrZhti424zZhSDZhduM4oCM2qnZhtivCgogICAgICAgICRyZXNwb25zZSA9IGN1cmxfZXhlYygkY2gpOwogICAgICAgICRlcnJvciA9IGN1cmxfZXJyb3IoJGNoKTsKICAgICAgICBjdXJsX2Nsb3NlKCRjaCk7CgogICAgICAgIGlmICgkZXJyb3IpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFxFeGNlcHRpb24oJ9iu2LfYpyDYr9ixINin2LHYqtio2KfYtyDYqNinINiq2YTar9ix2KfZhTogJyAuICRlcnJvcik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4ganNvbl9kZWNvZGUoJHJlc3BvbnNlLCB0cnVlKSA/PyBbXTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbmQgbWVzc2FnZSB3aXRoIG11bHRpcGxlIGJ1dHRvbnMKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRjaGF0SWQgVGVsZWdyYW0gY2hhdCBJRAogICAgICogQHBhcmFtIHN0cmluZyAkdGV4dCBNZXNzYWdlIHRleHQKICAgICAqIEBwYXJhbSBhcnJheSAkYnV0dG9uc0xpc3QgQXJyYXkgb2YgYnV0dG9ucyBbIFsndGV4dCcgPT4gJ0J1dHRvbiBUZXh0JywgJ3VybCcgPT4gJ0J1dHRvbiBVUkwnXSBdCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZW5kTWVzc2FnZVdpdGhMaW5rQnV0dG9ucyhzdHJpbmcgJGNoYXRJZCwgc3RyaW5nfGFycmF5ICR0ZXh0LCBhcnJheSAkYnV0dG9uc0xpc3QpOiBhcnJheQogICAgewogICAgICAgIGlmIChpc19hcnJheSgkdGV4dCkpIHsKICAgICAgICAgICAgLy8gdXNlIGZvcm1hdCB0ZXh0IHNlcnZpY2UKICAgICAgICAgICAgJHRleHQgPSAkdGhpcy0+Zm9ybWF0VGV4dCgkdGV4dCk7CiAgICAgICAgfQogICAgICAgICRidXR0b25zID0gW107CiAgICAgICAgZm9yZWFjaCAoJGJ1dHRvbnNMaXN0IGFzICRidXR0b24pIHsKICAgICAgICAgICAgJGJ1dHRvbnNbXSA9IFsKICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAndGV4dCcgPT4gJGJ1dHRvblsndGV4dCddLAogICAgICAgICAgICAgICAgICAgICd1cmwnID0+IHRyaW0oJGJ1dHRvblsndXJsJ10pLAogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgXTsKICAgICAgICB9CgogICAgICAgICRyZXNwb25zZSA9ICR0aGlzLT5tYWtlUmVxdWVzdCgnc2VuZE1lc3NhZ2UnLCBbCiAgICAgICAgICAgICdjaGF0X2lkJyA9PiAkY2hhdElkLAogICAgICAgICAgICAndGV4dCcgPT4gJHRleHQsCiAgICAgICAgICAgICdyZXBseV9tYXJrdXAnID0+IGpzb25fZW5jb2RlKFsKICAgICAgICAgICAgICAgICdpbmxpbmVfa2V5Ym9hcmQnID0+ICRidXR0b25zLAogICAgICAgICAgICBdKSwKICAgICAgICBdKTsKICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBlZGl0TWVzc2FnZVRleHQoc3RyaW5nICRjaGF0SWQsIGludCAkbWVzc2FnZUlkLCBzdHJpbmcgJHRleHQsIGFycmF5ICRvcHRpb25zID0gW10pOiBhcnJheQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+bWFrZVJlcXVlc3QoJ2VkaXRNZXNzYWdlVGV4dCcsIGFycmF5X21lcmdlKFsKICAgICAgICAgICAgJ2NoYXRfaWQnID0+ICRjaGF0SWQsCiAgICAgICAgICAgICdtZXNzYWdlX2lkJyA9PiAkbWVzc2FnZUlkLAogICAgICAgICAgICAndGV4dCcgPT4gJHRleHQsCiAgICAgICAgICAgICdwYXJzZV9tb2RlJyA9PiAnSFRNTCcsCiAgICAgICAgXSwgJG9wdGlvbnMpKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZWRpdE1lc3NhZ2VSZXBseU1hcmt1cChzdHJpbmcgJGNoYXRJZCwgaW50ICRtZXNzYWdlSWQsIGFycmF5ICRyZXBseU1hcmt1cCA9IFtdKTogYXJyYXkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPm1ha2VSZXF1ZXN0KCdlZGl0TWVzc2FnZVJlcGx5TWFya3VwJywgWwogICAgICAgICAgICAnY2hhdF9pZCcgPT4gJGNoYXRJZCwKICAgICAgICAgICAgJ21lc3NhZ2VfaWQnID0+ICRtZXNzYWdlSWQsCiAgICAgICAgICAgICdyZXBseV9tYXJrdXAnID0+IGpzb25fZW5jb2RlKCRyZXBseU1hcmt1cCksCiAgICAgICAgXSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGVkaXRNZXNzYWdlV2l0aElubGluZUtleWJvYXJkKHN0cmluZyAkY2hhdElkLCBpbnQgJG1lc3NhZ2VJZCwgc3RyaW5nfGFycmF5ICR0ZXh0LCBhcnJheSAkYnV0dG9ucyk6IGFycmF5CiAgICB7CiAgICAgICAgaWYgKGlzX2FycmF5KCR0ZXh0KSkgewogICAgICAgICAgICAkdGV4dCA9ICR0aGlzLT5mb3JtYXRUZXh0KCR0ZXh0KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICR0aGlzLT5lZGl0TWVzc2FnZVRleHQoJGNoYXRJZCwgJG1lc3NhZ2VJZCwgJHRleHQsIFsKICAgICAgICAgICAgJ3JlcGx5X21hcmt1cCcgPT4ganNvbl9lbmNvZGUoWwogICAgICAgICAgICAgICAgJ2lubGluZV9rZXlib2FyZCcgPT4gJHRoaXMtPmZvcm1hdElubGluZUtleWJvYXJkQnV0dG9ucygkYnV0dG9ucyksCiAgICAgICAgICAgIF0pLAogICAgICAgIF0pOwogICAgfQp9Cg==